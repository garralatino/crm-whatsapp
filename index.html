<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mensajes WhatsApp</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>
tailwind.config={
theme:{
extend:{
colors:{primary:'#25D366',secondary:'#128C7E'},
borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'},
width: {
'mobile': '375px'
}
}
}
}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Poppins', sans-serif;
min-height: 100vh;
width: 100%;
max-width: 100%;
position: relative;
overflow-x: hidden;
margin: 0 auto;
transition: background-color 0.3s, color 0.3s;
background-color: #f8fafc;
}
body.dark-mode {
background-color: #1a1a1a;
color: #ffffff;
}
body.dark-mode nav {
background-color: #2d2d2d;
}
body.dark-mode .bg-white {
background-color: #2d2d2d;
}
body.dark-mode .border-gray-300,
body.dark-mode .border-gray-200,
body.dark-mode .border-gray-100 {
border-color: #404040;
}
body.dark-mode .text-gray-600,
body.dark-mode .text-gray-500 {
color: #a0a0a0;
}
body.dark-mode .bg-gray-50,
body.dark-mode .bg-gray-100 {
background-color: #333333;
}
body.dark-mode .message-preview {
background-color: #404040;
}
body.dark-mode .message-preview:after {
border-left-color: #404040;
}
body.dark-mode .text-primary {
color: #ffffff;
}
body.dark-mode .bg-primary\/10 {
background-color: rgba(45, 45, 45, 0.8);
}
body.orange-mode {
background-color: #fff8f3;
color: #4a2500;
}
body.orange-mode nav {
background-color: #ff6b00;
}
body.orange-mode .bg-white {
background-color: #ffffff;
}
body.orange-mode .border-gray-300,
body.orange-mode .border-gray-200,
body.orange-mode .border-gray-100 {
border-color: #ffe0cc;
}
body.orange-mode .text-gray-600,
body.orange-mode .text-gray-500 {
color: #804200;
}
body.orange-mode .bg-gray-50,
body.orange-mode .bg-gray-100 {
background-color: #fff1e6;
}
body.orange-mode .message-preview {
background-color: #ffe0cc;
}
body.orange-mode .message-preview:after {
border-left-color: #ffe0cc;
}
body.orange-mode .text-primary {
color: #ff6b00;
}
body.orange-mode .bg-primary\/10 {
background-color: rgba(255, 107, 0, 0.1);
}
body.blue-mode {
background-color: #f0f7ff;
color: #002b4a;
}
body.blue-mode nav {
background-color: #0084ff;
}
body.blue-mode .bg-white {
background-color: #ffffff;
}
body.blue-mode .border-gray-300,
body.blue-mode .border-gray-200,
body.blue-mode .border-gray-100 {
border-color: #cce4ff;
}
body.blue-mode .text-gray-600,
body.blue-mode .text-gray-500 {
color: #004280;
}
body.blue-mode .bg-gray-50,
body.blue-mode .bg-gray-100 {
background-color: #e6f0ff;
}
body.blue-mode .message-preview {
background-color: #cce4ff;
}
body.blue-mode .message-preview:after {
border-left-color: #cce4ff;
}
body.blue-mode .text-primary {
color: #0084ff;
}
body.blue-mode .bg-primary\/10 {
background-color: rgba(0, 132, 255, 0.1);
}
body.violet-mode {
background-color: #f8f2ff;
color: #2d0059;
}
body.violet-mode nav {
background-color: #8000ff;
}
body.violet-mode .bg-white {
background-color: #ffffff;
}
body.violet-mode .border-gray-300,
body.violet-mode .border-gray-200,
body.violet-mode .border-gray-100 {
border-color: #e6ccff;
}
body.violet-mode .text-gray-600,
body.violet-mode .text-gray-500 {
color: #4d0080;
}
body.violet-mode .bg-gray-50,
body.violet-mode .bg-gray-100 {
background-color: #f2e6ff;
}
body.violet-mode .message-preview {
background-color: #e6ccff;
}
body.violet-mode .message-preview:after {
border-left-color: #e6ccff;
}
body.violet-mode .text-primary {
color: #8000ff;
}
body.violet-mode .bg-primary\/10 {
background-color: rgba(128, 0, 255, 0.1);
}
body.navy-mode {
background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
color: #001f3f;
}
body.navy-mode nav {
background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
}
body.navy-mode .bg-white {
background-color: #ffffff;
}
body.navy-mode .border-gray-300,
body.navy-mode .border-gray-200,
body.navy-mode .border-gray-100 {
border-color: #d1d9e6;
}
body.navy-mode .text-gray-600,
body.navy-mode .text-gray-500 {
color: #2c5282;
}
body.navy-mode .bg-gray-50,
body.navy-mode .bg-gray-100 {
background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
}
body.navy-mode .message-preview {
background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
}
body.navy-mode .message-preview:after {
border-left-color: #cbd5e0;
}
body.navy-mode .text-primary {
color: #2a5298;
}
body.navy-mode .bg-primary\/10 {
background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
}
@media (min-width: 768px) {
body {
max-width: 100%;
}
}
.emoji-picker {
height: 200px;
overflow-y: auto;
max-width: 375px;
width: 100%;
}
.emoji-category {
display: grid;
grid-template-columns: repeat(8, 1fr);
}
.emoji-btn {
cursor: pointer;
font-size: 1.5rem;
padding: 5px;
transition: transform 0.1s;
}
.emoji-btn:hover {
transform: scale(1.2);
}
.numpad-btn {
transition: all 0.2s;
}
.numpad-btn:active {
transform: scale(0.95);
}
body.dark-mode .numpad-btn,
body.dark-mode button.bg-primary {
background-color: #2d2d2d;
color: #ffffff;
border-color: #404040;
}
body.dark-mode .numpad-btn:active,
body.dark-mode button.bg-primary:active {
background-color: rgba(37, 211, 102, 0.3);
}
body.orange-mode .numpad-btn,
body.orange-mode button.bg-primary {
background-color: #ff6b00;
color: #ffffff;
border-color: #ff6b00;
}
body.orange-mode .numpad-btn:active,
body.orange-mode button.bg-primary:active {
background-color: rgba(255, 107, 0, 0.8);
}
body.blue-mode .numpad-btn,
body.blue-mode button.bg-primary {
background-color: #0084ff;
color: #ffffff;
border-color: #0084ff;
}
body.blue-mode .numpad-btn:active,
body.blue-mode button.bg-primary:active {
background-color: rgba(0, 132, 255, 0.8);
}
.message-preview {
background-color: #DCF8C6;
border-radius: 8px 8px 0 8px;
position: relative;
max-width: 90%;
word-break: break-word;
}
.message-preview:after {
content: "";
position: absolute;
right: -8px;
bottom: 0;
width: 0;
height: 0;
border-left: 8px solid #DCF8C6;
border-top: 8px solid transparent;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
</style>
</head>
<body class="bg-gray-50">
<!-- Navbar -->
<nav class="fixed top-0 w-full bg-primary text-white shadow-md z-50">
<div class="flex items-center justify-between px-4 py-3">
<div class="flex items-center gap-1">
<button id="sidebarToggle" class="w-8 h-8 flex items-center justify-center">
<i class="ri-menu-line ri-lg"></i>
</button>
<h1 class="text-lg font-semibold">CRM</h1>
<div id="timer" class="text-sm font-medium">01:00</div>
</div>
<div class="flex items-center gap-1">
<button id="radioBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-radio-line ri-lg"></i>
</button>
<button id="catalogBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-store-2-line ri-lg"></i>
</button>
<button id="ordersBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer hidden">
<i class="ri-shopping-cart-line ri-lg"></i>
</button>
<button id="crmBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-customer-service-line ri-lg"></i>
</button>
<button id="financeBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-money-dollar-circle-line ri-lg"></i>
</button>
<button id="toolsBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-tools-line ri-lg"></i>
</button>
<button id="backupBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-database-2-line ri-lg"></i>
</button>
<button id="settingsBtn" class="w-7 h-7 flex items-center justify-center cursor-pointer">
<i class="ri-moon-line ri-lg"></i>
</button>
</div>
</div>
</nav>
<div id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-white transform -translate-x-full transition-transform duration-300 ease-in-out z-[60] overflow-y-auto">
<div class="p-4 border-b border-gray-200">
<div class="flex items-center justify-between">
<div class="flex items-center gap-3">
<img src="https://static.readdy.ai/image/e969b6430137f0fec9b6123481bc2e06/5ecb0538eec11a7aa577ad934e8c22e5.png" alt="Logo" class="w-8 h-8 rounded-full object-cover">
<div class="flex flex-col">
<h2 class="text-base font-medium font-['Poppins']">CRM WhatsApp</h2>
<p class="text-[10px] text-gray-500">by Luis Zapata</p>
</div>
</div>
<button id="closeSidebar" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
</div>
<div class="p-4 space-y-4">
<div class="space-y-2">
<p class="text-sm font-medium text-gray-600">Mensajes</p>
<button onclick="showMessageManager()" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-chat-new-line text-primary"></i>
<span>Nuevo mensaje</span>
</button>
<button id="smsMenuBtn" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-message-2-line text-primary"></i>
<span>SMS</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-history-line text-primary"></i>
<span>Historial</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2 hidden">
<i class="ri-time-line text-primary"></i>
<span>Programados</span>
</button>
<button onclick="document.getElementById('crmBtn').click()" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-customer-service-line text-primary"></i>
<span>Gestion de clientes</span>
</button>
</div>
<div class="space-y-2">
<p class="text-sm font-medium text-gray-600">Herramientas</p>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-store-2-line text-primary"></i>
<span>Catálogo</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-money-dollar-circle-line text-primary"></i>
<span>Finanzas</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-radio-line text-primary"></i>
<span>Radio</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-restaurant-line text-primary"></i>
<span>Restaurante</span>
</button>
<button onclick="showCalendarManager()" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-calendar-2-line text-primary"></i>
<span>Calendario</span>
</button>
</div>
<div class="space-y-2">
<p class="text-sm font-medium text-gray-600">Contactos</p>
<button onclick="showContactsManager()" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-user-add-line text-primary"></i>
<span>Agregar contactos</span>
</button>
<button onclick="showSavedContactsList()" class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2 hidden">
<i class="ri-contacts-line text-primary"></i>
<span>Contactos guardados</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-group-line text-primary"></i>
<span>Grupos</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-file-upload-line text-primary"></i>
<span>Importar contactos</span>
</button>
</div>
<div class="space-y-2">
<p class="text-sm font-medium text-gray-600">Utilidades</p>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-bar-chart-line text-primary"></i>
<span>Análisis</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-database-2-line text-primary"></i>
<span>Copias de seguridad</span>
</button>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-tools-line text-primary"></i>
<span>Herramientas</span>
</button>
</div>
<div class="space-y-2">
<p class="text-sm font-medium text-gray-600">Configuración</p>
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-moon-line text-primary"></i>
<span>Tema</span>
</button>
</div>
</div>
</div>
<div id="sidebarOverlay" class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out z-[55]"></div>
<!-- Main Content -->
<main class="pt-16 pb-20 px-4 w-full mx-auto min-h-screen">
<!-- Selector de código de país y número -->
<div class="mt-4 w-full">
<label class="text-sm text-gray-600 mb-1 block">Número de WhatsApp</label>
<div class="grid grid-rows-2 gap-2 w-full">
<div class="relative w-full">
<button id="selectPhoneBtn" class="w-full h-12 flex items-center justify-between px-3 bg-white border border-gray-300 !rounded-button shadow-sm">
<div class="flex items-center">
<i class="ri-contacts-line ri-lg text-primary mr-2"></i>
<span class="text-gray-500">Seleccionar contacto</span>
</div>
<i class="ri-arrow-down-s-line ri-lg"></i>
</button>
<div id="savedPhonesDropdown" class="absolute left-0 right-0 top-full mt-1 bg-white border border-gray-200 !rounded-button shadow-lg z-10 hidden">
<div class="p-2 border-b border-gray-100">
<div class="flex gap-2 items-center">
<div class="relative flex-1">
<i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
<input type="text" id="contactSearch" placeholder="Buscar contacto..." class="w-full pl-9 pr-3 py-2 bg-gray-50 border-none !rounded-button text-sm">
</div>
<button id="deleteAllContactsBtn" class="px-2 py-2 bg-red-50 text-red-500 !rounded-button text-sm flex items-center justify-center">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<ul id="savedPhonesList" class="max-h-48 overflow-y-auto py-1">
<li class="px-3 py-2 text-gray-500 text-center">No hay números guardados</li>
</ul>
</div>
</div>
<div class="flex gap-2 w-full">
<div class="relative w-[30%] max-w-[120px]">
<button id="countryCodeBtn" class="w-full h-12 bg-white border border-gray-300 !rounded-button flex items-center justify-between px-3 shadow-sm">
<span id="selectedCountryCode">+51</span>
<i class="ri-arrow-down-s-line ri-lg"></i>
</button>
<div id="countryCodeDropdown" class="absolute top-full left-0 w-[200%] mt-1 bg-white border border-gray-200 !rounded-button shadow-lg z-10 hidden">
<ul class="py-1">
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+51">
<span class="mr-2">🇵🇪</span> +51 Perú
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+52">
<span class="mr-2">🇲🇽</span> +52 México
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+53">
<span class="mr-2">🇨🇺</span> +53 Cuba
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+54">
<span class="mr-2">🇦🇷</span> +54 Argentina
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+56">
<span class="mr-2">🇨🇱</span> +56 Chile
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+57">
<span class="mr-2">🇨🇴</span> +57 Colombia
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+58">
<span class="mr-2">🇻🇪</span> +58 Venezuela
</li>
</ul>
</div>
</div>
<input type="number" id="phoneNumber" placeholder="987654321" class="w-[60%] h-12 px-3 bg-white border border-gray-300 !rounded-button shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
<div class="flex gap-2">
<button id="savePhoneBtn" class="w-12 h-12 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-save-line ri-lg text-primary"></i>
</button>
</div>
</div>
</div>
<!-- Teclado numérico -->
<div id="numpad" class="w-full bg-white border border-gray-200 !rounded-button py-2 px-4 mt-2 shadow-sm">
<div class="grid grid-cols-3 gap-2">
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="1">1</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="2">2</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="3">3</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="4">4</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="5">5</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="6">6</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="7">7</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="8">8</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="9">9</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20" data-key="0">0</button>
<button class="numpad-btn h-12 bg-primary/10 border border-primary/20 !rounded-button shadow-sm text-lg font-medium text-primary hover:bg-primary/20 col-span-2" data-key="backspace">
<i class="ri-delete-back-2-line ri-lg"></i>
</button>
</div>
</div>
<div id="countryCodeDropdown" class="absolute top-full left-0 w-[200%] mt-1 bg-white border border-gray-200 !rounded-button shadow-lg z-10 hidden">
<ul class="py-1">
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+51">
<span class="mr-2">🇵🇪</span> +51 Perú
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+52">
<span class="mr-2">🇲🇽</span> +52 México
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+53">
<span class="mr-2">🇨🇺</span> +53 Cuba
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+54">
<span class="mr-2">🇦🇷</span> +54 Argentina
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+56">
<span class="mr-2">🇨🇱</span> +56 Chile
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+57">
<span class="mr-2">🇨🇴</span> +57 Colombia
</li>
<li class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer" data-code="+58">
<span class="mr-2">🇻🇪</span> +58 Venezuela
</li>
</ul>
</div>
</div>
</div>
</div>
<!-- Selector de mensajes guardados -->
<div class="mt-4">
<div class="flex items-center justify-between mb-1">
<label class="text-sm text-gray-600">Mensajes guardados</label>
<span id="savedMessagesCount" class="text-xs bg-primary text-white px-2 py-0.5 rounded-full">0</span>
</div>
<div class="relative">
<button id="savedMessagesBtn" class="w-full h-12 bg-white border border-gray-300 !rounded-button flex items-center justify-between px-3 shadow-sm">
<span id="selectedMessagePreview" class="truncate text-gray-500">Seleccionar mensaje guardado</span>
<i class="ri-arrow-down-s-line ri-lg"></i>
</button>
<div id="savedMessagesDropdown" class="absolute top-full left-0 w-full mt-1 bg-white border border-gray-200 !rounded-button shadow-lg z-10 hidden">
<ul id="savedMessagesList" class="py-1 max-h-48 overflow-y-auto">
<li class="px-3 py-2 text-gray-500 text-center">No hay mensajes guardados</li>
</ul>
</div>
</div>
</div>
<!-- Editor de mensaje -->
<div class="mt-4">
<div class="flex items-center justify-between mb-1">
<div class="flex gap-2">
<button id="emojiBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-emotion-line ri-lg text-gray-600"></i>
</button>
<button id="aiClosingBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-robot-line ri-lg text-gray-600"></i>
</button>
<button id="quickRepliesBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-flashlight-line ri-lg text-gray-600"></i>
</button>
<button id="saveMessageBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-save-line ri-lg text-gray-600"></i>
</button>
<button id="clearMessageBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-delete-bin-line ri-lg text-gray-600"></i>
</button>
<button id="importContactsBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-file-upload-line ri-lg text-gray-600"></i>
</button>
<button id="historyBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-history-line ri-lg text-gray-600"></i>
</button>
<button id="analyticsBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-bar-chart-line ri-lg text-gray-600"></i>
</button>
<button id="restaurantBtn" class="w-8 h-8 flex items-center justify-center bg-white border border-gray-300 !rounded-button shadow-sm">
<i class="ri-restaurant-line ri-lg text-gray-600"></i>
</button>
</div>
</div>
<div class="bg-gray-50 p-2 !rounded-button mb-2 flex gap-1 overflow-x-auto">
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="bold">
<i class="ri-bold"></i>
</button>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="italic">
<i class="ri-italic"></i>
</button>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="strike">
<i class="ri-strikethrough"></i>
</button>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="monospace">
<i class="ri-code-line"></i>
</button>
<div class="w-px h-6 bg-gray-200 mx-1"></div>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="bullet">
<i class="ri-list-unordered"></i>
</button>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="number">
<i class="ri-list-ordered"></i>
</button>
<div class="w-px h-6 bg-gray-200 mx-1"></div>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="quote">
<i class="ri-double-quotes-l"></i>
</button>
<button class="format-btn p-1 hover:bg-gray-100 !rounded-button" data-format="link">
<i class="ri-link"></i>
</button>
</div>
<textarea id="messageText" rows="4" placeholder="Escribe tu mensaje aquí..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none"></textarea>
<!-- Emoji Picker -->
<div id="emojiPicker" class="emoji-picker mt-2 bg-white border border-gray-200 !rounded-button shadow-lg hidden">
<div class="sticky top-0 bg-white border-b border-gray-200 p-2 flex gap-2 overflow-x-auto">
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-primary text-white" data-category="smileys">😀</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="people">👨</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="animals">🐶</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="food">🍎</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="travel">🚗</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="activities">⚽</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="objects">💡</button>
<button class="emoji-category-btn px-2 py-1 !rounded-button bg-gray-100" data-category="symbols">❤️</button>
</div>
<div class="p-2">
<div id="smileys" class="emoji-category">
<span class="emoji-btn">😀</span><span class="emoji-btn">😃</span><span class="emoji-btn">😄</span>
<span class="emoji-btn">😁</span><span class="emoji-btn">😆</span><span class="emoji-btn">😅</span>
<span class="emoji-btn">🤣</span><span class="emoji-btn">😂</span><span class="emoji-btn">🙂</span>
<span class="emoji-btn">🙃</span><span class="emoji-btn">😉</span><span class="emoji-btn">😊</span>
<span class="emoji-btn">😇</span><span class="emoji-btn">🥰</span><span class="emoji-btn">😍</span>
<span class="emoji-btn">🤩</span><span class="emoji-btn">😘</span><span class="emoji-btn">😗</span>
<span class="emoji-btn">😚</span><span class="emoji-btn">😙</span><span class="emoji-btn">😋</span>
<span class="emoji-btn">😛</span><span class="emoji-btn">😜</span><span class="emoji-btn">🤪</span>
</div>
<div id="people" class="emoji-category hidden">
<span class="emoji-btn">👋</span><span class="emoji-btn">🤚</span><span class="emoji-btn">🖐️</span>
<span class="emoji-btn">✋</span><span class="emoji-btn">🖖</span><span class="emoji-btn">👌</span>
<span class="emoji-btn">🤌</span><span class="emoji-btn">🤏</span><span class="emoji-btn">✌️</span>
<span class="emoji-btn">🤞</span><span class="emoji-btn">🤟</span><span class="emoji-btn">🤘</span>
<span class="emoji-btn">🤙</span><span class="emoji-btn">👈</span><span class="emoji-btn">👉</span>
<span class="emoji-btn">👆</span><span class="emoji-btn">🖕</span><span class="emoji-btn">👇</span>
<span class="emoji-btn">👍</span><span class="emoji-btn">👎</span><span class="emoji-btn">✊</span>
<span class="emoji-btn">👊</span><span class="emoji-btn">🤛</span><span class="emoji-btn">🤜</span>
</div>
<div id="animals" class="emoji-category hidden">
<span class="emoji-btn">🐶</span><span class="emoji-btn">🐱</span><span class="emoji-btn">🐭</span>
<span class="emoji-btn">🐹</span><span class="emoji-btn">🐰</span><span class="emoji-btn">🦊</span>
<span class="emoji-btn">🐻</span><span class="emoji-btn">🐼</span><span class="emoji-btn">🐻‍❄️</span>
<span class="emoji-btn">🐨</span><span class="emoji-btn">🐯</span><span class="emoji-btn">🦁</span>
<span class="emoji-btn">🐮</span><span class="emoji-btn">🐷</span><span class="emoji-btn">🐸</span>
<span class="emoji-btn">🐵</span><span class="emoji-btn">🐔</span><span class="emoji-btn">🐧</span>
<span class="emoji-btn">🐦</span><span class="emoji-btn">🐤</span><span class="emoji-btn">🦆</span>
<span class="emoji-btn">🦅</span><span class="emoji-btn">🦉</span><span class="emoji-btn">🦇</span>
</div>
<div id="food" class="emoji-category hidden">
<span class="emoji-btn">🍏</span><span class="emoji-btn">🍎</span><span class="emoji-btn">🍐</span>
<span class="emoji-btn">🍊</span><span class="emoji-btn">🍋</span><span class="emoji-btn">🍌</span>
<span class="emoji-btn">🍉</span><span class="emoji-btn">🍇</span><span class="emoji-btn">🍓</span>
<span class="emoji-btn">🫐</span><span class="emoji-btn">🍈</span><span class="emoji-btn">🍒</span>
<span class="emoji-btn">🍑</span><span class="emoji-btn">🥭</span><span class="emoji-btn">🍍</span>
<span class="emoji-btn">🥥</span><span class="emoji-btn">🥝</span><span class="emoji-btn">🍅</span>
<span class="emoji-btn">🍆</span><span class="emoji-btn">🥑</span><span class="emoji-btn">🥦</span>
<span class="emoji-btn">🥬</span><span class="emoji-btn">🥒</span><span class="emoji-btn">🌶️</span>
</div>
<div id="travel" class="emoji-category hidden">
<span class="emoji-btn">🚗</span><span class="emoji-btn">🚕</span><span class="emoji-btn">🚙</span>
<span class="emoji-btn">🚌</span><span class="emoji-btn">🚎</span><span class="emoji-btn">🏎️</span>
<span class="emoji-btn">🚓</span><span class="emoji-btn">🚑</span><span class="emoji-btn">🚒</span>
<span class="emoji-btn">🚐</span><span class="emoji-btn">🛻</span><span class="emoji-btn">🚚</span>
<span class="emoji-btn">🚛</span><span class="emoji-btn">🚜</span><span class="emoji-btn">🛵</span>
<span class="emoji-btn">🏍️</span><span class="emoji-btn">🛺</span><span class="emoji-btn">🚲</span>
<span class="emoji-btn">🛴</span><span class="emoji-btn">🚨</span><span class="emoji-btn">🚥</span>
<span class="emoji-btn">🚦</span><span class="emoji-btn">🛑</span><span class="emoji-btn">✈️</span>
</div>
<div id="activities" class="emoji-category hidden">
<span class="emoji-btn">⚽</span><span class="emoji-btn">🏀</span><span class="emoji-btn">🏈</span>
<span class="emoji-btn">⚾</span><span class="emoji-btn">🥎</span><span class="emoji-btn">🎾</span>
<span class="emoji-btn">🏐</span><span class="emoji-btn">🏉</span><span class="emoji-btn">🥏</span>
<span class="emoji-btn">🎱</span><span class="emoji-btn">🪀</span><span class="emoji-btn">🏓</span>
<span class="emoji-btn">🏸</span><span class="emoji-btn">🏒</span><span class="emoji-btn">🏑</span>
<span class="emoji-btn">🥍</span><span class="emoji-btn">🏏</span><span class="emoji-btn">🪃</span>
<span class="emoji-btn">🥅</span><span class="emoji-btn">⛳</span><span class="emoji-btn">🪁</span>
<span class="emoji-btn">🏹</span><span class="emoji-btn">🎣</span><span class="emoji-btn">🤿</span>
</div>
<div id="objects" class="emoji-category hidden">
<span class="emoji-btn">⌚</span><span class="emoji-btn">📱</span><span class="emoji-btn">💻</span>
<span class="emoji-btn">⌨️</span><span class="emoji-btn">🖥️</span><span class="emoji-btn">🖨️</span>
<span class="emoji-btn">🖱️</span><span class="emoji-btn">🖲️</span><span class="emoji-btn">🕹️</span>
<span class="emoji-btn">💽</span><span class="emoji-btn">💾</span><span class="emoji-btn">💿</span>
<span class="emoji-btn">📀</span><span class="emoji-btn">📼</span><span class="emoji-btn">📷</span>
<span class="emoji-btn">📸</span><span class="emoji-btn">📹</span><span class="emoji-btn">🎥</span>
<span class="emoji-btn">📽️</span><span class="emoji-btn">🎞️</span><span class="emoji-btn">📞</span>
<span class="emoji-btn">☎️</span><span class="emoji-btn">📟</span><span class="emoji-btn">📠</span>
</div>
<div id="symbols" class="emoji-category hidden">
<span class="emoji-btn">❤️</span><span class="emoji-btn">🧡</span><span class="emoji-btn">💛</span>
<span class="emoji-btn">💚</span><span class="emoji-btn">💙</span><span class="emoji-btn">💜</span>
<span class="emoji-btn">🖤</span><span class="emoji-btn">🤍</span><span class="emoji-btn">🤎</span>
<span class="emoji-btn">💔</span><span class="emoji-btn">❣️</span><span class="emoji-btn">💕</span>
<span class="emoji-btn">💞</span><span class="emoji-btn">💓</span><span class="emoji-btn">💗</span>
<span class="emoji-btn">💖</span><span class="emoji-btn">💘</span><span class="emoji-btn">💝</span>
<span class="emoji-btn">💟</span><span class="emoji-btn">☮️</span><span class="emoji-btn">✝️</span>
<span class="emoji-btn">☪️</span><span class="emoji-btn">🕉️</span><span class="emoji-btn">☸️</span>
</div>
</div>
</div>
</div>
<!-- Vista previa -->
<div class="mt-4">
<label class="text-sm text-gray-600 mb-1 block">Vista previa</label>
<div class="bg-[#E5DDD5] p-3 !rounded-button shadow-sm">
<div class="flex justify-end">
<div class="message-preview max-w-[90%] p-3">
<div id="previewText" class="text-sm break-words whitespace-pre-wrap overflow-hidden [&_code]:font-mono [&_code]:bg-gray-100 [&_code]:px-1 [&_code]:rounded [&_blockquote]:border-l-4 [&_blockquote]:border-primary [&_blockquote]:pl-2 [&_blockquote]:italic [&_a]:underline">Tu mensaje aparecerá aquí</div>
<p class="text-xs text-gray-500 text-right mt-1">10:25 AM</p>
</div>
</div>
</div>
</div>
<!-- Programar envío -->
<div class="mt-4">
<div class="flex items-center justify-between mb-3">
<div class="flex items-center">
<input type="checkbox" id="scheduleMessage" class="mr-2">
<label for="scheduleMessage" class="text-sm">Programar envío</label>
</div>
<button id="addScheduleBtn" class="hidden px-3 py-1 bg-primary text-white !rounded-button text-sm">
<i class="ri-add-line"></i> Agregar
</button>
</div>
<div id="scheduleOptions" class="hidden">
<div id="scheduledMessagesList" class="space-y-3 mb-3">
<!-- Scheduled messages will be added here -->
</div>
<p id="noScheduledMessages" class="text-sm text-gray-500 text-center py-3">No hay mensajes programados</p>
</div>
</div>
<!-- Botones de acción -->
<div class="flex gap-2 mt-4">
<button id="clearBtn" class="flex-1 py-3 bg-white border border-gray-300 text-gray-700 !rounded-button shadow-sm">
Limpiar
</button>
<button id="broadcastBtn" class="w-12 h-12 bg-primary text-white !rounded-button shadow-sm flex items-center justify-center">
<i class="ri-group-line ri-lg"></i>
</button>
<button id="bulkSendBtn" class="w-12 h-12 bg-primary text-white !rounded-button shadow-sm flex items-center justify-center">
<i class="ri-send-plane-fill ri-lg"></i>
</button>
<button id="sendBtn" class="flex-1 py-3 bg-primary text-white !rounded-button shadow-sm flex items-center justify-center gap-2">
<i class="ri-whatsapp-line ri-lg"></i>
Enviar
</button>
</div>
</main>
<!-- Finance Modal -->
<div id="financeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<div class="flex items-center gap-3">
<h3 class="text-lg font-semibold">Gestión financiera</h3>
<button id="statsBtn" class="w-8 h-8 flex items-center justify-center bg-primary text-white !rounded-button" title="Estadísticas">
<i class="ri-bar-chart-2-line"></i>
</button>
</div>
<button id="closeFinance" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="incomeTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Ingresos</button>
<button id="expenseTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Gastos</button>
</div>
<div class="bg-gray-50 p-3 !rounded-button mb-4">
<div class="grid grid-cols-2 gap-3">
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Ingresos totales</p>
<p class="text-lg font-medium text-green-500" id="totalIncome">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Gastos totales</p>
<p class="text-lg font-medium text-red-500" id="totalExpense">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Balance</p>
<p class="text-lg font-medium text-primary" id="totalBalance">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Transacciones</p>
<p class="text-lg font-medium text-primary" id="totalTransactions">0</p>
</div>
</div>
</div>
<div class="mb-4">
<button id="addTransactionBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Nueva transacción
</button>
</div>
<div id="transactionsList" class="max-h-[40vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay transacciones registradas</p>
</div>
</div>
</div>
<!-- Add Transaction Modal -->
<div id="addTransactionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nueva transacción</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Tipo</label>
<div class="flex gap-2">
<button id="incomeTypeBtn" class="flex-1 py-2 bg-primary text-white !rounded-button text-sm">Ingreso</button>
<button id="expenseTypeBtn" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-button text-sm">Gasto</button>
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Descripción</label>
<input type="text" id="transactionDescription" placeholder="Ej: Venta de productos" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Monto</label>
<div class="flex gap-2">
<select id="transactionCurrency" class="w-24 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="PEN">S/</option>
<option value="USD">$</option>
<option value="EUR">€</option>
</select>
<input type="number" id="transactionAmount" placeholder="0.00" step="0.01" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Categoría</label>
<select id="transactionCategory" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar categoría</option>
<optgroup label="Ingresos">
<option value="sales">Ventas</option>
<option value="services">Servicios</option>
<option value="commissions">Comisiones</option>
<option value="others_income">Otros ingresos</option>
</optgroup>
<optgroup label="Egresos">
<option value="supplies">Insumos</option>
<option value="services_expense">Servicios</option>
<option value="salaries">Sueldos</option>
<option value="rent">Alquiler</option>
<option value="others_expense">Otros gastos</option>
</optgroup>
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Fecha</label>
<input type="datetime-local" id="transactionDate" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas adicionales</label>
<textarea id="transactionNotes" rows="2" placeholder="Detalles adicionales..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
</div>
<div class="flex justify-end gap-2">
<button id="cancelTransaction" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="saveTransaction" class="px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
</div>
<!-- Modal para guardar mensaje -->
<div id="saveMessageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Guardar mensaje</h3>
<input type="text" id="messageTitle" placeholder="Título del mensaje" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3">
<div class="flex justify-end gap-2">
<button id="cancelSaveMessage" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmSaveMessage" class="px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
</div>
<!-- Quick Replies Modal -->
<div id="quickRepliesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Respuestas rápidas</h3>
<button id="closeQuickReplies" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-2 mb-4">
<button class="quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
👋 ¡Hola! ¿En qué puedo ayudarte?
</button>
<button class="quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
✨ Gracias por tu mensaje. En breve te respondo.
</button>
<button class="quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
📅 ¿Te gustaría agendar una cita?
</button>
<button class="quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
💼 Horario de atención: Lun-Vie 9:00-18:00
</button>
<button class="quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
🙏 Gracias por tu preferencia
</button>
</div>
<div class="flex justify-between items-center">
<button id="addQuickReplyBtn" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
<i class="ri-add-line"></i> Nueva respuesta
</button>
<div class="flex gap-2">
<button id="addTemplateBtn" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
<i class="ri-file-list-line"></i> Plantilla
</button>
<button id="addGroupBtn" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
<i class="ri-group-line"></i> Grupos
</button>
<button id="editQuickRepliesBtn" class="px-3 py-1 bg-gray-100 text-gray-600 !rounded-button text-sm">
<i class="ri-edit-line"></i> Editar
</button>
</div>
</div>
</div>
</div>
<!-- Template Modal -->
<div id="groupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Grupos de contactos</h3>
<button id="closeGroup" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<div class="bg-gray-50 p-3 !rounded-button">
<div class="flex justify-between items-center mb-2">
<p class="text-sm font-medium">Mis grupos</p>
<button id="createGroupBtn" class="px-2 py-1 bg-primary text-white !rounded-button text-xs">
<i class="ri-add-line"></i> Crear grupo
</button>
</div>
<div id="groupsList" class="space-y-2">
<p class="text-sm text-gray-500 text-center">No hay grupos creados</p>
</div>
</div>
</div>
</div>
</div>
<div id="templateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Plantillas de mensaje</h3>
<button id="closeTemplate" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<div class="bg-gray-50 p-3 !rounded-button">
<p class="text-sm mb-2">Variables disponibles:</p>
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">{nombre}</span>
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">{fecha}</span>
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">{hora}</span>
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">{empresa}</span>
</div>
</div>
<div class="space-y-2">
<button class="template-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
¡Hola {nombre}! Gracias por contactarnos.
</button>
<button class="template-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
Estimado/a {nombre}, su cita está programada para el {fecha} a las {hora}.
</button>
<button class="template-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
Bienvenido/a a {empresa}. ¿En qué podemos ayudarte?
</button>
</div>
</div>
<div class="flex justify-between items-center">
<button id="addNewTemplateBtn" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
<i class="ri-add-line"></i> Nueva plantilla
</button>
<button id="editTemplatesBtn" class="px-3 py-1 bg-gray-100 text-gray-600 !rounded-button text-sm">
<i class="ri-edit-line"></i> Editar
</button>
</div>
</div>
</div>
<!-- Analytics Modal -->
<div id="analyticsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Análisis de mensajes</h3>
<button id="closeAnalytics" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="bg-gray-50 p-3 !rounded-button">
<h4 class="text-sm font-medium mb-2">Resumen general</h4>
<div class="grid grid-cols-2 gap-3">
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Mensajes enviados</p>
<p class="text-lg font-medium text-primary" id="totalSentMessages">0</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Programados</p>
<p class="text-lg font-medium text-primary" id="totalScheduledMessages">0</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Contactos</p>
<p class="text-lg font-medium text-primary" id="totalContacts">0</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Plantillas</p>
<p class="text-lg font-medium text-primary" id="totalTemplates">0</p>
</div>
</div>
</div>
<div class="bg-gray-50 p-3 !rounded-button">
<h4 class="text-sm font-medium mb-2">Actividad reciente</h4>
<div id="activityChart" class="w-full h-48 bg-white !rounded-button"></div>
</div>
<div class="bg-gray-50 p-3 !rounded-button">
<h4 class="text-sm font-medium mb-2">Contactos más frecuentes</h4>
<div id="topContacts" class="space-y-2">
<div class="animate-pulse">
<div class="h-4 bg-gray-200 !rounded-button w-3/4"></div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Stats Modal -->
<div id="statsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Estadísticas</h3>
<button id="closeStats" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="totalStatsTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Total</button>
<button id="monthlyStatsTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Mensual</button>
<button id="weeklyStatsTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Semanal</button>
<button id="dailyStatsTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Diario</button>
</div>
<div class="mb-4">
<div class="relative">
<input type="text" id="statsDatePicker" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm" readonly>
<i class="ri-calendar-line absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
</div>
</div>
<div class="space-y-4">
<div class="bg-gray-50 p-3 !rounded-button">
<h4 class="text-sm font-medium mb-2">Resumen financiero</h4>
<div class="grid grid-cols-2 gap-3">
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Ingresos</p>
<p class="text-lg font-medium text-green-500" id="statsIncome">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Gastos</p>
<p class="text-lg font-medium text-red-500" id="statsExpense">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Balance</p>
<p class="text-lg font-medium text-primary" id="statsBalance">S/ 0.00</p>
</div>
<div class="bg-white p-2 !rounded-button">
<p class="text-xs text-gray-500">Transacciones</p>
<p class="text-lg font-medium text-primary" id="statsTransactions">0</p>
</div>
</div>
</div>
<div class="bg-gray-50 p-3 !rounded-button">
<h4 class="text-sm font-medium mb-2">Gráfico de ingresos vs gastos</h4>
<div id="statsChart" class="w-full h-48 bg-white !rounded-button"></div>
</div>
<div class="bg-gray-50 p-3 !rounded-button hidden">
<h4 class="text-sm font-medium mb-2">Top categorías</h4>
<div id="statsCategories" class="space-y-2">
<div class="animate-pulse">
<div class="h-4 bg-gray-200 !rounded-button w-3/4"></div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Import Contacts Modal -->
<div id="importContactsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Importar contactos</h3>
<button id="closeImportContacts" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="bg-gray-50 p-3 !rounded-button">
<p class="text-sm mb-2">Formatos soportados:</p>
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">CSV</span>
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">TXT</span>
<span class="px-2 py-1 bg-white !rounded-button text-xs text-primary">XLSM</span>
</div>
</div>
<div class="bg-gray-50 p-3 !rounded-button">
<p class="text-sm mb-2">Formato requerido:</p>
<code class="text-xs block bg-white p-2 !rounded-button">
+[código país] [número]
</code>
<p class="text-xs text-gray-500 mt-2">Ejemplo: +51 973 356 794</p>
<p class="text-xs text-gray-500">Ejemplo: +52 1 392 122 0656</p>
</div>
<div class="flex flex-col items-center justify-center p-4 border-2 border-dashed border-gray-300 !rounded-button">
<i class="ri-upload-cloud-line ri-2x text-gray-400 mb-2"></i>
<p class="text-sm text-gray-600 mb-2">Arrastra tu archivo aquí o</p>
<input type="file" id="fileInput" accept=".csv,.txt,.xlsm" class="hidden">
<button id="selectFileBtn" class="px-4 py-2 bg-primary text-white !rounded-button text-sm">Seleccionar archivo</button>
</div>
<div id="importPreview" class="hidden">
<div class="flex items-center gap-2 mb-2">
<i class="ri-file-text-line text-primary"></i>
<span id="fileName" class="text-sm"></span>
<button id="removeFile" class="ml-auto text-red-500">
<i class="ri-close-line"></i>
</button>
</div>
<button id="importBtn" class="w-full px-4 py-2 bg-primary text-white !rounded-button text-sm">
Importar contactos
</button>
</div>
</div>
</div>
</div>
<!-- Radio Modal -->
<div id="radioModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Radio Online</h3>
<button id="closeRadio" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="mb-4">
<button id="addStationBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Agregar estación
</button>
</div>
<div id="stationsList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay estaciones agregadas</p>
</div>
</div>
</div>
<!-- AI Sales Closing Modal -->
<div id="aiClosingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Generador de cierres de venta</h3>
<div class="flex items-center gap-2">
<button id="autoGenerateBtn" class="w-8 h-8 flex items-center justify-center bg-primary text-white !rounded-button">
<i class="ri-magic-line"></i>
</button>
<button id="clearAiClosingBtn" class="w-8 h-8 flex items-center justify-center bg-gray-100 text-gray-600 !rounded-button">
<i class="ri-eraser-line"></i>
</button>
<button id="closeAiClosing" class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 !rounded-button text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
</div>
<div class="space-y-4">
<div>
<input type="text" id="productInput" placeholder="Escribir nombre del producto" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Características principales</label>
<textarea id="featuresInput" rows="3" placeholder="Ej: Clases en vivo, profesores nativos, horarios flexibles..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Estilo del mensaje</label>
<select id="styleSelect" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="professional">Profesional y formal</option>
<option value="friendly">Amigable y cercano</option>
<option value="urgent">Urgente y persuasivo</option>
<option value="exclusive">Exclusivo y premium</option>
</select>
</div>
<button id="generateClosingBtn" class="w-full py-2 bg-primary text-white !rounded-button">
Generar cierre de venta
</button>
<div id="closingResult" class="bg-gray-50 p-3 !rounded-button hidden">
<div id="closingText" class="text-sm mb-2"></div>
<button id="useClosingBtn" class="w-full py-2 bg-primary text-white !rounded-button mt-3">
Usar este mensaje
</button>
</div>
</div>
</div>
</div>
<!-- Toast notifications -->
<div id="toast" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 !rounded-button shadow-lg z-50 hidden mx-4 w-auto max-w-[90%]">
<p id="toastMessage">Mensaje copiado</p>
</div>
<!-- Catalog Modal -->
<div id="catalogModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Catálogo de productos</h3>
<button id="closeCatalog" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="productsTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Productos</button>
<button id="categoriesTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Categorías</button>
</div>
<div class="mb-4">
<button id="addProductBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Agregar producto
</button>
</div>
<div id="productsList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay productos agregados</p>
</div>
</div>
</div>
<!-- Orders Modal -->
<div id="ordersModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestión de pedidos</h3>
<button id="closeOrders" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="pendingOrdersTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Pendientes</button>
<button id="completedOrdersTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Completados</button>
</div>
<div id="ordersList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay pedidos pendientes</p>
</div>
</div>
</div>
<!-- Restaurant Orders Modal -->
<div id="restaurantModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<div class="flex items-center gap-3">
<h3 class="text-lg font-semibold">Gestión de Comandas</h3>
<button id="manageProductsBtn" class="w-8 h-8 flex items-center justify-center bg-primary text-white !rounded-button" title="Gestionar productos">
<i class="ri-restaurant-2-line"></i>
</button>
</div>
<button id="closeRestaurant" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="activeOrdersTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Activas</button>
</div>
<div class="mb-4">
<button id="newOrderBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Nueva Comanda
</button>
</div>
<div id="tableGrid" class="grid grid-cols-3 gap-2 mb-4">
<!-- Tables will be dynamically added here -->
</div>
<div id="activeOrdersList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay comandas activas</p>
</div>
</div>
</div>
<!-- New Order Modal -->
<div id="newOrderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Nueva Comanda</h3>
<button id="closeNewOrder" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Mesa</label>
<select id="tableSelect" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar mesa</option>
<!-- Tables will be dynamically added -->
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Productos</label>
<div id="productList" class="space-y-2 max-h-48 overflow-y-auto">
<!-- Products will be dynamically added -->
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas</label>
<textarea id="orderNotes" rows="2" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
</div>
<div class="flex justify-end gap-2 mt-4">
<button id="cancelNewOrder" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmNewOrder" class="px-4 py-2 bg-primary text-white !rounded-button">Crear Comanda</button>
</div>
</div>
</div>
<!-- Order Details Modal -->
<div id="orderDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Detalles de la Comanda</h3>
<button id="closeOrderDetails" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div id="orderDetailsContent" class="space-y-4">
<!-- Order details will be dynamically added -->
</div>
</div>
</div>
<!-- CRM Modal -->
<div id="crmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestión de clientes</h3>
<button id="closeCrm" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="mb-4">
<div class="relative">
<i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
<input type="text" id="crmSearch" placeholder="Buscar cliente..." class="w-full pl-9 pr-3 py-2 bg-gray-50 border-none !rounded-button text-sm">
</div>
</div>
<div id="crmClientsList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay clientes registrados</p>
</div>
</div>
</div>
<!-- Task Modal -->
<!-- Calendar Manager Modal -->
<div id="calendarModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Calendario de citas</h3>
<button id="closeCalendar" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="dayViewBtn" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Día</button>
<button id="weekViewBtn" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Semana</button>
<button id="monthViewBtn" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Mes</button>
</div>
<div class="flex justify-between items-center mb-4">
<button id="prevDateBtn" class="w-8 h-8 flex items-center justify-center bg-gray-100 !rounded-button">
<i class="ri-arrow-left-s-line"></i>
</button>
<h4 id="currentDateDisplay" class="text-sm font-medium">Mayo 2025</h4>
<button id="nextDateBtn" class="w-8 h-8 flex items-center justify-center bg-gray-100 !rounded-button">
<i class="ri-arrow-right-s-line"></i>
</button>
</div>
<div id="calendarGrid" class="mb-4">
<!-- Calendar grid will be dynamically populated -->
</div>
<button id="addAppointmentBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Nueva cita
</button>
</div>
</div>
<!-- Add Appointment Modal -->
<div id="addAppointmentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nueva cita</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Cliente</label>
<select id="appointmentClient" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar cliente</option>
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Fecha y hora</label>
<input type="datetime-local" id="appointmentDateTime" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Duración</label>
<select id="appointmentDuration" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="30">30 minutos</option>
<option value="60">1 hora</option>
<option value="90">1 hora 30 minutos</option>
<option value="120">2 horas</option>
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 flex justify-between items-center">
<span>Tipo de cita</span>
<button id="editAppointmentTypes" class="text-primary text-xs flex items-center gap-1">
<i class="ri-edit-line"></i> Editar tipos
</button>
</label>
<select id="appointmentType" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas</label>
<textarea id="appointmentNotes" rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
<div class="space-y-2">
<div class="flex items-center gap-2">
<input type="checkbox" id="sendReminder" checked>
<label for="sendReminder" class="text-sm">Enviar recordatorio 1 hora antes</label>
</div>
<div class="flex items-center gap-2">
<input type="checkbox" id="isRecurring">
<label for="isRecurring" class="text-sm">Cita recurrente</label>
</div>
<div id="recurringOptions" class="hidden space-y-2 pl-6">
<div class="flex items-center gap-2">
<select id="recurringMonths" class="px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="1">1 mes</option>
<option value="2">2 meses</option>
<option value="3">3 meses</option>
<option value="4">4 meses</option>
<option value="5">5 meses</option>
<option value="6">6 meses</option>
<option value="7">7 meses</option>
<option value="8">8 meses</option>
<option value="9">9 meses</option>
<option value="10">10 meses</option>
<option value="11">11 meses</option>
<option value="12">12 meses</option>
</select>
<span class="text-sm text-gray-600">de repetición</span>
</div>
<p class="text-xs text-gray-500">La cita se repetirá mensualmente en la misma fecha y hora</p>
</div>
</div>
</div>
<div class="flex justify-end gap-2">
<button id="cancelAppointment" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="saveAppointment" class="px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
</div>
<div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Tareas del cliente</h3>
<button id="closeTask" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2 hidden">
<i class="ri-message-2-line text-primary"></i>
Enviar mensaje
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-message-3-line text-primary"></i>
Enviar SMS
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-flag-line text-primary"></i>
Hacer seguimiento
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-phone-line text-primary"></i>
Llamar
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-file-text-line text-primary"></i>
Enviar propuesta
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-coupon-line text-primary"></i>
Dar promoción/descuento
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-sticky-note-line text-primary"></i>
Agregar nota
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-notification-line text-primary"></i>
Programar recordatorio
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-file-list-3-line text-primary"></i>
Crear proforma
</button>
<button class="task-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm flex items-center gap-2">
<i class="ri-calendar-check-line text-primary"></i>
Agendar cita
</button>
</div>
</div>
</div>
<!-- Tools Modal -->
<div id="toolsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Herramientas</h3>
<button id="closeTools" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="grid grid-cols-2 gap-3">
<button class="tool-btn flex flex-col items-center justify-center p-3 bg-gray-50 hover:bg-gray-100 !rounded-button" onclick="showSMSModal()">
<i class="ri-message-2-line text-primary ri-xl mb-1"></i>
<span class="text-xs">SMS</span>
</button>
<button class="tool-btn flex flex-col items-center justify-center p-3 bg-gray-50 hover:bg-gray-100 !rounded-button" onclick="showCalculator()">
<i class="ri-calculator-line text-primary ri-xl mb-1"></i>
<span class="text-xs">Calculadora</span>
</button>
</div>
</div>
</div>
<!-- History Modal -->
<div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-4">
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Historial de mensajes</h3>
<button id="closeHistory" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="flex gap-2 mb-4">
<button id="sentHistoryTab" class="flex-1 py-2 bg-primary text-white !rounded-full text-sm">Enviados</button>
<button id="scheduledHistoryTab" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-full text-sm">Programados</button>
</div>
<div id="historyList" class="max-h-[60vh] overflow-y-auto space-y-3">
<p class="text-sm text-gray-500 text-center py-3">No hay mensajes enviados</p>
</div>
<div id="scheduledHistoryList" class="max-h-[60vh] overflow-y-auto space-y-3 hidden">
<p class="text-sm text-gray-500 text-center py-3">No hay mensajes programados</p>
</div>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
let isUnlocked = localStorage.getItem('isUnlocked') === 'true';
let timerInterval;
let isWindowClosed = false;
window.addEventListener('beforeunload', () => {
if (!isUnlocked) {
isWindowClosed = true;
localStorage.removeItem('isUnlocked');
}
});
function startTimer() {
if (isUnlocked) return;
let timeLeft = 60;
const timerElement = document.getElementById('timer');
if (isWindowClosed) {
timeLeft = 60;
isWindowClosed = false;
}
timerInterval = setInterval(() => {
timeLeft--;
const minutes = Math.floor(timeLeft / 60);
const seconds = timeLeft % 60;
timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
if (timeLeft <= 0) {
clearInterval(timerInterval);
showAuthPopup();
}
}, 1000);
}
function showAuthPopup() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[100] px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Autenticación requerida</h3>
<button id="closeAuthBtn" class="text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<input type="text" id="authUsername" placeholder="Usuario" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<input type="password" id="authPassword" placeholder="Contraseña" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<button id="authSubmit" class="w-full py-2 bg-primary text-white !rounded-button">Desbloquear</button>
<p class="text-xs text-gray-500 text-center mt-3">¿Necesitas acceso? <a href="https://wa.link/acmga9" data-readdy="true" class="text-primary">Solicitar acceso al Desarrollador</a></p>
</div>
`;
document.body.appendChild(modal);
const authSubmit = modal.querySelector('#authSubmit');
const authUsername = modal.querySelector('#authUsername');
const authPassword = modal.querySelector('#authPassword');
const closeAuthBtn = modal.querySelector('#closeAuthBtn');
closeAuthBtn.addEventListener('click', () => {
document.body.removeChild(modal);
if (!isUnlocked) {
startTimer();
}
});
authSubmit.addEventListener('click', () => {
if (authUsername.value === 'admin' && authPassword.value === '741852963') {
isUnlocked = true;
localStorage.setItem('isUnlocked', 'true');
document.body.removeChild(modal);
showToast('Aplicación desbloqueada');
} else {
showToast('Credenciales incorrectas');
authUsername.value = '';
authPassword.value = '';
authUsername.classList.add('border-red-500');
authPassword.classList.add('border-red-500');
setTimeout(() => {
authUsername.classList.remove('border-red-500');
authPassword.classList.remove('border-red-500');
}, 2000);
}
});
}
startTimer();
let appointments = JSON.parse(localStorage.getItem('whatsappAppointments')) || [];
let currentView = 'day';
let currentDate = new Date();
let appointmentTypes = JSON.parse(localStorage.getItem('whatsappAppointmentTypes')) || [
{
id: 'consultation',
name: 'Consulta',
messageTemplate: '🏥 *CONFIRMACIÓN DE CONSULTA*\n\nHola {clientName},\n\nTu consulta ha sido programada para:\n\n📅 Fecha: {date}\n⏰ Hora: {time}\n⏱️ Duración: {duration} minutos\n\nPor favor, llega 10 minutos antes de tu cita. Si necesitas reprogramar, avísanos con anticipación.\n\nTe esperamos!'
},
{
id: 'followup',
name: 'Seguimiento',
messageTemplate: '👨‍⚕️ *CITA DE SEGUIMIENTO*\n\nHola {clientName},\n\nTu cita de seguimiento está programada para:\n\n📅 Fecha: {date}\n⏰ Hora: {time}\n⏱️ Duración: {duration} minutos\n\nRecuerda traer tus resultados y exámenes previos.\n\n¡Nos vemos pronto!'
},
{
id: 'treatment',
name: 'Tratamiento',
messageTemplate: '💊 *SESIÓN DE TRATAMIENTO*\n\nHola {clientName},\n\nTu sesión de tratamiento está agendada para:\n\n📅 Fecha: {date}\n⏰ Hora: {time}\n⏱️ Duración: {duration} minutos\n\nRecuerda seguir las indicaciones previas al tratamiento.\n\n¡Te esperamos!'
}
];
function updateAppointmentTypeSelect() {
const select = document.getElementById('appointmentType');
select.innerHTML = appointmentTypes.map(type =>
`<option value="${type.id}">${type.name}</option>`
).join('');
}
document.getElementById('editAppointmentTypes').addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Tipos de cita</h3>
<button class="close-types text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4" id="appointmentTypesList">
${appointmentTypes.map(type => `
<div class="bg-gray-50 p-3 !rounded-button">
<div class="flex justify-between items-start mb-2">
<input type="text" value="${type.name}" class="type-name px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm" data-id="${type.id}">
<button onclick="deleteAppointmentType('${type.id}')" class="delete-type text-red-500 p-1" data-id="${type.id}">
<i class="ri-delete-bin-line"></i>
</button>
</div>
<textarea class="message-template w-full px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm resize-none" rows="4" data-id="${type.id}">${type.messageTemplate}</textarea>
<div class="text-xs text-gray-500 mt-2">
Variables disponibles: {clientName}, {date}, {time}, {duration}
</div>
</div>
`).join('')}
</div>
<div class="flex justify-between items-center">
<button id="addNewType" class="px-3 py-1 bg-primary text-white !rounded-button text-sm flex items-center gap-1">
<i class="ri-add-line"></i> Nuevo tipo
</button>
<button id="saveTypes" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">Guardar cambios</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-types').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('#addNewType').addEventListener('click', () => {
const newType = {
id: 'type_' + Date.now(),
name: 'Nuevo tipo',
messageTemplate: '📅 *CONFIRMACIÓN DE CITA*\n\nHola {clientName},\n\nTu cita está programada para:\n\n📅 Fecha: {date}\n⏰ Hora: {time}\n⏱️ Duración: {duration} minutos'
};
appointmentTypes.push(newType);
const typesList = modal.querySelector('#appointmentTypesList');
const typeElement = document.createElement('div');
typeElement.className = 'bg-gray-50 p-3 !rounded-button';
typeElement.innerHTML = `
<div class="flex justify-between items-start mb-2">
<input type="text" value="${newType.name}" class="type-name px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm" data-id="${newType.id}">
<button class="delete-type text-red-500 p-1" data-id="${newType.id}">
<i class="ri-delete-bin-line"></i>
</button>
</div>
<textarea class="message-template w-full px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm resize-none" rows="4" data-id="${newType.id}">${newType.messageTemplate}</textarea>
<div class="text-xs text-gray-500 mt-2">
Variables disponibles: {clientName}, {date}, {time}, {duration}
</div>
`;
typesList.appendChild(typeElement);
});
modal.querySelector('#saveTypes').addEventListener('click', () => {
const typeNames = modal.querySelectorAll('.type-name');
const messageTemplates = modal.querySelectorAll('.message-template');
appointmentTypes = Array.from(typeNames).map(input => ({
id: input.dataset.id,
name: input.value,
messageTemplate: modal.querySelector(`.message-template[data-id="${input.dataset.id}"]`).value
}));
localStorage.setItem('whatsappAppointmentTypes', JSON.stringify(appointmentTypes));
updateAppointmentTypeSelect();
document.body.removeChild(modal);
showToast('Tipos de cita actualizados');
});
window.deleteAppointmentType = function(typeId) {
if (appointmentTypes.length <= 1) {
showToast('Debe existir al menos un tipo de cita');
return;
}
appointmentTypes = appointmentTypes.filter(type => type.id !== typeId);
localStorage.setItem('whatsappAppointmentTypes', JSON.stringify(appointmentTypes));
document.querySelector(`.bg-gray-50[data-id="${typeId}"]`).remove();
updateAppointmentTypeSelect();
};
modal.querySelector('#appointmentTypesList').innerHTML = appointmentTypes.map(type => `
<div class="bg-gray-50 p-3 !rounded-button" data-id="${type.id}">
<div class="flex justify-between items-start mb-2">
<input type="text" value="${type.name}" class="type-name px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm" data-id="${type.id}">
<button onclick="deleteAppointmentType('${type.id}')" class="delete-type text-red-500 p-1" data-id="${type.id}">
<i class="ri-delete-bin-line"></i>
</button>
</div>
<textarea class="message-template w-full px-2 py-1 bg-white border border-gray-300 !rounded-button text-sm resize-none" rows="4" data-id="${type.id}">${type.messageTemplate}</textarea>
<div class="text-xs text-gray-500 mt-2">
Variables disponibles: {clientName}, {date}, {time}, {duration}
</div>
</div>
`).join('');
});
updateAppointmentTypeSelect();
window.showCalendarManager = function() {
const calendarModal = document.getElementById('calendarModal');
calendarModal.classList.remove('hidden');
updateCalendarView();
populateClientSelect();
};
document.getElementById('closeCalendar').addEventListener('click', function() {
document.getElementById('calendarModal').classList.add('hidden');
});
document.getElementById('dayViewBtn').addEventListener('click', function() {
currentView = 'day';
updateViewButtons();
updateCalendarView();
});
document.getElementById('weekViewBtn').addEventListener('click', function() {
currentView = 'week';
updateViewButtons();
updateCalendarView();
});
document.getElementById('monthViewBtn').addEventListener('click', function() {
currentView = 'month';
updateViewButtons();
updateCalendarView();
});
document.getElementById('prevDateBtn').addEventListener('click', function() {
switch(currentView) {
case 'day':
currentDate.setDate(currentDate.getDate() - 1);
break;
case 'week':
currentDate.setDate(currentDate.getDate() - 7);
break;
case 'month':
currentDate.setMonth(currentDate.getMonth() - 1);
break;
}
updateCalendarView();
});
document.getElementById('nextDateBtn').addEventListener('click', function() {
switch(currentView) {
case 'day':
currentDate.setDate(currentDate.getDate() + 1);
break;
case 'week':
currentDate.setDate(currentDate.getDate() + 7);
break;
case 'month':
currentDate.setMonth(currentDate.getMonth() + 1);
break;
}
updateCalendarView();
});
document.getElementById('addAppointmentBtn').addEventListener('click', function() {
document.getElementById('addAppointmentModal').classList.remove('hidden');
});
document.getElementById('cancelAppointment').addEventListener('click', function() {
document.getElementById('addAppointmentModal').classList.add('hidden');
});
document.getElementById('isRecurring').addEventListener('change', function() {
const recurringOptions = document.getElementById('recurringOptions');
recurringOptions.classList.toggle('hidden', !this.checked);
});
document.getElementById('saveAppointment').addEventListener('click', function() {
const clientId = document.getElementById('appointmentClient').value;
const dateTime = document.getElementById('appointmentDateTime').value;
const duration = document.getElementById('appointmentDuration').value;
const type = document.getElementById('appointmentType').value;
const notes = document.getElementById('appointmentNotes').value;
const sendReminder = document.getElementById('sendReminder').checked;
const isRecurring = document.getElementById('isRecurring').checked;
const recurringMonths = isRecurring ? parseInt(document.getElementById('recurringMonths').value) : 0;
if (!clientId || !dateTime) {
showToast('Por favor completa los campos requeridos');
return;
}
const client = savedPhones.find(p => p.id === clientId);
if (!client) return;
const baseAppointment = {
clientId,
duration: parseInt(duration),
type,
notes,
reminder: sendReminder,
status: 'scheduled',
isRecurring,
recurringMonths
};
if (isRecurring) {
const seriesId = Date.now();
const startDate = new Date(dateTime);
// Create recurring appointments
for (let i = 0; i < recurringMonths; i++) {
const appointmentDate = new Date(startDate);
appointmentDate.setMonth(appointmentDate.getMonth() + i);
const appointment = {
...baseAppointment,
id: Date.now() + i,
dateTime: appointmentDate.toISOString(),
seriesId: seriesId
};
appointments.push(appointment);
}
showToast(`Serie de ${recurringMonths} citas programada`);
} else {
const appointment = {
...baseAppointment,
id: Date.now(),
dateTime
};
appointments.push(appointment);
}
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
document.getElementById('addAppointmentModal').classList.add('hidden');
updateCalendarView();
showToast('Cita agendada');
});
function scheduleReminder(appointment, client) {
const reminderTime = new Date(appointment.dateTime);
reminderTime.setHours(reminderTime.getHours() - 1);
const reminder = {
id: Date.now(),
clientId: client.id,
title: `Recordatorio de cita: ${appointment.type}`,
details: `Tienes una cita programada para hoy a las ${new Date(appointment.dateTime).toLocaleTimeString()}`,
datetime: reminderTime.toISOString(),
status: 'pending'
};
const reminders = JSON.parse(localStorage.getItem('whatsappReminders')) || [];
reminders.push(reminder);
localStorage.setItem('whatsappReminders', JSON.stringify(reminders));
const message = `*CONFIRMACIÓN DE CITA*\n\nHola ${client.name},\n\nTu cita ha sido programada para:\n\n📅 Fecha: ${new Date(appointment.dateTime).toLocaleDateString()}\n⏰ Hora: ${new Date(appointment.dateTime).toLocaleTimeString()}\n⏱️ Duración: ${appointment.duration} minutos\n📝 Tipo: ${appointment.type}${appointment.notes ? `\n\nNotas:\n${appointment.notes}` : ''}`;
messageText.value = message;
updatePreview();
}
function updateViewButtons() {
const buttons = {
'day': document.getElementById('dayViewBtn'),
'week': document.getElementById('weekViewBtn'),
'month': document.getElementById('monthViewBtn')
};
Object.entries(buttons).forEach(([view, button]) => {
if (view === currentView) {
button.classList.remove('bg-gray-100', 'text-gray-600');
button.classList.add('bg-primary', 'text-white');
} else {
button.classList.remove('bg-primary', 'text-white');
button.classList.add('bg-gray-100', 'text-gray-600');
}
});
}
function updateCalendarView() {
const dateDisplay = document.getElementById('currentDateDisplay');
const calendarGrid = document.getElementById('calendarGrid');
const options = { year: 'numeric', month: 'long', day: 'numeric' };
switch(currentView) {
case 'day':
dateDisplay.textContent = currentDate.toLocaleDateString(undefined, options);
renderDayView(calendarGrid);
break;
case 'week':
const weekStart = new Date(currentDate);
weekStart.setDate(weekStart.getDate() - weekStart.getDay());
const weekEnd = new Date(weekStart);
weekEnd.setDate(weekEnd.getDate() + 6);
dateDisplay.textContent = `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;
renderWeekView(calendarGrid);
break;
case 'month':
dateDisplay.textContent = currentDate.toLocaleDateString(undefined, { year: 'numeric', month: 'long' });
renderMonthView(calendarGrid);
break;
}
}
function renderDayView(container) {
const dayAppointments = appointments.filter(app => {
const appDate = new Date(app.dateTime);
return appDate.toDateString() === currentDate.toDateString();
});
dayAppointments.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
container.innerHTML = `
<div class="space-y-2">
${dayAppointments.map(app => {
const client = savedPhones.find(p => p.id === app.clientId);
const time = new Date(app.dateTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
const isExpired = new Date(app.dateTime) < new Date();
return `
<div class="${isExpired ? 'bg-red-100' : 'bg-primary/10'} p-3 !rounded-button cursor-pointer" onclick="showAppointmentDetails(${app.id})">
<div class="flex justify-between items-start">
<div>
<p class="text-sm font-medium">${time} - ${client?.name || 'Cliente'}</p>
<div class="flex items-center gap-2">
<p class="text-xs ${isExpired ? 'text-red-500' : 'text-gray-500'}">${app.type} (${app.duration} min)</p>
${isExpired ? '<span class="text-xs text-red-500 font-medium">Vencido</span>' : ''}
</div>
</div>
<div class="flex gap-2">
<button onclick="event.stopPropagation(); editAppointment(${app.id})" class="${isExpired ? 'text-red-500' : 'text-primary'}">
<i class="ri-edit-line"></i>
</button>
</div>
</div>
${app.notes ? `<p class="text-xs ${isExpired ? 'text-red-400' : 'text-gray-600'} mt-1">${app.notes}</p>` : ''}
</div>
`;
}).join('')}
</div>
`;
}
window.showAppointmentDetails = function(appointmentId) {
const appointment = appointments.find(app => app.id === appointmentId);
if (!appointment) return;
const client = savedPhones.find(p => p.id === appointment.clientId);
const appointmentDate = new Date(appointment.dateTime);
const formattedDate = appointmentDate.toLocaleDateString(undefined, {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});
const formattedTime = appointmentDate.toLocaleTimeString([], {
hour: '2-digit',
minute: '2-digit'
});
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="showDeleteOptions(${appointmentId}, ${seriesId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="deleteSingleAppointment(${appointmentId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar esta cita
</button>
${seriesId ? `
<button onclick="deleteRecurringAppointments(${seriesId})" class="w-full px-3 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-2-line"></i>
Eliminar todas las citas recurrentes
</button>
` : ''}
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.deleteSingleAppointment = function(id) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar esta cita? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDelete" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDelete" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDelete').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDelete').addEventListener('click', () => {
appointments = appointments.filter(app => app.id !== id);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Cita eliminada');
});
};
window.deleteRecurringAppointments = function(seriesId) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar todas las citas de esta serie? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDeleteSeries" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDeleteSeries" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDeleteSeries').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDeleteSeries').addEventListener('click', () => {
appointments = appointments.filter(app => app.seriesId !== seriesId);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Serie de citas eliminada');
});
};
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-start mb-4">
<h3 class="text-lg font-semibold">Detalles de la cita</h3>
<button class="close-details text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="bg-primary/10 p-3 !rounded-button">
<div class="flex items-center gap-2 mb-2">
<i class="ri-user-line text-primary"></i>
<p class="font-medium">${client?.name || 'Cliente'}</p>
</div>
<p class="text-sm text-gray-500">+${client?.countryCode}${client?.number}</p>
</div>
<div class="space-y-2">
<div class="flex items-center gap-2">
<i class="ri-calendar-line text-primary"></i>
<p class="text-sm">${formattedDate}</p>
</div>
<div class="flex items-center gap-2">
<i class="ri-time-line text-primary"></i>
<p class="text-sm">${formattedTime} (${appointment.duration} min)</p>
</div>
<div class="flex items-center gap-2">
<i class="ri-file-list-line text-primary"></i>
<p class="text-sm">${appointment.type}</p>
</div>
${appointment.notes ? `
<div class="mt-3 pt-3 border-t border-gray-200">
<p class="text-sm text-gray-600">${appointment.notes}</p>
</div>
` : ''}
</div>
<div class="flex flex-col gap-2 mt-4">
<button onclick="editAndSendReminder(${appointmentId})" class="w-full py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-whatsapp-line"></i>
Editar y enviar recordatorio
</button>
${appointment.seriesId ? `
<div class="flex gap-2">
<button onclick="showDeleteOptions(${appointmentId}, ${appointment.seriesId})" class="w-full py-2 bg-red-500 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
</div>
` : `
<button onclick="deleteSingleAppointment(${appointmentId})" class="w-full py-2 bg-red-500 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
`}
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-details').addEventListener('click', () => {
document.body.removeChild(modal);
});
};
window.editAndSendReminder = function(appointmentId) {
const appointment = appointments.find(app => app.id === appointmentId);
if (!appointment) return;
const client = savedPhones.find(p => p.id === appointment.clientId);
if (!client) return;
const appointmentDate = new Date(appointment.dateTime);
const appointmentType = appointmentTypes.find(type => type.id === appointment.type);
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Editar recordatorio</h3>
<button class="close-reminder text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<textarea id="reminderMessage" rows="6" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none">${appointmentType ? appointmentType.messageTemplate.replace('{clientName}', client.name)
.replace('{date}', appointmentDate.toLocaleDateString())
.replace('{time}', appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }))
.replace('{duration}', appointment.duration) :
`*RECORDATORIO DE CITA*\n\nHola ${client.name},\n\nTu cita está programada para:\n\n📅 Fecha: ${appointmentDate.toLocaleDateString()}\n⏰ Hora: ${appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n⏱️ Duración: ${appointment.duration} minutos\n📝 Tipo: ${appointment.type}${appointment.notes ? `\n\nNotas:\n${appointment.notes}` : ''}`}</textarea>
<div class="flex items-center gap-2">
<input type="checkbox" id="saveAsTemplate" class="rounded">
<label for="saveAsTemplate" class="text-sm">Guardar como plantilla</label>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-reminder px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-reminder px-4 py-2 bg-primary text-white !rounded-button">Enviar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-reminder').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.cancel-reminder').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-reminder').addEventListener('click', () => {
const message = modal.querySelector('#reminderMessage').value.trim();
const saveAsTemplate = modal.querySelector('#saveAsTemplate').checked;
if (saveAsTemplate) {
const newTemplate = {
id: appointment.type,
name: `Recordatorio - ${appointment.type}`,
messageTemplate: message
.replace(client.name, '{clientName}')
.replace(appointmentDate.toLocaleDateString(), '{date}')
.replace(appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), '{time}')
.replace(appointment.duration.toString(), '{duration}')
};
const existingIndex = appointmentTypes.findIndex(t => t.id === appointment.type);
if (existingIndex !== -1) {
appointmentTypes[existingIndex] = newTemplate;
} else {
appointmentTypes.push(newTemplate);
}
localStorage.setItem('whatsappAppointmentTypes', JSON.stringify(appointmentTypes));
}
messageText.value = message;
updatePreview();
document.body.removeChild(modal);
document.querySelector('.close-details').click();
const phone = client.countryCode + client.number;
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
showToast('Recordatorio enviado');
});
};
function renderWeekView(container) {
const weekStart = new Date(currentDate);
weekStart.setDate(weekStart.getDate() - weekStart.getDay());
container.innerHTML = `
<div class="grid grid-cols-7 gap-1 mb-2">
${Array.from({ length: 7 }, (_, i) => {
const date = new Date(weekStart);
date.setDate(date.getDate() + i);
return `
<div class="text-center">
<p class="text-xs font-medium">${date.toLocaleDateString(undefined, { weekday: 'short' })}</p>
<p class="text-xs ${date.toDateString() === new Date().toDateString() ? 'text-primary font-medium' : ''}">${date.getDate()}</p>
</div>
`;
}).join('')}
</div>
<div class="grid grid-cols-7 gap-1">
${Array.from({ length: 7 }, (_, i) => {
const date = new Date(weekStart);
date.setDate(date.getDate() + i);
const dayAppointments = appointments.filter(app => {
const appDate = new Date(app.dateTime);
return appDate.toDateString() === date.toDateString();
});
return `
<div class="min-h-[100px] bg-gray-50 p-1 !rounded-button text-xs">
${dayAppointments.map(app => {
const client = savedPhones.find(p => p.id === app.clientId);
const time = new Date(app.dateTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
return `
<div class="bg-primary/10 p-1 mb-1 !rounded-button cursor-pointer hover:bg-primary/20" onclick="showAppointmentDetails(${app.id})">
${time} - ${client?.name || 'Cliente'}
<div class="text-[10px] text-gray-500 truncate">${app.type}</div>
</div>
`;
}).join('')}
</div>
`;
}).join('')}
</div>
`;
}
window.showAppointmentDetails = function(appointmentId) {
const appointment = appointments.find(app => app.id === appointmentId);
if (!appointment) return;
const client = savedPhones.find(p => p.id === appointment.clientId);
const appointmentDate = new Date(appointment.dateTime);
const formattedDate = appointmentDate.toLocaleDateString(undefined, {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
});
const formattedTime = appointmentDate.toLocaleTimeString([], {
hour: '2-digit',
minute: '2-digit'
});
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="showDeleteOptions(${appointmentId}, ${seriesId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="deleteSingleAppointment(${appointmentId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar esta cita
</button>
${seriesId ? `
<button onclick="deleteRecurringAppointments(${seriesId})" class="w-full px-3 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-2-line"></i>
Eliminar todas las citas recurrentes
</button>
` : ''}
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.deleteSingleAppointment = function(id) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar esta cita? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDelete" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDelete" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDelete').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDelete').addEventListener('click', () => {
appointments = appointments.filter(app => app.id !== id);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Cita eliminada');
});
};
window.deleteRecurringAppointments = function(seriesId) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar todas las citas de esta serie? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDeleteSeries" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDeleteSeries" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDeleteSeries').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDeleteSeries').addEventListener('click', () => {
appointments = appointments.filter(app => app.seriesId !== seriesId);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Serie de citas eliminada');
});
};
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-start mb-4">
<h3 class="text-lg font-semibold">Detalles de la cita</h3>
<button class="close-details text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="bg-primary/10 p-3 !rounded-button">
<div class="flex items-center gap-2 mb-2">
<i class="ri-user-line text-primary"></i>
<p class="font-medium">${client?.name || 'Cliente'}</p>
</div>
<p class="text-sm text-gray-500">+${client?.countryCode}${client?.number}</p>
</div>
<div class="space-y-2">
<div class="flex items-center gap-2">
<i class="ri-calendar-line text-primary"></i>
<p class="text-sm">${formattedDate}</p>
</div>
<div class="flex items-center gap-2">
<i class="ri-time-line text-primary"></i>
<p class="text-sm">${formattedTime} (${appointment.duration} min)</p>
</div>
<div class="flex items-center gap-2">
<i class="ri-file-list-line text-primary"></i>
<p class="text-sm">${appointment.type}</p>
</div>
${appointment.notes ? `
<div class="mt-3 pt-3 border-t border-gray-200">
<p class="text-sm text-gray-600">${appointment.notes}</p>
</div>
` : ''}
</div>
<div class="flex flex-col gap-2 mt-4">
<button onclick="editAndSendReminder(${appointmentId})" class="w-full py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-whatsapp-line"></i>
Editar y enviar recordatorio
</button>
${appointment.seriesId ? `
<div class="flex gap-2">
<button onclick="showDeleteOptions(${appointmentId}, ${appointment.seriesId})" class="w-full py-2 bg-red-500 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
</div>
` : `
<button onclick="deleteSingleAppointment(${appointmentId})" class="w-full py-2 bg-red-500 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
`}
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-details').addEventListener('click', () => {
document.body.removeChild(modal);
});
};
function renderMonthView(container) {
const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
const startDate = new Date(firstDay);
startDate.setDate(startDate.getDate() - startDate.getDay());
window.showDayAppointments = function(timestamp) {
const selectedDate = new Date(timestamp);
const dayAppointments = appointments.filter(app => {
const appDate = new Date(app.dateTime);
return appDate.toDateString() === selectedDate.toDateString();
});
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Citas del ${selectedDate.toLocaleDateString(undefined, {
weekday: 'long',
year: 'numeric',
month: 'long',
day: 'numeric'
})}</h3>
<button class="close-details text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
${dayAppointments.length > 0 ? `
<div class="space-y-3">
${dayAppointments.map(app => {
const client = savedPhones.find(p => p.id === app.clientId);
const time = new Date(app.dateTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
return `
<div class="bg-primary/10 p-3 !rounded-button cursor-pointer" onclick="showAppointmentDetails(${app.id})">
<div class="flex justify-between items-start">
<div>
<p class="text-sm font-medium">${time} - ${client?.name || 'Cliente'}</p>
<p class="text-xs text-gray-500">${app.type} (${app.duration} min)</p>
${app.notes ? `<p class="text-xs text-gray-600 mt-1">${app.notes}</p>` : ''}
</div>
<div class="flex gap-2">
<button onclick="event.stopPropagation(); editAppointment(${app.id})" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="event.stopPropagation(); deleteAppointment(${app.id})" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
</div>
`;
}).join('')}
</div>
` : `
<p class="text-sm text-gray-500 text-center py-3">No hay citas programadas para este día</p>
`}
<button onclick="showAddAppointmentModal('${selectedDate.toISOString()}')" class="w-full mt-4 px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-add-line"></i> Nueva cita
</button>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-details').addEventListener('click', () => {
document.body.removeChild(modal);
});
};
window.showAddAppointmentModal = function(dateString) {
document.getElementById('addAppointmentModal').classList.remove('hidden');
document.getElementById('appointmentDateTime').value = dateString.slice(0, 16);
};
container.innerHTML = `
<div class="grid grid-cols-7 gap-1 mb-2">
${['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'].map(day =>
`<div class="text-center text-xs font-medium">${day}</div>`
).join('')}
</div>
<div class="grid grid-cols-7 gap-1">
${Array.from({ length: 42 }, (_, i) => {
const date = new Date(startDate);
date.setDate(date.getDate() + i);
const isCurrentMonth = date.getMonth() === currentDate.getMonth();
const isToday = date.toDateString() === new Date().toDateString();
const dayAppointments = appointments.filter(app => {
const appDate = new Date(app.dateTime);
return appDate.toDateString() === date.toDateString();
});
return `
<div class="min-h-[80px] ${isCurrentMonth ? 'bg-gray-50' : 'bg-gray-100'} p-1 !rounded-button relative cursor-pointer hover:bg-gray-100" onclick="showDayAppointments(${date.getTime()})">
<p class="text-xs ${isToday ? 'text-primary font-medium' : ''}">${date.getDate()}</p>
${dayAppointments.length > 0 ? `
<div class="absolute bottom-1 right-1 w-4 h-4 bg-primary text-white !rounded-full flex items-center justify-center text-[10px]">
${dayAppointments.length}
</div>
` : ''}
</div>
`;
}).join('')}
</div>
`;
}
function populateClientSelect() {
const select = document.getElementById('appointmentClient');
select.innerHTML = `
<option value="">Seleccionar cliente</option>
${savedPhones.map(client => `
<option value="${client.id}">${client.name} (+${client.countryCode}${client.number})</option>
`).join('')}
`;
}
window.editAppointment = function(id) {
const appointment = appointments.find(app => app.id === id);
if (!appointment) return;
const client = savedPhones.find(p => p.id === appointment.clientId);
if (!client) return;
document.getElementById('addAppointmentModal').classList.remove('hidden');
document.getElementById('appointmentClient').value = appointment.clientId;
document.getElementById('appointmentDateTime').value = appointment.dateTime;
document.getElementById('appointmentDuration').value = appointment.duration;
document.getElementById('appointmentType').value = appointment.type;
document.getElementById('appointmentNotes').value = appointment.notes || '';
document.getElementById('sendReminder').checked = appointment.reminder;
document.getElementById('isRecurring').checked = appointment.isRecurring || false;
const recurringOptions = document.getElementById('recurringOptions');
if (appointment.isRecurring) {
recurringOptions.classList.remove('hidden');
document.getElementById('recurringMonths').value = appointment.recurringMonths || 1;
} else {
recurringOptions.classList.add('hidden');
}
document.getElementById('saveAppointment').onclick = function() {
const updatedAppointment = {
...appointment,
clientId: document.getElementById('appointmentClient').value,
dateTime: document.getElementById('appointmentDateTime').value,
duration: parseInt(document.getElementById('appointmentDuration').value),
type: document.getElementById('appointmentType').value,
notes: document.getElementById('appointmentNotes').value,
reminder: document.getElementById('sendReminder').checked,
isRecurring: document.getElementById('isRecurring').checked,
recurringMonths: parseInt(document.getElementById('recurringMonths').value)
};
if (!updatedAppointment.clientId || !updatedAppointment.dateTime) {
showToast('Por favor completa los campos requeridos');
return;
}
const selectedTime = new Date(updatedAppointment.dateTime).getTime();
const now = new Date().getTime();
if (selectedTime <= now) {
showToast('Selecciona una fecha y hora futura');
return;
}
const index = appointments.findIndex(app => app.id === id);
appointments[index] = updatedAppointment;
if (updatedAppointment.reminder) {
scheduleReminder(updatedAppointment, client);
}
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
document.getElementById('addAppointmentModal').classList.add('hidden');
updateCalendarView();
showToast('Cita actualizada');
};
};
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="showDeleteOptions(${appointmentId}, ${seriesId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar cita
</button>
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.showDeleteOptions = function(appointmentId, seriesId) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar cita</h3>
<div class="space-y-3 mb-4">
<button onclick="deleteSingleAppointment(${appointmentId})" class="w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-line"></i>
Eliminar esta cita
</button>
${seriesId ? `
<button onclick="deleteRecurringAppointments(${seriesId})" class="w-full px-3 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-delete-bin-2-line"></i>
Eliminar todas las citas recurrentes
</button>
` : ''}
</div>
<button onclick="this.closest('.fixed').remove()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 !rounded-button text-sm">Cancelar</button>
</div>
`;
document.body.appendChild(modal);
};
window.deleteSingleAppointment = function(id) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar esta cita? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDelete" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDelete" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDelete').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDelete').addEventListener('click', () => {
appointments = appointments.filter(app => app.id !== id);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Cita eliminada');
});
};
window.deleteRecurringAppointments = function(seriesId) {
const confirmModal = document.createElement('div');
confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] px-4';
confirmModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Confirmar eliminación</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar todas las citas de esta serie? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button id="cancelDeleteSeries" class="px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button id="confirmDeleteSeries" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white !rounded-button">Eliminar</button>
</div>
</div>
`;
document.body.appendChild(confirmModal);
document.getElementById('cancelDeleteSeries').addEventListener('click', () => {
document.body.removeChild(confirmModal);
});
document.getElementById('confirmDeleteSeries').addEventListener('click', () => {
appointments = appointments.filter(app => app.seriesId !== seriesId);
localStorage.setItem('whatsappAppointments', JSON.stringify(appointments));
updateCalendarView();
document.querySelector('.fixed.inset-0').remove();
document.body.removeChild(confirmModal);
showToast('Serie de citas eliminada');
});
};
const sidebar = document.getElementById('sidebar');
const sidebarToggle = document.getElementById('sidebarToggle');
document.getElementById('smsMenuBtn').addEventListener('click', function() {
showSMSModal();
closeSidebarMenu();
});
window.showMessageManager = function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestionar mensajes</h3>
<button class="close-message-manager text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Seleccionar contacto</label>
<select id="contactSelect" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Elegir contacto</option>
${savedPhones.map(phone => `
<option value="${phone.id}">${phone.name} (+${phone.countryCode}${phone.number})</option>
`).join('')}
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Mensaje</label>
<div class="flex gap-2 mb-2">
<button id="newMessageBtn" class="flex-1 py-2 bg-primary text-white !rounded-button text-sm">Nuevo mensaje</button>
<button id="savedMessageBtn" class="flex-1 py-2 bg-gray-100 text-gray-600 !rounded-button text-sm">Mensaje guardado</button>
</div>
<textarea id="messageContent" rows="4" placeholder="Escribe tu mensaje..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div id="savedMessagesList" class="max-h-32 overflow-y-auto space-y-2 mt-2 hidden">
${savedMessages.map(msg => `
<button class="w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
<p class="font-medium">${msg.title}</p>
<p class="text-xs text-gray-500 truncate">${msg.text}</p>
</button>
`).join('')}
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Programar envío</label>
<input type="datetime-local" id="scheduleTime" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<button id="scheduleMessageBtn" class="w-full py-2 bg-primary text-white !rounded-button">
Programar mensaje
</button>
</div>
</div>
`;
document.body.appendChild(modal);
const messageContent = modal.querySelector('#messageContent');
const savedMessagesList = modal.querySelector('#savedMessagesList');
const newMessageBtn = modal.querySelector('#newMessageBtn');
const savedMessageBtn = modal.querySelector('#savedMessageBtn');
newMessageBtn.addEventListener('click', function() {
this.classList.remove('bg-gray-100', 'text-gray-600');
this.classList.add('bg-primary', 'text-white');
savedMessageBtn.classList.remove('bg-primary', 'text-white');
savedMessageBtn.classList.add('bg-gray-100', 'text-gray-600');
messageContent.classList.remove('hidden');
savedMessagesList.classList.add('hidden');
});
savedMessageBtn.addEventListener('click', function() {
this.classList.remove('bg-gray-100', 'text-gray-600');
this.classList.add('bg-primary', 'text-white');
newMessageBtn.classList.remove('bg-primary', 'text-white');
newMessageBtn.classList.add('bg-gray-100', 'text-gray-600');
messageContent.classList.add('hidden');
savedMessagesList.classList.remove('hidden');
});
savedMessagesList.querySelectorAll('button').forEach(btn => {
btn.addEventListener('click', function() {
const title = this.querySelector('.font-medium').textContent;
const text = this.querySelector('.text-gray-500').textContent;
messageContent.value = text;
messageContent.classList.remove('hidden');
savedMessagesList.classList.add('hidden');
savedMessageBtn.classList.remove('bg-primary', 'text-white');
savedMessageBtn.classList.add('bg-gray-100', 'text-gray-600');
newMessageBtn.classList.remove('bg-gray-100', 'text-gray-600');
newMessageBtn.classList.add('bg-primary', 'text-white');
});
});
modal.querySelector('#scheduleMessageBtn').addEventListener('click', function() {
const contactId = modal.querySelector('#contactSelect').value;
const message = messageContent.value.trim();
const scheduleTime = modal.querySelector('#scheduleTime').value;
if (!contactId || !message || !scheduleTime) {
showToast('Completa todos los campos');
return;
}
const contact = savedPhones.find(p => p.id === contactId);
if (!contact) return;
const selectedTime = new Date(scheduleTime).getTime();
const now = new Date().getTime();
if (selectedTime <= now) {
showToast('Selecciona una fecha y hora futura');
return;
}
const scheduledMessage = {
id: Date.now(),
phone: contact.countryCode + contact.number,
message,
scheduledTime: selectedTime,
timer: setTimeout(() => {
const url = `whatsapp://send?phone=${contact.countryCode}${contact.number}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
const scheduledSentMessage = {
id: Date.now(),
phone: contact.countryCode + contact.number,
message,
date: new Date().toISOString(),
wasScheduled: true
};
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
scheduledSentMessages.unshift(scheduledSentMessage);
if (scheduledSentMessages.length > 50) scheduledSentMessages.pop();
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
removeScheduledMessage(scheduledMessage.id);
}, selectedTime - now)
};
scheduledMessages.push(scheduledMessage);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
document.body.removeChild(modal);
showToast('Mensaje programado');
closeSidebarMenu();
});
modal.querySelector('.close-message-manager').addEventListener('click', () => {
document.body.removeChild(modal);
});
};
window.showContactsManager = function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestionar contactos</h3>
<button class="close-contacts text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<button id="addNewContactBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2 mb-4">
<i class="ri-user-add-line"></i> Agregar nuevo contacto
</button>
<div class="relative mb-4">
<i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
<input type="text" id="contactSearchInput" placeholder="Buscar contacto..." class="w-full pl-9 pr-3 py-2 bg-gray-50 border-none !rounded-button text-sm">
</div>
<div id="contactsList" class="max-h-[60vh] overflow-y-auto space-y-3">
${savedPhones.length === 0 ?
'<p class="text-sm text-gray-500 text-center py-3">No hay contactos guardados</p>' :
savedPhones.map(contact => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start">
<div>
<p class="font-medium">${contact.name}</p>
<p class="text-sm text-gray-500">+${contact.countryCode}${contact.number}</p>
${contact.notes ? `<p class="text-xs text-gray-500 mt-1 italic">${contact.notes}</p>` : ''}
<div class="flex flex-wrap gap-1 mt-2">
${(contact.tags || []).map(tag => `
<span class="px-2 py-0.5 bg-primary/10 text-primary text-xs !rounded-full">${tag}</span>
`).join('')}
</div>
</div>
<div class="flex gap-2 hidden">
<button onclick="editContactInfo('${contact.id}')" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deletePhone('${contact.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
</div>
`).join('')
}
</div>
</div>
`;
document.body.appendChild(modal);
const searchInput = modal.querySelector('#contactSearchInput');
searchInput.addEventListener('input', function() {
const searchTerm = this.value.toLowerCase();
const contacts = modal.querySelectorAll('#contactsList > div');
contacts.forEach(contact => {
const name = contact.querySelector('.font-medium')?.textContent.toLowerCase() || '';
const number = contact.querySelector('.text-gray-500')?.textContent.toLowerCase() || '';
const isVisible = name.includes(searchTerm) || number.includes(searchTerm);
contact.style.display = isVisible ? 'block' : 'none';
});
});
modal.querySelector('.close-contacts').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('#addNewContactBtn').addEventListener('click', () => {
const addModal = document.createElement('div');
addModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
addModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nuevo contacto</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Nombre" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<div class="flex gap-2">
<select class="w-24 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="51">+51 🇵🇪</option>
<option value="52">+52 🇲🇽</option>
<option value="53">+53 🇨🇺</option>
<option value="54">+54 🇦🇷</option>
<option value="56">+56 🇨🇱</option>
<option value="57">+57 🇨🇴</option>
<option value="58">+58 🇻🇪</option>
</select>
<input type="tel" placeholder="Número" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Etiquetas</label>
<div class="flex flex-wrap gap-2 mb-2" id="tagsContainer"></div>
<div class="flex gap-2">
<input type="text" placeholder="Nueva etiqueta" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<button onclick="addNewTag(this)" class="px-3 py-2 bg-primary text-white !rounded-button">Agregar</button>
</div>
</div>
<textarea placeholder="Notas" rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-add px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-add px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(addModal);
window.addNewTag = function(btn) {
const input = btn.previousElementSibling;
const tag = input.value.trim();
if (tag) {
const tagsContainer = document.getElementById('tagsContainer');
const tagSpan = document.createElement('span');
tagSpan.className = 'px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1';
tagSpan.innerHTML = `
${tag}
<button onclick="this.parentElement.remove()" class="w-4 h-4 flex items-center justify-center">×</button>
`;
tagsContainer.appendChild(tagSpan);
input.value = '';
}
};
addModal.querySelector('.cancel-add').addEventListener('click', () => {
document.body.removeChild(addModal);
});
addModal.querySelector('.save-add').addEventListener('click', () => {
const name = addModal.querySelector('input[placeholder="Nombre"]').value.trim();
const countryCode = addModal.querySelector('select').value;
const number = addModal.querySelector('input[placeholder="Número"]').value.trim();
const notes = addModal.querySelector('textarea').value.trim();
const tags = Array.from(addModal.querySelectorAll('#tagsContainer span')).map(span =>
span.textContent.trim().slice(0, -1)
);
if (!name || !number) {
showToast('Completa los campos requeridos');
return;
}
const newContact = {
id: Date.now().toString(),
name,
countryCode,
number,
notes,
tags
};
savedPhones.push(newContact);
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
document.body.removeChild(addModal);
document.body.removeChild(modal);
showContactsManager();
showToast('Contacto agregado');
});
});
closeSidebarMenu();
};
window.showSavedContactsList = function() {
document.getElementById('selectPhoneBtn').click();
closeSidebarMenu();
};
window.showSavedMessagesList = function() {
document.getElementById('savedMessagesBtn').click();
closeSidebarMenu();
};
const closeSidebar = document.getElementById('closeSidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');
function openSidebar() {
sidebar.classList.remove('-translate-x-full');
sidebarOverlay.classList.add('opacity-50');
sidebarOverlay.classList.remove('pointer-events-none');
}
function closeSidebarMenu() {
sidebar.classList.add('-translate-x-full');
sidebarOverlay.classList.remove('opacity-50');
sidebarOverlay.classList.add('pointer-events-none');
}
sidebarToggle.addEventListener('click', openSidebar);
closeSidebar.addEventListener('click', closeSidebarMenu);
sidebarOverlay.addEventListener('click', closeSidebarMenu);
// Add click handlers for sidebar menu items
sidebar.querySelectorAll('button').forEach(button => {
button.addEventListener('click', function() {
const icon = this.querySelector('i');
if (icon) {
const iconClass = icon.className;
if (iconClass.includes('store-2')) catalogBtn.click();
else if (iconClass.includes('money-dollar')) financeBtn.click();
else if (iconClass.includes('radio')) radioBtn.click();
else if (iconClass.includes('restaurant')) restaurantBtn.click();
else if (iconClass.includes('contacts')) document.getElementById('selectPhoneBtn').click();
else if (iconClass.includes('group')) addGroupBtn.click();
else if (iconClass.includes('file-upload')) importContactsBtn.click();
else if (iconClass.includes('bar-chart')) analyticsBtn.click();
else if (iconClass.includes('database')) backupBtn.click();
else if (iconClass.includes('tools')) toolsBtn.click();
else if (iconClass.includes('moon')) settingsBtn.click();
else if (iconClass.includes('message')) savedMessagesBtn.click();
else if (iconClass.includes('history')) historyBtn.click();
else if (iconClass.includes('time')) {
scheduleMessage.checked = true;
scheduleMessage.dispatchEvent(new Event('change'));
}
}
closeSidebarMenu();
});
});
const toolsBtn = document.getElementById('toolsBtn');
const toolsModal = document.getElementById('toolsModal');
const closeTools = document.getElementById('closeTools');
const toolBtns = document.querySelectorAll('.tool-btn');
toolsBtn.addEventListener('click', function() {
toolsModal.classList.remove('hidden');
});
closeTools.addEventListener('click', function() {
toolsModal.classList.add('hidden');
});
toolBtns.forEach(btn => {
btn.addEventListener('click', function() {
const tool = this.querySelector('span').textContent.toLowerCase();
handleToolClick(tool);
});
});
function handleToolClick(tool) {
switch(tool) {
case 'calculadora':
showCalculator();
break;
case 'sms':
showSMSModal();
break;
}
}
function showQRGenerator() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Generador QR</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<textarea placeholder="Texto o URL para el código QR" rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div id="qrcode" class="flex items-center justify-center p-4 bg-gray-50 !rounded-button"></div>
<button class="w-full py-2 bg-primary text-white !rounded-button">Generar QR</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showTranslator() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Traductor</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="flex gap-2 mb-4">
<select class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="es">Español</option>
<option value="en">Inglés</option>
<option value="pt">Portugués</option>
<option value="fr">Francés</option>
</select>
<button class="w-8 h-8 flex items-center justify-center bg-gray-100 !rounded-button">
<i class="ri-arrow-left-right-line"></i>
</button>
<select class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="en">Inglés</option>
<option value="es">Español</option>
<option value="pt">Portugués</option>
<option value="fr">Francés</option>
</select>
</div>
<textarea placeholder="Texto a traducir" rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div class="bg-gray-50 p-3 !rounded-button min-h-[80px]">
<p class="text-gray-500">Traducción aparecerá aquí</p>
</div>
<button class="w-full py-2 bg-primary text-white !rounded-button">Traducir</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showCalendar() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Agenda</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="flex justify-between items-center">
<button class="p-2 hover:bg-gray-100 !rounded-button">
<i class="ri-arrow-left-s-line"></i>
</button>
<span class="font-medium">Mayo 2025</span>
<button class="p-2 hover:bg-gray-100 !rounded-button">
<i class="ri-arrow-right-s-line"></i>
</button>
</div>
<div class="grid grid-cols-7 gap-1 text-center text-sm">
<div class="p-2">Lu</div>
<div class="p-2">Ma</div>
<div class="p-2">Mi</div>
<div class="p-2">Ju</div>
<div class="p-2">Vi</div>
<div class="p-2">Sa</div>
<div class="p-2">Do</div>
</div>
<div class="grid grid-cols-7 gap-1">
${Array.from({length: 31}, (_, i) => `
<button class="p-2 hover:bg-gray-100 !rounded-button ${i + 1 === 13 ? 'bg-primary text-white' : ''}">${i + 1}</button>
`).join('')}
</div>
<div class="border-t border-gray-200 pt-4">
<button class="w-full py-2 bg-primary text-white !rounded-button">
Agregar evento
</button>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showCalculator() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Calculadora</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="bg-gray-50 p-4 !rounded-button mb-4">
<input type="text" id="calcDisplay" class="w-full text-right text-2xl font-medium bg-transparent border-none focus:outline-none" readonly value="0">
</div>
<div class="grid grid-cols-4 gap-2">
<button class="p-4 bg-gray-100 !rounded-button hover:bg-gray-200" onclick="clearCalc()">C</button>
<button class="p-4 bg-gray-100 !rounded-button hover:bg-gray-200" onclick="toggleParentheses()">()</button>
<button class="p-4 bg-gray-100 !rounded-button hover:bg-gray-200" onclick="addOperator('%')">%</button>
<button class="p-4 bg-primary text-white !rounded-button" onclick="addOperator('/')">÷</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('7')">7</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('8')">8</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('9')">9</button>
<button class="p-4 bg-primary text-white !rounded-button" onclick="addOperator('*')">×</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('4')">4</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('5')">5</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('6')">6</button>
<button class="p-4 bg-primary text-white !rounded-button" onclick="addOperator('-')">-</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('1')">1</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('2')">2</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('3')">3</button>
<button class="p-4 bg-primary text-white !rounded-button" onclick="addOperator('+')">+</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="toggleSign()">±</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addNumber('0')">0</button>
<button class="p-4 bg-white border border-gray-200 !rounded-button" onclick="addDecimal()">.</button>
<button class="p-4 bg-primary text-white !rounded-button" onclick="calculate()">=</button>
</div>
</div>
`;
document.body.appendChild(modal);
let currentValue = '0';
let hasDecimal = false;
let lastWasOperator = false;
let parenthesesCount = 0;
window.clearCalc = function() {
currentValue = '0';
hasDecimal = false;
lastWasOperator = false;
parenthesesCount = 0;
updateDisplay();
};
window.addNumber = function(num) {
if (currentValue === '0' && num !== '0') {
currentValue = num;
} else if (currentValue !== '0') {
currentValue += num;
}
lastWasOperator = false;
updateDisplay();
};
window.addOperator = function(op) {
if (!lastWasOperator) {
currentValue += op;
lastWasOperator = true;
hasDecimal = false;
}
updateDisplay();
};
window.addDecimal = function() {
if (!hasDecimal && !lastWasOperator) {
currentValue += '.';
hasDecimal = true;
}
updateDisplay();
};
window.toggleSign = function() {
if (currentValue !== '0') {
if (currentValue.startsWith('-')) {
currentValue = currentValue.substring(1);
} else {
currentValue = '-' + currentValue;
}
updateDisplay();
}
};
window.toggleParentheses = function() {
if (parenthesesCount === 0 || (parenthesesCount > 0 && !lastWasOperator)) {
currentValue += '(';
parenthesesCount++;
} else {
currentValue += ')';
parenthesesCount--;
}
updateDisplay();
};
window.calculate = function() {
try {
let result = eval(currentValue);
currentValue = result.toString();
hasDecimal = currentValue.includes('.');
lastWasOperator = false;
parenthesesCount = 0;
updateDisplay();
} catch (e) {
currentValue = 'Error';
updateDisplay();
setTimeout(() => {
clearCalc();
}, 1000);
}
};
function updateDisplay() {
const display = document.getElementById('calcDisplay');
display.value = currentValue;
}
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showTimer() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Temporizador</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="flex justify-center items-center gap-4 text-4xl font-medium">
<input type="number" min="0" max="23" value="00" class="w-16 text-center bg-gray-50 border border-gray-200 !rounded-button">
<span>:</span>
<input type="number" min="0" max="59" value="00" class="w-16 text-center bg-gray-50 border border-gray-200 !rounded-button">
<span>:</span>
<input type="number" min="0" max="59" value="00" class="w-16 text-center bg-gray-50 border border-gray-200 !rounded-button">
</div>
<div class="flex justify-center gap-4">
<button class="px-6 py-2 bg-primary text-white !rounded-button">Iniciar</button>
<button class="px-6 py-2 bg-gray-100 text-gray-600 !rounded-button">Reiniciar</button>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showNotes() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Notas</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="flex gap-2">
<input type="text" placeholder="Título de la nota" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<button class="px-3 py-2 bg-primary text-white !rounded-button">
<i class="ri-add-line"></i>
</button>
</div>
<div class="space-y-2 max-h-64 overflow-y-auto">
<div class="p-3 bg-gray-50 !rounded-button">
<div class="flex justify-between items-start mb-1">
<h4 class="font-medium">Recordatorio importante</h4>
<button class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
<p class="text-sm text-gray-600">Llamar al cliente mañana a las 10am</p>
</div>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showLocation() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Ubicación</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="relative">
<i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
<input type="text" placeholder="Buscar ubicación" class="w-full pl-9 pr-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div class="aspect-video bg-gray-100 !rounded-button overflow-hidden">
<img src="https://public.readdy.ai/gen_page/map_placeholder_1280x720.png" alt="Map" class="w-full h-full object-cover">
</div>
<button class="w-full py-2 bg-primary text-white !rounded-button">
Compartir ubicación
</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showImageEditor() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Editor de imágenes</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="aspect-square bg-gray-100 !rounded-button flex items-center justify-center">
<i class="ri-image-add-line ri-3x text-gray-400"></i>
</div>
<div class="flex gap-2 overflow-x-auto py-2">
<button class="flex-shrink-0 px-3 py-1 bg-gray-100 !rounded-button text-sm">Recortar</button>
<button class="flex-shrink-0 px-3 py-1 bg-gray-100 !rounded-button text-sm">Filtros</button>
<button class="flex-shrink-0 px-3 py-1 bg-gray-100 !rounded-button text-sm">Ajustes</button>
<button class="flex-shrink-0 px-3 py-1 bg-gray-100 !rounded-button text-sm">Texto</button>
<button class="flex-shrink-0 px-3 py-1 bg-gray-100 !rounded-button text-sm">Stickers</button>
</div>
<button class="w-full py-2 bg-primary text-white !rounded-button">
Guardar imagen
</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showSMSModal() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Enviar SMS</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Destinatario</label>
<select id="smsRecipient" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar contacto</option>
${savedPhones.map(phone => `
<option value="${phone.countryCode}${phone.number}">${phone.name} (+${phone.countryCode}${phone.number})</option>
`).join('')}
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Mensaje</label>
<textarea id="smsText" rows="4" placeholder="Escribe tu mensaje..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<p class="text-xs text-gray-500 mt-1">Caracteres: <span id="smsCharCount">0</span>/160</p>
</div>
<div class="flex items-center gap-2">
<input type="checkbox" id="saveAsSMSTemplate">
<label for="saveAsSMSTemplate" class="text-sm">Guardar como plantilla</label>
</div>
<button id="sendSMSBtn" class="w-full py-2 bg-primary text-white !rounded-button">
Enviar SMS
</button>
</div>
</div>
`;
document.body.appendChild(modal);
const closeBtn = modal.querySelector('.close-modal');
const smsText = modal.querySelector('#smsText');
const charCount = modal.querySelector('#smsCharCount');
const sendSMSBtn = modal.querySelector('#sendSMSBtn');
const recipientSelect = modal.querySelector('#smsRecipient');
const saveTemplate = modal.querySelector('#saveAsSMSTemplate');
smsText.addEventListener('input', function() {
const count = this.value.length;
charCount.textContent = count;
if (count > 160) {
charCount.classList.add('text-red-500');
} else {
charCount.classList.remove('text-red-500');
}
});
sendSMSBtn.addEventListener('click', function() {
const recipient = recipientSelect.value;
const message = smsText.value.trim();
if (!recipient) {
showToast('Selecciona un destinatario');
return;
}
if (!message) {
showToast('Escribe un mensaje');
return;
}
if (message.length > 160) {
showToast('El mensaje excede los 160 caracteres');
return;
}
if (saveTemplate.checked && message) {
const templates = JSON.parse(localStorage.getItem('whatsappSMSTemplates') || '[]');
templates.push({
id: Date.now(),
text: message
});
localStorage.setItem('whatsappSMSTemplates', JSON.stringify(templates));
}
const smsUrl = `sms:${recipient}?body=${encodeURIComponent(message)}`;
window.open(smsUrl);
document.body.removeChild(modal);
showToast('SMS enviado');
});
closeBtn.addEventListener('click', () => {
document.body.removeChild(modal);
});
}
function showLinkShortener() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Acortador de links</h3>
<button class="close-modal text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<input type="url" placeholder="Pega tu link aquí" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<button class="w-full py-2 bg-primary text-white !rounded-button">
Acortar link
</button>
<div class="p-3 bg-gray-50 !rounded-button hidden">
<div class="flex justify-between items-center">
<span class="text-sm font-medium">https://short.link/abc123</span>
<button class="text-primary">
<i class="ri-file-copy-line"></i>
</button>
</div>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
}
// Stats Management
const statsBtn = document.getElementById('statsBtn');
const statsModal = document.getElementById('statsModal');
const closeStats = document.getElementById('closeStats');
const totalStatsTab = document.getElementById('totalStatsTab');
const monthlyStatsTab = document.getElementById('monthlyStatsTab');
const weeklyStatsTab = document.getElementById('weeklyStatsTab');
const dailyStatsTab = document.getElementById('dailyStatsTab');
const statsDatePicker = document.getElementById('statsDatePicker');
let currentStatsView = 'total';
let currentStatsDate = new Date();
statsBtn.addEventListener('click', function() {
statsModal.classList.remove('hidden');
updateStats();
});
closeStats.addEventListener('click', function() {
statsModal.classList.add('hidden');
});
[totalStatsTab, monthlyStatsTab, weeklyStatsTab, dailyStatsTab].forEach(tab => {
tab.addEventListener('click', function() {
[totalStatsTab, monthlyStatsTab, weeklyStatsTab, dailyStatsTab].forEach(t => {
t.classList.remove('bg-primary', 'text-white');
t.classList.add('bg-gray-100', 'text-gray-600');
});
this.classList.remove('bg-gray-100', 'text-gray-600');
this.classList.add('bg-primary', 'text-white');
currentStatsView = this.id.replace('StatsTab', '');
updateStats();
});
});
statsDatePicker.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Seleccionar fecha</h3>
<input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3" value="${currentStatsDate.toISOString().split('T')[0]}">
<div class="flex justify-end gap-2">
<button class="cancel-date px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="confirm-date px-4 py-2 bg-primary text-white !rounded-button">Confirmar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-date').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.confirm-date').addEventListener('click', () => {
const selectedDate = new Date(modal.querySelector('input[type="date"]').value);
currentStatsDate = selectedDate;
updateStats();
document.body.removeChild(modal);
});
});
function updateStats() {
const startDate = getStartDate();
const endDate = getEndDate();
statsDatePicker.value = formatDateRange(startDate, endDate);
const filteredTransactions = transactions.filter(t => {
const transactionDate = new Date(t.date);
return transactionDate >= startDate && transactionDate <= endDate;
});
const income = filteredTransactions
.filter(t => t.type === 'income')
.reduce((sum, t) => sum + t.amount, 0);
const expense = filteredTransactions
.filter(t => t.type === 'expense')
.reduce((sum, t) => sum + t.amount, 0);
const balance = income - expense;
document.getElementById('statsIncome').textContent = `S/ ${income.toFixed(2)}`;
document.getElementById('statsExpense').textContent = `S/ ${expense.toFixed(2)}`;
document.getElementById('statsBalance').textContent = `S/ ${balance.toFixed(2)}`;
document.getElementById('statsTransactions').textContent = filteredTransactions.length;
updateStatsChart(startDate, endDate);
updateTopCategories(filteredTransactions);
}
function getStartDate() {
switch(currentStatsView) {
case 'total':
return new Date(0);
case 'monthly':
return new Date(currentStatsDate.getFullYear(), currentStatsDate.getMonth(), 1);
case 'weekly':
const start = new Date(currentStatsDate);
start.setDate(start.getDate() - start.getDay());
return start;
case 'daily':
return new Date(currentStatsDate.setHours(0, 0, 0, 0));
default:
return new Date(0);
}
}
function getEndDate() {
switch(currentStatsView) {
case 'total':
return new Date();
case 'monthly':
return new Date(currentStatsDate.getFullYear(), currentStatsDate.getMonth() + 1, 0);
case 'weekly':
const end = new Date(currentStatsDate);
end.setDate(end.getDate() - end.getDay() + 6);
return end;
case 'daily':
return new Date(currentStatsDate.setHours(23, 59, 59, 999));
default:
return new Date();
}
}
function formatDateRange(start, end) {
if (currentStatsView === 'total') {
return 'Todas las transacciones';
}
if (currentStatsView === 'monthly') {
return start.toLocaleString('default', { month: 'long', year: 'numeric' });
}
if (currentStatsView === 'weekly') {
return `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;
}
return start.toLocaleDateString();
}
function updateStatsChart(startDate, endDate) {
const chartContainer = document.getElementById('statsChart');
const chart = echarts.init(chartContainer);
let dates = [];
let incomeData = [];
let expenseData = [];
if (currentStatsView === 'daily') {
const hours = Array.from({length: 24}, (_, i) => i);
dates = hours.map(hour => `${hour}:00`);
hours.forEach(hour => {
const hourStart = new Date(startDate);
hourStart.setHours(hour, 0, 0, 0);
const hourEnd = new Date(startDate);
hourEnd.setHours(hour, 59, 59, 999);
const hourTransactions = transactions.filter(t => {
const date = new Date(t.date);
return date >= hourStart && date <= hourEnd;
});
incomeData.push(hourTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0));
expenseData.push(hourTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0));
});
} else {
const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
dates = Array.from({length: days}, (_, i) => {
const date = new Date(startDate);
date.setDate(date.getDate() + i);
return date.toLocaleDateString();
});
dates.forEach((date, i) => {
const dayStart = new Date(startDate);
dayStart.setDate(dayStart.getDate() + i);
dayStart.setHours(0, 0, 0, 0);
const dayEnd = new Date(dayStart);
dayEnd.setHours(23, 59, 59, 999);
const dayTransactions = transactions.filter(t => {
const transactionDate = new Date(t.date);
return transactionDate >= dayStart && transactionDate <= dayEnd;
});
incomeData.push(dayTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0));
expenseData.push(dayTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0));
});
}
const option = {
grid: {
top: 20,
right: 20,
bottom: 20,
left: 40,
},
xAxis: {
type: 'category',
data: dates,
axisLine: {
lineStyle: {
color: '#E5E7EB'
}
},
axisTick: {
show: false
},
axisLabel: {
color: '#6B7280',
fontSize: 10,
interval: Math.floor(dates.length / 4)
}
},
yAxis: {
type: 'value',
axisLine: {
show: false
},
axisTick: {
show: false
},
splitLine: {
lineStyle: {
color: '#E5E7EB'
}
},
axisLabel: {
color: '#6B7280',
fontSize: 10,
formatter: value => `S/ ${value}`
}
},
series: [{
name: 'Ingresos',
type: 'line',
data: incomeData,
smooth: true,
symbol: 'circle',
symbolSize: 6,
itemStyle: {
color: '#10B981'
},
lineStyle: {
color: '#10B981'
},
areaStyle: {
color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
offset: 0,
color: 'rgba(16, 185, 129, 0.2)'
}, {
offset: 1,
color: 'rgba(16, 185, 129, 0)'
}])
}
}, {
name: 'Egresos',
type: 'line',
data: expenseData,
smooth: true,
symbol: 'circle',
symbolSize: 6,
itemStyle: {
color: '#EF4444'
},
lineStyle: {
color: '#EF4444'
},
areaStyle: {
color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
offset: 0,
color: 'rgba(239, 68, 68, 0.2)'
}, {
offset: 1,
color: 'rgba(239, 68, 68, 0)'
}])
}
}]
};
chart.setOption(option);
window.addEventListener('resize', () => {
chart.resize();
});
}
function updateTopCategories(transactions) {
const categories = {};
transactions.forEach(t => {
if (!categories[t.category]) {
categories[t.category] = {
income: 0,
expense: 0
};
}
if (t.type === 'income') {
categories[t.category].income += t.amount;
} else {
categories[t.category].expense += t.amount;
}
});
const sortedCategories = Object.entries(categories)
.sort((a, b) => (b[1].income + b[1].expense) - (a[1].income + a[1].expense))
.slice(0, 5);
document.getElementById('statsCategories').innerHTML = sortedCategories.map(([category, amounts]) => `
<div class="flex justify-between items-center bg-white p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${getCategoryLabel(category)}</p>
<div class="flex gap-2">
<span class="text-xs text-green-500">+S/ ${amounts.income.toFixed(2)}</span>
<span class="text-xs text-red-500">-S/ ${amounts.expense.toFixed(2)}</span>
</div>
</div>
<p class="text-sm font-medium text-primary">S/ ${(amounts.income - amounts.expense).toFixed(2)}</p>
</div>
`).join('') || '<p class="text-sm text-gray-500 text-center">No hay datos disponibles</p>';
}
// Restaurant Order Management
const restaurantBtn = document.getElementById('restaurantBtn');
const restaurantModal = document.getElementById('restaurantModal');
const closeRestaurant = document.getElementById('closeRestaurant');
const newOrderBtn = document.getElementById('newOrderBtn');
const newOrderModal = document.getElementById('newOrderModal');
const closeNewOrder = document.getElementById('closeNewOrder');
const cancelNewOrder = document.getElementById('cancelNewOrder');
const confirmNewOrder = document.getElementById('confirmNewOrder');
const orderDetailsModal = document.getElementById('orderDetailsModal');
const closeOrderDetails = document.getElementById('closeOrderDetails');
let tables = Array.from({length: 9}, (_, i) => ({
id: i + 1,
name: `Mesa ${i + 1}`,
status: 'available' // available, occupied, completed
}));
let restaurantOrders = JSON.parse(localStorage.getItem('whatsappRestaurantOrders')) || [];
restaurantBtn.addEventListener('click', function() {
restaurantModal.classList.remove('hidden');
updateTableGrid();
updateActiveOrdersList();
});
closeRestaurant.addEventListener('click', function() {
restaurantModal.classList.add('hidden');
});
newOrderBtn.addEventListener('click', function() {
showNewOrderModal();
});
closeNewOrder.addEventListener('click', function() {
newOrderModal.classList.add('hidden');
});
cancelNewOrder.addEventListener('click', function() {
newOrderModal.classList.add('hidden');
});
closeOrderDetails.addEventListener('click', function() {
orderDetailsModal.classList.add('hidden');
});
function updateTableGrid() {
const tableGrid = document.getElementById('tableGrid');
tableGrid.innerHTML = tables.map(table => {
const order = restaurantOrders.find(o => o.tableId === table.id && o.status !== 'completed');
let statusClass = 'bg-gray-100';
let statusText = 'Disponible';
if (order) {
switch(order.status) {
case 'pending':
statusClass = 'bg-yellow-100 border-yellow-300';
statusText = 'Pendiente';
break;
case 'in_progress':
statusClass = 'bg-blue-100 border-blue-300';
statusText = 'En proceso';
break;
case 'ready':
statusClass = 'bg-green-100 border-green-300';
statusText = 'Listo';
break;
}
if (order.isPaid) {
statusClass = 'bg-gray-100';
statusText = 'Disponible';
}
}
return `
<div class="relative p-2 ${statusClass} border !rounded-button cursor-pointer" onclick="showTableDetails(${table.id})">
<p class="text-sm font-medium text-center">${table.name}</p>
<p class="text-xs text-center">${statusText}</p>
${order && !order.isPaid ? `
<div class="absolute -top-2 -right-2 w-6 h-6 bg-primary text-white !rounded-full flex items-center justify-center text-xs">
${order.items.reduce((sum, item) => sum + item.quantity, 0)}
</div>
` : ''}
</div>
`;
}).join('');
}
window.showTableDetails = function(tableId) {
const activeOrder = restaurantOrders.find(o => o.tableId === tableId && o.status !== 'completed' && !o.isPaid);
if (activeOrder) {
// Show order details if table is occupied
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Mesa ${tableId}</h3>
<button class="close-details text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 ${activeOrder.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600'} !rounded-full text-sm">
<i class="ri-time-line mr-1"></i> Pendiente
</span>
<span class="px-2 py-1 ${activeOrder.status === 'in_progress' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-600'} !rounded-full text-sm">
<i class="ri-loader-4-line mr-1"></i> En preparación
</span>
<span class="px-2 py-1 ${activeOrder.status === 'ready' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'} !rounded-full text-sm">
<i class="ri-check-line mr-1"></i> Listo
</span>
<span class="px-2 py-1 ${activeOrder.isPaid ? 'bg-primary/10 text-primary' : 'bg-gray-100 text-gray-600'} !rounded-full text-sm">
<i class="ri-wallet-3-line mr-1"></i> ${activeOrder.isPaid ? 'Pagado' : 'Pendiente de pago'}
</span>
</div>
<div class="space-y-2">
${activeOrder.items.map(item => `
<div class="flex justify-between items-center text-sm">
<div class="flex items-center gap-2">
<span>${item.quantity}x ${item.name}</span>
${activeOrder.itemsStatus.find(s => s.productId === item.id)?.delivered ?
'<i class="ri-checkbox-circle-fill text-green-500"></i>' : ''}
</div>
<span>${getCurrencySymbol(item.currency)}${(item.price * item.quantity).toFixed(2)}</span>
</div>
`).join('')}
<div class="border-t border-gray-200 pt-2 flex justify-between items-center font-medium">
<span>Total</span>
<span>${getCurrencySymbol(activeOrder.items[0].currency)}${activeOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</span>
</div>
</div>
${activeOrder.notes ? `<p class="text-sm text-gray-600 italic">${activeOrder.notes}</p>` : ''}
<div class="flex justify-end gap-2 mt-4">
<button onclick="updateOrderStatus(${activeOrder.id}, '${activeOrder.status === 'pending' ? 'in_progress' : 'ready'}')" class="px-3 py-2 bg-primary text-white !rounded-button text-sm">
${activeOrder.status === 'pending' ? 'Iniciar preparación' : activeOrder.status === 'in_progress' ? 'Marcar listo' : 'Entregado'}
</button>
<button onclick="togglePaymentStatus(${activeOrder.id})" class="px-3 py-2 ${activeOrder.isPaid ? 'bg-gray-100 text-gray-600' : 'bg-primary text-white'} !rounded-button text-sm">
${activeOrder.isPaid ? 'Marcar impago' : 'Marcar pagado'}
</button>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-details').addEventListener('click', () => {
document.body.removeChild(modal);
});
} else {
// Show new order modal if table is available
showNewOrderModal();
document.getElementById('tableSelect').value = tableId;
}
};
document.getElementById('manageProductsBtn').addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestionar Productos</h3>
<button class="close-products text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<button id="addNewProductBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2 mb-4">
<i class="ri-add-line"></i> Agregar nuevo producto
</button>
<div id="productsList" class="max-h-[60vh] overflow-y-auto space-y-3">
${products.length === 0 ?
'<p class="text-sm text-gray-500 text-center py-3">No hay productos agregados</p>' :
products.map(product => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<h4 class="font-medium">${product.name}</h4>
<p class="text-sm text-gray-500">${product.description}</p>
<p class="text-sm text-primary">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
<div class="flex items-center gap-2 mt-1">
<span class="text-xs ${(productStock[product.id]?.available || 0) <= (productStock[product.id]?.alert_threshold || 10) ? 'text-red-500' : 'text-gray-500'}">
Stock: ${productStock[product.id]?.available || 0}
</span>
<span class="text-xs text-gray-500">
Alerta: ${productStock[product.id]?.alert_threshold || 10}
</span>
</div>
</div>
<div class="flex gap-2">
<button onclick="editProduct('${product.id}')" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deleteProduct('${product.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
</div>
`).join('')}
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-products').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('#addNewProductBtn').addEventListener('click', () => {
const productModal = document.createElement('div');
productModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
productModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nuevo Producto</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Nombre del producto" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Descripción" rows="2" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div class="flex gap-2">
<input type="number" step="0.01" placeholder="Precio" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<select class="w-24 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="PEN">S/</option>
<option value="USD">$</option>
<option value="EUR">€</option>
</select>
</div>
<div class="flex gap-2">
<div class="flex-1">
<label class="text-xs text-gray-500 mb-1 block">Stock inicial</label>
<input type="number" placeholder="100" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div class="flex-1">
<label class="text-xs text-gray-500 mb-1 block">Alerta stock bajo</label>
<input type="number" placeholder="10" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-product px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-product px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(productModal);
productModal.querySelector('.cancel-product').addEventListener('click', () => {
document.body.removeChild(productModal);
});
productModal.querySelector('.save-product').addEventListener('click', () => {
const name = productModal.querySelector('input[placeholder="Nombre del producto"]').value.trim();
const description = productModal.querySelector('textarea').value.trim();
const price = parseFloat(productModal.querySelector('input[type="number"][placeholder="Precio"]').value);
const currency = productModal.querySelector('select').value;
const stock = parseInt(productModal.querySelector('input[placeholder="100"]').value) || 100;
const alertThreshold = parseInt(productModal.querySelector('input[placeholder="10"]').value) || 10;
if (!name || !description || !price) {
showToast('Completa todos los campos');
return;
}
const newProduct = {
id: Date.now().toString(),
name,
description,
price,
currency
};
products.push(newProduct);
productStock[newProduct.id] = {
available: stock,
alert_threshold: alertThreshold
};
localStorage.setItem('whatsappProducts', JSON.stringify(products));
localStorage.setItem('whatsappProductStock', JSON.stringify(productStock));
document.body.removeChild(productModal);
document.body.removeChild(modal);
showToast('Producto agregado');
});
});
});
function showNewOrderModal() {
const tableSelect = document.getElementById('tableSelect');
const productList = document.getElementById('productList');
// Populate table select
tableSelect.innerHTML = `
<option value="">Seleccionar mesa</option>
${tables.map(table => {
const isOccupied = restaurantOrders.some(o => o.tableId === table.id && o.status !== 'completed');
return `<option value="${table.id}" ${isOccupied ? 'disabled' : ''}>${table.name} ${isOccupied ? '(Ocupada)' : ''}</option>`;
}).join('')}
`;
// Populate product list
productList.innerHTML = products.map(product => `
<div class="flex items-center justify-between bg-gray-50 p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${product.name}</p>
<p class="text-xs text-gray-500">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
</div>
<div class="flex items-center gap-2">
<button onclick="decreaseQuantity(${product.id})" class="w-6 h-6 bg-gray-200 !rounded-full flex items-center justify-center">-</button>
<span class="product-quantity text-sm" data-product-id="${product.id}">0</span>
<button onclick="increaseQuantity(${product.id})" class="w-6 h-6 bg-primary text-white !rounded-full flex items-center justify-center">+</button>
</div>
</div>
`).join('');
newOrderModal.classList.remove('hidden');
}
window.decreaseQuantity = function(productId) {
const quantitySpan = document.querySelector(`.product-quantity[data-product-id="${productId}"]`);
let quantity = parseInt(quantitySpan.textContent);
if (quantity > 0) {
quantitySpan.textContent = quantity - 1;
}
};
window.increaseQuantity = function(productId) {
const quantitySpan = document.querySelector(`.product-quantity[data-product-id="${productId}"]`);
let quantity = parseInt(quantitySpan.textContent);
quantitySpan.textContent = quantity + 1;
};
confirmNewOrder.addEventListener('click', function() {
const tableId = parseInt(document.getElementById('tableSelect').value);
const notes = document.getElementById('orderNotes').value.trim();
if (!tableId) {
showToast('Selecciona una mesa');
return;
}
const selectedProducts = products.map(product => ({
...product,
quantity: parseInt(document.querySelector(`.product-quantity[data-product-id="${product.id}"]`).textContent)
})).filter(product => product.quantity > 0);
if (selectedProducts.length === 0) {
showToast('Agrega al menos un producto');
return;
}
const newOrder = {
id: Date.now(),
tableId,
items: selectedProducts,
notes,
status: 'pending',
createdAt: new Date().toISOString(),
timer: 0,
isPaid: false,
itemsStatus: selectedProducts.map(item => ({
productId: item.id,
delivered: false
}))
};
restaurantOrders.push(newOrder);
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateTableGrid();
updateActiveOrdersList();
newOrderModal.classList.add('hidden');
showToast('Comanda creada');
});
function updateActiveOrdersList() {
const activeOrdersList = document.getElementById('activeOrdersList');
const activeOrders = restaurantOrders.filter(order => order.status !== 'completed');
if (activeOrders.length === 0) {
activeOrdersList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay comandas activas</p>';
return;
}
activeOrdersList.innerHTML = activeOrders.map(order => {
const table = tables.find(t => t.id === order.tableId);
const totalItems = order.items.reduce((sum, item) => sum + item.quantity, 0);
const deliveredItems = order.itemsStatus.filter(item => item.delivered).length;
const elapsedTime = Math.floor((new Date() - new Date(order.createdAt)) / 1000);
let statusClass = '';
let statusText = '';
switch(order.status) {
case 'pending':
statusClass = 'bg-yellow-100 text-yellow-800';
statusText = 'Pendiente';
break;
case 'in_progress':
statusClass = 'bg-blue-100 text-blue-800';
statusText = 'En proceso';
break;
case 'ready':
statusClass = 'bg-green-100 text-green-800';
statusText = 'Listo';
break;
}
return `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="font-medium">${table.name}</p>
<p class="text-xs text-gray-500">Creado hace ${formatElapsedTime(elapsedTime)}</p>
<div class="flex items-center gap-2 mt-1">
<span class="text-xs ${order.isPaid ? 'text-green-500' : 'text-orange-500'}">
<i class="ri-${order.isPaid ? 'checkbox-circle-fill' : 'time-line'}"></i>
${order.isPaid ? 'Pagado' : 'Pendiente de pago'}
</span>
<span class="text-xs text-primary">Total: ${getCurrencySymbol(order.items[0].currency)}${order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</span>
</div>
</div>
<div class="flex flex-col items-end gap-1">
<span class="px-2 py-1 text-xs !rounded-full ${statusClass}">${statusText}</span>
<button onclick="togglePaymentStatus(${order.id})" class="text-xs px-2 py-1 ${order.isPaid ? 'bg-gray-100 text-gray-600' : 'bg-primary text-white'} !rounded-button">
${order.isPaid ? 'Marcar impago' : 'Marcar pagado'}
</button>
</div>
</div>
<div class="flex flex-col gap-2 mb-2">
<div class="flex justify-between items-center text-sm">
<span>Productos entregados: ${deliveredItems}/${totalItems}</span>
<div class="flex gap-2">
<button onclick="addMoreItems(${order.id})" class="text-primary flex items-center gap-1">
<i class="ri-add-circle-line"></i>
<span class="text-xs">Agregar adicional</span>
</button>
<button onclick="showOrderDetails(${order.id})" class="text-primary">
<i class="ri-eye-line"></i>
</button>
<button onclick="completeOrder(${order.id})" class="text-green-500">
<i class="ri-check-line"></i>
</button>
</div>
</div>
<div class="flex flex-wrap gap-2 text-xs">
<button onclick="updateOrderStatus(${order.id}, 'pending')" class="px-2 py-1 ${order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-600'} !rounded-full">
<i class="ri-time-line mr-1"></i> Pendiente
</button>
<button onclick="updateOrderStatus(${order.id}, 'in_progress')" class="px-2 py-1 ${order.status === 'in_progress' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-600'} !rounded-full">
<i class="ri-loader-4-line mr-1"></i> En preparación
</button>
<button onclick="updateOrderStatus(${order.id}, 'ready')" class="px-2 py-1 ${order.status === 'ready' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'} !rounded-full">
<i class="ri-check-line mr-1"></i> Listo
</button>
<button onclick="togglePaymentStatus(${order.id})" class="px-2 py-1 ${order.isPaid ? 'bg-primary/10 text-primary' : 'bg-gray-100 text-gray-600'} !rounded-full">
<i class="ri-wallet-3-line mr-1"></i> Pagado
</button>
</div>
</div>
<div class="space-y-1">
${order.items.map(item => `
<div class="flex justify-between items-center text-sm">
<span>${item.quantity}x ${item.name}</span>
<span>${getCurrencySymbol(item.currency)}${(item.price * item.quantity).toFixed(2)}</span>
</div>
`).join('')}
</div>
${order.notes ? `<p class="text-xs text-gray-500 mt-2 italic">${order.notes}</p>` : ''}
</div>
`;
}).join('');
}
window.showOrderDetails = function(orderId) {
const order = restaurantOrders.find(o => o.id === orderId);
if (!order) return;
const table = tables.find(t => t.id === order.tableId);
const elapsedTime = Math.floor((new Date() - new Date(order.createdAt)) / 1000);
const orderDetailsContent = document.getElementById('orderDetailsContent');
orderDetailsContent.innerHTML = `
<div class="flex justify-between items-start">
<div>
<p class="font-medium">${table.name}</p>
<p class="text-xs text-gray-500">Creado hace ${formatElapsedTime(elapsedTime)}</p>
</div>
<div class="flex gap-2">
<button onclick="updateOrderStatus(${order.id}, '${order.status === 'pending' ? 'in_progress' : 'ready'}')" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
${order.status === 'pending' ? 'Iniciar preparación' : order.status === 'in_progress' ? 'Marcar listo' : 'Entregado'}
</button>
</div>
</div>
<div class="mt-4 space-y-2">
${order.items.map((item, index) => `
<div class="flex justify-between items-center bg-gray-50 p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${item.quantity}x ${item.name}</p>
<p class="text-xs text-gray-500">${getCurrencySymbol(item.currency)}${(item.price * item.quantity).toFixed(2)}</p>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input type="checkbox" class="sr-only peer" ${order.itemsStatus[index].delivered ? 'checked' : ''} onchange="toggleItemDelivered(${order.id}, ${item.id}, this.checked)">
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none !rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:!rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
`).join('')}
</div>
${order.notes ? `<p class="text-sm text-gray-600 mt-4">${order.notes}</p>` : ''}
`;
orderDetailsModal.classList.remove('hidden');
};
window.toggleItemDelivered = function(orderId, productId, delivered) {
const orderIndex = restaurantOrders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
const itemIndex = restaurantOrders[orderIndex].itemsStatus.findIndex(item => item.productId === productId);
if (itemIndex === -1) return;
restaurantOrders[orderIndex].itemsStatus[itemIndex].delivered = delivered;
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateActiveOrdersList();
};
window.updateOrderStatus = function(orderId, newStatus) {
const orderIndex = restaurantOrders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
restaurantOrders[orderIndex].status = newStatus;
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateTableGrid();
updateActiveOrdersList();
orderDetailsModal.classList.add('hidden');
showToast(`Estado actualizado a: ${newStatus === 'in_progress' ? 'En proceso' : 'Listo'}`);
};
window.addMoreItems = function(orderId) {
const order = restaurantOrders.find(o => o.id === orderId);
if (!order) return;
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Agregar platos adicionales</h3>
<button class="close-add-items text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-3 mb-4">
<div id="additionalProductList" class="max-h-48 overflow-y-auto space-y-2">
${products.map(product => `
<div class="flex items-center justify-between bg-gray-50 p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${product.name}</p>
<p class="text-xs text-gray-500">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
</div>
<div class="flex items-center gap-2">
<button onclick="decreaseAdditionalQuantity('${product.id}')" class="w-6 h-6 bg-gray-200 !rounded-full flex items-center justify-center">-</button>
<span class="additional-quantity text-sm" data-product-id="${product.id}">0</span>
<button onclick="increaseAdditionalQuantity('${product.id}')" class="w-6 h-6 bg-primary text-white !rounded-full flex items-center justify-center">+</button>
</div>
</div>
`).join('')}
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas adicionales</label>
<textarea id="additionalNotes" rows="2" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-add-items px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button onclick="confirmAddItems(${orderId}); const modal = document.querySelector('.fixed.inset-0'); document.body.removeChild(modal);" class="px-4 py-2 bg-primary text-white !rounded-button">Agregar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-add-items').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.cancel-add-items').addEventListener('click', () => {
document.body.removeChild(modal);
});
};
window.decreaseAdditionalQuantity = function(productId) {
const quantitySpan = document.querySelector(`.additional-quantity[data-product-id="${productId}"]`);
let quantity = parseInt(quantitySpan.textContent);
if (quantity > 0) {
quantitySpan.textContent = quantity - 1;
}
};
window.increaseAdditionalQuantity = function(productId) {
const quantitySpan = document.querySelector(`.additional-quantity[data-product-id="${productId}"]`);
let quantity = parseInt(quantitySpan.textContent);
quantitySpan.textContent = quantity + 1;
};
window.confirmAddItems = function(orderId) {
const orderIndex = restaurantOrders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
const additionalItems = products.map(product => ({
...product,
quantity: parseInt(document.querySelector(`.additional-quantity[data-product-id="${product.id}"]`).textContent)
})).filter(product => product.quantity > 0);
if (additionalItems.length === 0) {
showToast('Agrega al menos un producto');
return;
}
const additionalNotes = document.getElementById('additionalNotes').value.trim();
// Add new items to the order
additionalItems.forEach(item => {
const existingItem = restaurantOrders[orderIndex].items.find(i => i.id === item.id);
if (existingItem) {
existingItem.quantity += item.quantity;
} else {
restaurantOrders[orderIndex].items.push(item);
restaurantOrders[orderIndex].itemsStatus.push({
productId: item.id,
delivered: false
});
}
});
// Append additional notes if any
if (additionalNotes) {
restaurantOrders[orderIndex].notes = restaurantOrders[orderIndex].notes
? `${restaurantOrders[orderIndex].notes}\n\nAdicional: ${additionalNotes}`
: `Adicional: ${additionalNotes}`;
}
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateTableGrid();
updateActiveOrdersList();
const modal = document.querySelector('.fixed.inset-0');
document.body.removeChild(modal);
showToast('Platos adicionales agregados');
};
window.completeOrder = function(orderId) {
const orderIndex = restaurantOrders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
const order = restaurantOrders[orderIndex];
if (!order.isPaid) {
showToast('Debe marcar la orden como pagada antes de completarla');
return;
}
// Update product stock
order.items.forEach(item => {
if (productStock[item.id]) {
productStock[item.id].available = Math.max(0, (productStock[item.id].available || 0) - item.quantity);
if (productStock[item.id].available <= productStock[item.id].alert_threshold) {
showToast(`Stock bajo para ${item.name}`);
}
}
});
localStorage.setItem('whatsappProductStock', JSON.stringify(productStock));
order.status = 'completed';
order.completedAt = new Date().toISOString();
// Clear table status
const tableIndex = tables.findIndex(t => t.id === order.tableId);
if (tableIndex !== -1) {
tables[tableIndex].status = 'available';
}
// Stop timer
if (order.timer) {
clearInterval(order.timer);
}
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateTableGrid();
updateActiveOrdersList();
updateDailySales();
showToast('Comanda completada');
};
window.togglePaymentStatus = function(orderId) {
const orderIndex = restaurantOrders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
const order = restaurantOrders[orderIndex];
order.isPaid = !order.isPaid;
if (order.isPaid) {
// Calculate service time
const startTime = new Date(order.createdAt).getTime();
const endTime = new Date().getTime();
const serviceTime = Math.floor((endTime - startTime) / 1000); // in seconds
// Complete the order
order.status = 'completed';
order.completedAt = new Date().toISOString();
order.serviceTime = serviceTime;
// Clear table status
const tableIndex = tables.findIndex(t => t.id === order.tableId);
if (tableIndex !== -1) {
tables[tableIndex].status = 'available';
}
// Stop timer
if (order.timer) {
clearInterval(order.timer);
}
showToast(`Mesa liberada - Tiempo de servicio: ${formatElapsedTime(serviceTime)}`);
} else {
showToast('Marcado como impago');
}
localStorage.setItem('whatsappRestaurantOrders', JSON.stringify(restaurantOrders));
updateActiveOrdersList();
updateDailySales();
};
function updateDailySales() {
const today = new Date().toISOString().split('T')[0];
const dailySales = restaurantOrders
.filter(order => {
const orderDate = new Date(order.createdAt).toISOString().split('T')[0];
return orderDate === today && order.isPaid;
})
.reduce((total, order) => {
return total + order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
}, 0);
const totalOrders = restaurantOrders.filter(order => {
const orderDate = new Date(order.createdAt).toISOString().split('T')[0];
return orderDate === today;
}).length;
const salesSummary = document.createElement('div');
salesSummary.className = 'bg-white p-3 !rounded-button shadow-sm border border-gray-200 mb-4';
salesSummary.innerHTML = `
<div class="flex justify-between items-center">
<div>
<h3 class="text-sm font-medium">Ventas del día</h3>
<p class="text-xs text-gray-500">Total de órdenes: ${totalOrders}</p>
</div>
<p class="text-lg font-medium text-primary">S/ ${dailySales.toFixed(2)}</p>
</div>
`;
const ordersList = document.getElementById('activeOrdersList');
if (ordersList.firstChild) {
ordersList.insertBefore(salesSummary, ordersList.firstChild);
}
}
// Add stock management
let productStock = JSON.parse(localStorage.getItem('whatsappProductStock')) || {};
function updateProductStock(productId, quantity) {
if (!productStock[productId]) {
productStock[productId] = {
available: 100, // Default stock
alert_threshold: 10 // Alert when stock is low
};
}
productStock[productId].available -= quantity;
localStorage.setItem('whatsappProductStock', JSON.stringify(productStock));
if (productStock[productId].available <= productStock[productId].alert_threshold) {
showToast(`Stock bajo para ${products.find(p => p.id === productId)?.name}`);
}
}
// Modify product list in new order modal to show stock
document.getElementById('manageProductsBtn').addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Gestionar Productos</h3>
<button class="close-products text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<button id="addNewProductBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2 mb-4">
<i class="ri-add-line"></i> Agregar nuevo producto
</button>
<div id="productsList" class="max-h-[60vh] overflow-y-auto space-y-3">
${products.length === 0 ?
'<p class="text-sm text-gray-500 text-center py-3">No hay productos agregados</p>' :
products.map(product => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<h4 class="font-medium">${product.name}</h4>
<p class="text-sm text-gray-500">${product.description}</p>
<p class="text-sm text-primary">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
<div class="flex items-center gap-2 mt-1">
<span class="text-xs ${(productStock[product.id]?.available || 0) <= (productStock[product.id]?.alert_threshold || 10) ? 'text-red-500' : 'text-gray-500'}">
Stock: ${productStock[product.id]?.available || 0}
</span>
<span class="text-xs text-gray-500">
Alerta: ${productStock[product.id]?.alert_threshold || 10}
</span>
</div>
</div>
<div class="flex gap-2">
<button onclick="editProduct('${product.id}')" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deleteProduct('${product.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
</div>
`).join('')}
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-products').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('#addNewProductBtn').addEventListener('click', () => {
const productModal = document.createElement('div');
productModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
productModal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nuevo Producto</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Nombre del producto" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Descripción" rows="2" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div class="flex gap-2">
<input type="number" step="0.01" placeholder="Precio" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<select class="w-24 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="PEN">S/</option>
<option value="USD">$</option>
<option value="EUR">€</option>
</select>
</div>
<div class="flex gap-2">
<div class="flex-1">
<label class="text-xs text-gray-500 mb-1 block">Stock inicial</label>
<input type="number" placeholder="100" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div class="flex-1">
<label class="text-xs text-gray-500 mb-1 block">Alerta stock bajo</label>
<input type="number" placeholder="10" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-product px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-product px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(productModal);
productModal.querySelector('.cancel-product').addEventListener('click', () => {
document.body.removeChild(productModal);
});
productModal.querySelector('.save-product').addEventListener('click', () => {
const name = productModal.querySelector('input[placeholder="Nombre del producto"]').value.trim();
const description = productModal.querySelector('textarea').value.trim();
const price = parseFloat(productModal.querySelector('input[type="number"][placeholder="Precio"]').value);
const currency = productModal.querySelector('select').value;
const stock = parseInt(productModal.querySelector('input[placeholder="100"]').value) || 100;
const alertThreshold = parseInt(productModal.querySelector('input[placeholder="10"]').value) || 10;
if (!name || !description || !price) {
showToast('Completa todos los campos');
return;
}
const newProduct = {
id: Date.now().toString(),
name,
description,
price,
currency
};
products.push(newProduct);
productStock[newProduct.id] = {
available: stock,
alert_threshold: alertThreshold
};
localStorage.setItem('whatsappProducts', JSON.stringify(products));
localStorage.setItem('whatsappProductStock', JSON.stringify(productStock));
document.body.removeChild(productModal);
document.body.removeChild(modal);
showToast('Producto agregado');
});
});
});
function showNewOrderModal() {
const tableSelect = document.getElementById('tableSelect');
const productList = document.getElementById('productList');
tableSelect.innerHTML = `
<option value="">Seleccionar mesa</option>
${tables.map(table => {
const isOccupied = restaurantOrders.some(o => o.tableId === table.id && o.status !== 'completed');
return `<option value="${table.id}" ${isOccupied ? 'disabled' : ''}>${table.name} ${isOccupied ? '(Ocupada)' : ''}</option>`;
}).join('')}
`;
productList.innerHTML = products.map(product => {
const stock = productStock[product.id]?.available || 100;
return `
<div class="flex items-center justify-between bg-gray-50 p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${product.name}</p>
<p class="text-xs text-gray-500">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
<p class="text-xs ${stock <= 10 ? 'text-red-500' : 'text-gray-500'}">Stock: ${stock}</p>
</div>
<div class="flex items-center gap-2">
<button onclick="decreaseQuantity(${product.id})" class="w-6 h-6 bg-gray-200 !rounded-full flex items-center justify-center">-</button>
<span class="product-quantity text-sm" data-product-id="${product.id}">0</span>
<button onclick="increaseQuantity(${product.id})" class="w-6 h-6 bg-primary text-white !rounded-full flex items-center justify-center" ${stock <= 0 ? 'disabled' : ''}>+</button>
</div>
</div>
`;
}).join('');
newOrderModal.classList.remove('hidden');
}
function formatElapsedTime(seconds) {
const hours = Math.floor(seconds / 3600);
const minutes = Math.floor((seconds % 3600) / 60);
const remainingSeconds = seconds % 60;
if (hours > 0) {
return `${hours}h ${minutes}m`;
} else if (minutes > 0) {
return `${minutes}m ${remainingSeconds}s`;
} else {
return `${remainingSeconds}s`;
}
}
// Update order timers every second
setInterval(() => {
const activeOrdersList = document.getElementById('activeOrdersList');
if (activeOrdersList && !activeOrdersList.contains(document.querySelector('.text-gray-500'))) {
updateActiveOrdersList();
}
}, 1000);
// CRM Management
const crmBtn = document.getElementById('crmBtn');
const crmModal = document.getElementById('crmModal');
const closeCrm = document.getElementById('closeCrm');
const crmSearch = document.getElementById('crmSearch');
const crmClientsList = document.getElementById('crmClientsList');
const taskModal = document.getElementById('taskModal');
const closeTask = document.getElementById('closeTask');
crmBtn.addEventListener('click', function() {
crmModal.classList.remove('hidden');
updateCrmClientsList();
});
closeCrm.addEventListener('click', function() {
crmModal.classList.add('hidden');
});
closeTask.addEventListener('click', function() {
taskModal.classList.add('hidden');
});
crmSearch.addEventListener('input', function() {
updateCrmClientsList(this.value.trim());
});
function updateCrmClientsList(searchTerm = '') {
if (savedPhones.length === 0) {
crmClientsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay clientes registrados</p>';
return;
}
function getClientReminders(clientId) {
const reminders = JSON.parse(localStorage.getItem('whatsappReminders')) || [];
const clientReminders = reminders.filter(r => r.clientId === clientId && r.status === 'pending');
if (clientReminders.length === 0) return '';
return clientReminders.map(reminder => `
<div class="flex items-center gap-2 mt-1">
<i class="ri-alarm-line text-primary text-xs"></i>
<p class="text-xs text-gray-500">${reminder.title} - ${new Date(reminder.datetime).toLocaleString()}</p>
</div>
`).join('');
}
const filteredClients = searchTerm
? savedPhones.filter(client =>
client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
client.number.includes(searchTerm)
)
: savedPhones;
if (filteredClients.length === 0) {
crmClientsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No se encontraron clientes</p>';
return;
}
crmClientsList.innerHTML = filteredClients.map(client => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="font-medium">${client.name}</p>
<p class="text-sm text-gray-500">+${client.countryCode}${client.number}</p>
${client.notes ? `<p class="text-xs text-gray-500 mt-1 italic">${client.notes}</p>` : ''}
${getClientReminders(client.id)}
</div>
<div class="flex gap-2">
<button onclick="showClientTasks('${client.id}')" class="px-3 py-1 bg-primary text-white !rounded-button text-sm">
Tareas
</button>
</div>
</div>
<div class="flex flex-wrap gap-1 mt-2">
${(client.tags || []).map(tag => `
<span class="px-2 py-0.5 bg-primary/10 text-primary text-xs !rounded-full">${tag}</span>
`).join('')}
</div>
</div>
`).join('');
}
window.showClientTasks = function(clientId) {
const client = savedPhones.find(c => c.id === clientId);
if (!client) return;
taskModal.querySelector('h3').textContent = `Tareas para ${client.name}`;
const taskBtns = taskModal.querySelectorAll('.task-btn');
taskBtns.forEach(btn => {
btn.onclick = () => handleClientTask(btn.textContent.trim(), client);
});
crmModal.classList.add('hidden');
taskModal.classList.remove('hidden');
};
function handleClientTask(task, client) {
const phone = client.countryCode + client.number;
switch(task) {
case 'Enviar mensaje':
taskModal.classList.add('hidden');
document.getElementById('selectedCountryCode').textContent = '+' + client.countryCode;
document.getElementById('phoneNumber').value = client.number;
break;
case 'Enviar SMS':
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Enviar SMS a ${client.name}</h3>
<div class="space-y-3 mb-4">
<textarea id="smsContent" rows="4" placeholder="Escribe tu mensaje..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<p class="text-xs text-gray-500">Caracteres: <span id="smsCharCount">0</span>/160</p>
<div class="flex items-center gap-2">
<input type="checkbox" id="saveAsSMSTemplate">
<label for="saveAsSMSTemplate" class="text-sm">Guardar como plantilla</label>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-sms px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-sms px-4 py-2 bg-primary text-white !rounded-button">Enviar SMS</button>
</div>
</div>
`;
document.body.appendChild(modal);
const smsContent = modal.querySelector('#smsContent');
const charCount = modal.querySelector('#smsCharCount');
smsContent.addEventListener('input', function() {
const count = this.value.length;
charCount.textContent = count;
if (count > 160) {
charCount.classList.add('text-red-500');
} else {
charCount.classList.remove('text-red-500');
}
});
modal.querySelector('.cancel-sms').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-sms').addEventListener('click', () => {
const message = smsContent.value.trim();
if (!message) {
showToast('Escribe un mensaje');
return;
}
if (message.length > 160) {
showToast('El mensaje excede los 160 caracteres');
return;
}
const saveAsTemplate = modal.querySelector('#saveAsSMSTemplate').checked;
if (saveAsTemplate) {
const templates = JSON.parse(localStorage.getItem('whatsappSMSTemplates') || '[]');
templates.push({
id: Date.now(),
text: message
});
localStorage.setItem('whatsappSMSTemplates', JSON.stringify(templates));
}
const smsUrl = `sms:${phone}?body=${encodeURIComponent(message)}`;
window.open(smsUrl);
const sentSMS = {
id: Date.now(),
phone: phone,
message: message,
date: new Date().toISOString(),
type: 'sms'
};
const sentMessages = JSON.parse(localStorage.getItem('whatsappSentMessages') || '[]');
sentMessages.unshift(sentSMS);
localStorage.setItem('whatsappSentMessages', JSON.stringify(sentMessages));
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('SMS enviado');
});
break;
case 'Hacer seguimiento':
showFollowUpModal(client);
break;
case 'Llamar':
window.open(`tel:+${phone}`);
break;
case 'Enviar propuesta':
showProposalModal(client);
break;
case 'Dar promoción/descuento':
showPromotionModal(client);
break;
case 'Agregar nota':
showNoteModal(client);
break;
case 'Programar recordatorio':
showReminderModal(client);
break;
case 'Crear proforma':
showProformaModal(client);
break;
case 'Agendar cita':
showAppointmentModal(client);
break;
}
}
function showProformaModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Crear proforma para ${client.name}</h3>
<div class="space-y-3 mb-4">
<div class="flex items-center gap-2 mb-2">
<div class="relative flex-1">
<i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
<input type="text" id="productSearch" placeholder="Buscar productos..." class="w-full pl-9 pr-3 py-2 bg-gray-50 border-none !rounded-button text-sm">
</div>
<select id="categoryFilter" class="px-3 py-2 bg-gray-50 border-none !rounded-button text-sm">
<option value="">Todas las categorías</option>
${categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('')}
</select>
</div>
<div class="max-h-48 overflow-y-auto space-y-2" id="productsList">
${products.map(product => `
<div class="flex items-center justify-between bg-gray-50 p-2 !rounded-button" data-category="${product.categoryId || ''}">
<div class="flex-1 min-w-0">
<p class="text-sm font-medium truncate">${product.name}</p>
<div class="flex items-center gap-2">
<p class="text-xs text-primary">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
<p class="text-xs text-gray-500">Stock: ${productStock[product.id]?.available || 0}</p>
</div>
</div>
<div class="flex items-center gap-2">
<button onclick="decreaseProformaQuantity('${product.id}')" class="w-6 h-6 bg-gray-200 !rounded-full flex items-center justify-center">-</button>
<span class="proforma-quantity text-sm" data-product-id="${product.id}">0</span>
<button onclick="increaseProformaQuantity('${product.id}')" class="w-6 h-6 bg-primary text-white !rounded-full flex items-center justify-center" ${(productStock[product.id]?.available || 0) <= 0 ? 'disabled' : ''}>+</button>
</div>
</div>
`).join('')}
</div>
<div id="selectedProducts" class="border-t border-gray-200 mt-3 pt-3 space-y-2 hidden">
<p class="text-sm font-medium">Productos seleccionados:</p>
<div id="selectedProductsList" class="space-y-2"></div>
<div class="flex justify-between items-center pt-2 border-t border-gray-200">
<span class="text-sm font-medium">Total:</span>
<span id="totalAmount" class="text-lg font-medium text-primary">S/ 0.00</span>
</div>
</div>
<div class="space-y-2 mt-3">
<textarea placeholder="Notas adicionales..." rows="2" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div class="flex items-center gap-2">
<input type="checkbox" id="includeIGV" checked>
<label for="includeIGV" class="text-sm">Incluir IGV (18%)</label>
</div>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-proforma px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-proforma px-4 py-2 bg-primary text-white !rounded-button">Enviar proforma</button>
</div>
</div>
`;
document.body.appendChild(modal);
const productSearch = modal.querySelector('#productSearch');
const categoryFilter = modal.querySelector('#categoryFilter');
const productsList = modal.querySelector('#productsList');
const selectedProducts = modal.querySelector('#selectedProducts');
const selectedProductsList = modal.querySelector('#selectedProductsList');
const totalAmount = modal.querySelector('#totalAmount');
const includeIGV = modal.querySelector('#includeIGV');
function updateSelectedProducts() {
const selected = Array.from(productsList.querySelectorAll('.proforma-quantity')).filter(span => parseInt(span.textContent) > 0);
if (selected.length > 0) {
selectedProducts.classList.remove('hidden');
selectedProductsList.innerHTML = selected.map(span => {
const productId = span.dataset.productId;
const product = products.find(p => p.id === productId);
const quantity = parseInt(span.textContent);
const subtotal = product.price * quantity;
return `
<div class="flex items-center justify-between bg-gray-50 p-2 !rounded-button">
<div>
<p class="text-sm font-medium">${product.name}</p>
<p class="text-xs text-gray-500">${quantity} x ${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</p>
</div>
<p class="text-sm font-medium">${getCurrencySymbol(product.currency)}${subtotal.toFixed(2)}</p>
</div>
`;
}).join('');
const subtotal = selected.reduce((sum, span) => {
const productId = span.dataset.productId;
const product = products.find(p => p.id === productId);
const quantity = parseInt(span.textContent);
return sum + (product.price * quantity);
}, 0);
const total = includeIGV.checked ? subtotal * 1.18 : subtotal;
totalAmount.textContent = `${getCurrencySymbol(products[0].currency)}${total.toFixed(2)}`;
} else {
selectedProducts.classList.add('hidden');
}
}
window.decreaseProformaQuantity = function(productId) {
const quantitySpan = modal.querySelector(`.proforma-quantity[data-product-id="${productId}"]`);
let quantity = parseInt(quantitySpan.textContent);
if (quantity > 0) {
quantitySpan.textContent = quantity - 1;
updateSelectedProducts();
}
};
window.increaseProformaQuantity = function(productId) {
const quantitySpan = modal.querySelector(`.proforma-quantity[data-product-id="${productId}"]`);
const product = products.find(p => p.id === productId);
const stock = productStock[productId]?.available || 0;
let quantity = parseInt(quantitySpan.textContent);
if (quantity < stock) {
quantitySpan.textContent = quantity + 1;
updateSelectedProducts();
} else {
showToast('Stock no disponible');
}
};
productSearch.addEventListener('input', function() {
const searchTerm = this.value.toLowerCase();
const categoryId = categoryFilter.value;
Array.from(productsList.children).forEach(product => {
const name = product.querySelector('.font-medium').textContent.toLowerCase();
const productCategoryId = product.dataset.category;
const matchesSearch = name.includes(searchTerm);
const matchesCategory = !categoryId || productCategoryId === categoryId;
product.classList.toggle('hidden', !matchesSearch || !matchesCategory);
});
});
categoryFilter.addEventListener('change', function() {
const categoryId = this.value;
const searchTerm = productSearch.value.toLowerCase();
Array.from(productsList.children).forEach(product => {
const name = product.querySelector('.font-medium').textContent.toLowerCase();
const productCategoryId = product.dataset.category;
const matchesSearch = name.includes(searchTerm);
const matchesCategory = !categoryId || productCategoryId === categoryId;
product.classList.toggle('hidden', !matchesSearch || !matchesCategory);
});
});
includeIGV.addEventListener('change', updateSelectedProducts);
modal.querySelector('.cancel-proforma').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-proforma').addEventListener('click', () => {
const selectedProducts = products.map(product => ({
...product,
quantity: parseInt(modal.querySelector(`.proforma-quantity[data-product-id="${product.id}"]`).textContent)
})).filter(product => product.quantity > 0);
if (selectedProducts.length === 0) {
showToast('Selecciona al menos un producto');
return;
}
const notes = modal.querySelector('textarea').value.trim();
const subtotal = selectedProducts.reduce((sum, product) => sum + (product.price * product.quantity), 0);
const includeIGV = modal.querySelector('#includeIGV').checked;
const total = includeIGV ? subtotal * 1.18 : subtotal;
const igvAmount = includeIGV ? subtotal * 0.18 : 0;
const message = `*PROFORMA*\n\nEstimado/a ${client.name},\n\n*Productos seleccionados:*\n${selectedProducts.map(product =>
`• ${product.quantity}x ${product.name}\n  ${getCurrencySymbol(product.currency)}${(product.price * product.quantity).toFixed(2)}`
).join('\n')}\n\n*Subtotal: ${getCurrencySymbol(selectedProducts[0].currency)}${subtotal.toFixed(2)}*${
includeIGV ? `\n*IGV (18%): ${getCurrencySymbol(selectedProducts[0].currency)}${igvAmount.toFixed(2)}*` : ''
}\n*Total${includeIGV ? ' (Inc. IGV)' : ''}: ${getCurrencySymbol(selectedProducts[0].currency)}${total.toFixed(2)}*${
notes ? `\n\nNotas:\n${notes}` : ''
}\n\nProforma válida por 7 días.`;
messageText.value = message;
updatePreview();
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Proforma lista para enviar');
});
}
function showAppointmentModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Agendar cita con ${client.name}</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Fecha y hora</label>
<input type="datetime-local" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Duración</label>
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="30">30 minutos</option>
<option value="60">1 hora</option>
<option value="90">1 hora 30 minutos</option>
<option value="120">2 horas</option>
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Motivo de la cita</label>
<input type="text" placeholder="Ej: Consulta inicial" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas adicionales</label>
<textarea rows="2" placeholder="Detalles adicionales..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
<div class="flex items-center gap-2">
<input type="checkbox" id="sendReminder" checked>
<label for="sendReminder" class="text-sm">Enviar recordatorio 1 hora antes</label>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-appointment px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-appointment px-4 py-2 bg-primary text-white !rounded-button">Agendar y notificar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-appointment').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-appointment').addEventListener('click', () => {
const datetime = modal.querySelector('input[type="datetime-local"]').value;
const duration = modal.querySelector('select').value;
const subject = modal.querySelector('input[type="text"]').value.trim();
const notes = modal.querySelector('textarea').value.trim();
const sendReminder = modal.querySelector('#sendReminder').checked;
if (!datetime || !subject) {
showToast('Completa los campos requeridos');
return;
}
const appointmentDate = new Date(datetime);
const message = `*CONFIRMACIÓN DE CITA*\n\nHola ${client.name},\n\nTu cita ha sido programada para:\n\n📅 Fecha: ${appointmentDate.toLocaleDateString()}\n⏰ Hora: ${appointmentDate.toLocaleTimeString()}\n⏱️ Duración: ${duration} minutos\n📝 Motivo: ${subject}${notes ? `\n\nNotas:\n${notes}` : ''}`;
messageText.value = message;
updatePreview();
if (sendReminder) {
const reminderTime = new Date(appointmentDate.getTime() - 60 * 60 * 1000); // 1 hour before
const reminder = {
id: Date.now(),
clientId: client.id,
title: `Recordatorio: ${subject}`,
details: `Tienes una cita programada para hoy a las ${appointmentDate.toLocaleTimeString()}`,
datetime: reminderTime.toISOString(),
status: 'pending'
};
const reminders = JSON.parse(localStorage.getItem('whatsappReminders')) || [];
reminders.push(reminder);
localStorage.setItem('whatsappReminders', JSON.stringify(reminders));
}
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Cita agendada y mensaje listo para enviar');
});
}
function showFollowUpModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Seguimiento para ${client.name}</h3>
<div class="space-y-3 mb-4">
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="pending">Pendiente</option>
<option value="interested">Interesado</option>
<option value="negotiating">En negociación</option>
<option value="closed">Cerrado</option>
</select>
<textarea placeholder="Notas de seguimiento..." rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-followup px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-followup px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-followup').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-followup').addEventListener('click', () => {
const status = modal.querySelector('select').value;
const notes = modal.querySelector('textarea').value.trim();
if (!notes) {
showToast('Agrega algunas notas de seguimiento');
return;
}
// Save follow-up data
const followUp = {
id: Date.now(),
clientId: client.id,
status,
notes,
date: new Date().toISOString()
};
const followUps = JSON.parse(localStorage.getItem('whatsappFollowUps')) || [];
followUps.push(followUp);
localStorage.setItem('whatsappFollowUps', JSON.stringify(followUps));
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Seguimiento guardado');
});
}
function showProposalModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Enviar propuesta a ${client.name}</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Título de la propuesta" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Detalles de la propuesta..." rows="4" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<div class="flex items-center gap-2">
<input type="number" placeholder="Monto" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<select class="w-24 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="PEN">S/</option>
<option value="USD">$</option>
<option value="EUR">€</option>
</select>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-proposal px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-proposal px-4 py-2 bg-primary text-white !rounded-button">Enviar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-proposal').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-proposal').addEventListener('click', () => {
const title = modal.querySelector('input[type="text"]').value.trim();
const details = modal.querySelector('textarea').value.trim();
const amount = modal.querySelector('input[type="number"]').value;
const currency = modal.querySelector('select').value;
if (!title || !details || !amount) {
showToast('Completa todos los campos');
return;
}
const message = `*PROPUESTA COMERCIAL*\n\n*${title}*\n\n${details}\n\n*Inversión:* ${currency === 'PEN' ? 'S/' : currency === 'USD' ? '$' : '€'} ${amount}`;
messageText.value = message;
updatePreview();
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Propuesta lista para enviar');
});
}
function showPromotionModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Promoción para ${client.name}</h3>
<div class="space-y-3 mb-4">
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="discount">Descuento</option>
<option value="2x1">2x1</option>
<option value="gift">Regalo</option>
<option value="free">Prueba gratis</option>
</select>
<input type="number" placeholder="Porcentaje de descuento" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Detalles de la promoción..." rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<input type="date" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div class="flex justify-end gap-2">
<button class="cancel-promo px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-promo px-4 py-2 bg-primary text-white !rounded-button">Enviar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-promo').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-promo').addEventListener('click', () => {
const type = modal.querySelector('select').value;
const discount = modal.querySelector('input[type="number"]').value;
const details = modal.querySelector('textarea').value.trim();
const validUntil = modal.querySelector('input[type="date"]').value;
if (!details || !validUntil) {
showToast('Completa todos los campos');
return;
}
const message = `*¡PROMOCIÓN ESPECIAL!* 🎉\n\n${type === 'discount' ? `*${discount}% de DESCUENTO*` : type === '2x1' ? '*Promoción 2x1*' : type === 'gift' ? '*Regalo especial*' : '*Prueba gratis*'}\n\n${details}\n\n*Válido hasta:* ${new Date(validUntil).toLocaleDateString()}`;
messageText.value = message;
updatePreview();
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Promoción lista para enviar');
});
}
function showNoteModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nota para ${client.name}</h3>
<textarea placeholder="Escribe tu nota..." rows="4" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none mb-4">${client.notes || ''}</textarea>
<div class="flex justify-end gap-2">
<button class="cancel-note px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-note px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-note').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-note').addEventListener('click', () => {
const notes = modal.querySelector('textarea').value.trim();
const index = savedPhones.findIndex(c => c.id === client.id);
if (index !== -1) {
savedPhones[index].notes = notes;
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateCrmClientsList();
}
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Nota guardada');
});
}
function showReminderModal(client) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Recordatorio para ${client.name}</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Título del recordatorio" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Detalles..." rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<input type="datetime-local" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div class="flex justify-end gap-2">
<button class="cancel-reminder px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-reminder px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-reminder').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-reminder').addEventListener('click', () => {
const title = modal.querySelector('input[type="text"]').value.trim();
const details = modal.querySelector('textarea').value.trim();
const datetime = modal.querySelector('input[type="datetime-local"]').value;
if (!title || !details || !datetime) {
showToast('Completa todos los campos');
return;
}
const reminder = {
id: Date.now(),
clientId: client.id,
title,
details,
datetime,
status: 'pending'
};
const reminders = JSON.parse(localStorage.getItem('whatsappReminders')) || [];
reminders.push(reminder);
localStorage.setItem('whatsappReminders', JSON.stringify(reminders));
document.body.removeChild(modal);
taskModal.classList.add('hidden');
showToast('Recordatorio guardado');
// Schedule notification
const reminderTime = new Date(datetime).getTime();
const now = new Date().getTime();
if (reminderTime > now) {
setTimeout(() => {
const notification = document.createElement('div');
notification.className = 'fixed top-4 right-4 bg-white !rounded-button p-4 shadow-lg z-50 max-w-sm';
notification.innerHTML = `
<div class="flex items-start gap-3">
<i class="ri-notification-line text-primary ri-lg"></i>
<div class="flex-1">
<p class="font-medium">${title}</p>
<p class="text-sm text-gray-600">${details}</p>
<p class="text-xs text-gray-500 mt-1">Cliente: ${client.name}</p>
</div>
<button class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line"></i>
</button>
</div>
`;
document.body.appendChild(notification);
notification.querySelector('button').addEventListener('click', () => {
document.body.removeChild(notification);
});
setTimeout(() => {
if (document.body.contains(notification)) {
document.body.removeChild(notification);
}
}, 5000);
}, reminderTime - now);
}
});
}
// AI Sales Closing Generator
const aiClosingBtn = document.getElementById('aiClosingBtn');
const aiClosingModal = document.getElementById('aiClosingModal');
const closeAiClosing = document.getElementById('closeAiClosing');
const generateClosingBtn = document.getElementById('generateClosingBtn');
const closingResult = document.getElementById('closingResult');
const closingText = document.getElementById('closingText');
const useClosingBtn = document.getElementById('useClosingBtn');
const clearAiClosingBtn = document.getElementById('clearAiClosingBtn');
const autoGenerateBtn = document.getElementById('autoGenerateBtn');
aiClosingBtn.addEventListener('click', function() {
aiClosingModal.classList.remove('hidden');
});
closeAiClosing.addEventListener('click', function() {
aiClosingModal.classList.add('hidden');
});
clearAiClosingBtn.addEventListener('click', function() {
document.getElementById('productInput').value = '';
document.getElementById('featuresInput').value = '';
document.getElementById('styleSelect').value = 'professional';
closingResult.classList.add('hidden');
showToast('Campos limpiados');
});
autoGenerateBtn.addEventListener('click', function() {
const products = [
'Curso de marketing digital',
'Servicio de consultoría empresarial',
'Programa de entrenamiento personal',
'Software de gestión de proyectos',
'Plan de nutrición personalizado'
];
const features = [
'Clases en vivo, certificación internacional, mentorías personalizadas',
'Análisis detallado, estrategias personalizadas, seguimiento continuo',
'Rutinas adaptadas, seguimiento online, plan nutricional incluido',
'Interfaz intuitiva, reportes avanzados, soporte 24/7',
'Menús semanales, asesoría nutricional, seguimiento de progreso'
];
const styles = ['professional', 'friendly', 'urgent', 'exclusive'];
document.getElementById('productInput').value = products[Math.floor(Math.random() * products.length)];
document.getElementById('featuresInput').value = features[Math.floor(Math.random() * features.length)];
document.getElementById('styleSelect').value = styles[Math.floor(Math.random() * styles.length)];
generateClosingBtn.click();
showToast('Cierre de venta generado automáticamente');
});
const closingTemplates = {
professional: [
"✨ *¡Excelente elección!* ✨\n\n*[producto]* es exactamente lo que necesitas para [beneficio]. Con características como:\n\n• [características]\n\n*¿Por qué elegir ahora?*\n🎯 Resultados comprobados\n💫 Garantía de satisfacción\n⭐ Soporte premium\n\n*¡Toma acción hoy!* 🚀",
"🌟 *Aprovecha esta oportunidad única* 🌟\n\n*[producto]* te ofrece:\n\n[características]\n\n*Beneficios exclusivos:*\n✅ Máxima calidad\n✅ Resultados garantizados\n✅ Soporte personalizado\n\n*¡No esperes más!* 💫"
],
friendly: [
"🤗 *¡Hola! ¿Qué tal?*\n\nTe cuento que *[producto]* es justo lo que buscabas:\n\n[características]\n\n*¿Lo mejor?*\n❤️ Te va a encantar\n🎯 Es súper fácil de usar\n✨ Resultados increíbles\n\n*¡Anímate!* Es el momento perfecto 🌟",
"👋 *¡Hey! ¿Sabes qué?*\n\n*[producto]* está esperándote con:\n\n[características]\n\n*Te va a encantar porque:*\n💝 Es justo lo que necesitas\n🎉 Resultados increíbles\n⭐ Súper fácil de usar\n\n*¡Vamos!* Es tu momento 🌈"
],
urgent: [
"⚡ *¡ÚLTIMA OPORTUNIDAD!* ⚡\n\n*[producto]* - *¡NO ESPERES MÁS!*\n\n[características]\n\n*BENEFICIOS EXCLUSIVOS:*\n🔥 Oferta por tiempo limitado\n💥 Precio especial HOY\n⚡ Bono exclusivo\n\n*¡ACTÚA AHORA!* ⏰",
"🚨 *¡ATENCIÓN! OFERTA ESPECIAL* 🚨\n\n*[producto]* - *¡ÚLTIMAS UNIDADES!*\n\n[características]\n\n*¡APROVECHA YA!*\n⚡ Descuento especial\n🎁 Bonos exclusivos\n⏰ Tiempo limitado\n\n*¡NO PIERDAS ESTA OPORTUNIDAD!* 🔥"
],
exclusive: [
"✨ *Experiencia Premium* ✨\n\n*[producto]* - *Exclusividad y Distinción*\n\n[características]\n\n*Beneficios Elite:*\n👑 Atención VIP\n💎 Calidad superior\n🌟 Resultados excepcionales\n\n*Eleva tu nivel hoy* ✨",
"💎 *Exclusividad Total* 💎\n\n*[producto]* - *Tu Mejor Elección*\n\n[características]\n\n*Ventajas Premium:*\n🏆 Máxima calidad\n👑 Servicio VIP\n✨ Resultados superiores\n\n*Únete a la excelencia* 🌟"
]
};
generateClosingBtn.addEventListener('click', function() {
const product = document.getElementById('productInput').value.trim();
const features = document.getElementById('featuresInput').value.trim();
const style = document.getElementById('styleSelect').value;
if (!product || !features) {
showToast('Completa todos los campos');
return;
}
const templates = closingTemplates[style];
const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
let featuresList = features.split(',').map(feature => feature.trim()).filter(feature => feature);
let formattedFeatures = featuresList.map(feature => `📌 ${feature}`).join('\n');
const closing = randomTemplate
.replace('[producto]', product)
.replace('[características]', formattedFeatures)
.replace('[beneficio]', featuresList[0].toLowerCase());
closingText.innerHTML = closing.replace(/\n/g, '<br>');
closingResult.classList.remove('hidden');
});
useClosingBtn.addEventListener('click', function() {
messageText.value = closingText.innerHTML.replace(/<br>/g, '\n');
updatePreview();
aiClosingModal.classList.add('hidden');
showToast('Mensaje de cierre agregado');
});
// Radio Station Management
const radioBtn = document.getElementById('radioBtn');
const radioModal = document.getElementById('radioModal');
const closeRadio = document.getElementById('closeRadio');
const addStationBtn = document.getElementById('addStationBtn');
const stationsList = document.getElementById('stationsList');
let radioStations = JSON.parse(localStorage.getItem('whatsappRadioStations')) || [{
id: 'default-kpop',
name: 'K-pop Radio',
url: 'https://kpop4you.stream.laut.fm/kpop4you?ref=radiodns',
isPlaying: false,
volume: 1
}];
let currentAudio = null;
radioBtn.addEventListener('click', function() {
radioModal.classList.remove('hidden');
updateStationsList();
});
closeRadio.addEventListener('click', function() {
radioModal.classList.add('hidden');
});
addStationBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Agregar estación</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Nombre de la estación</label>
<input type="text" placeholder="Mi estación" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">URL del stream</label>
<input type="url" placeholder="https://..." class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-station px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-station px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-station').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-station').addEventListener('click', () => {
const name = modal.querySelector('input[type="text"]').value.trim();
const url = modal.querySelector('input[type="url"]').value.trim();
if (!name || !url) {
showToast('Completa todos los campos');
return;
}
const newStation = {
id: Date.now().toString(),
name,
url,
isPlaying: false,
volume: 1
};
radioStations.push(newStation);
localStorage.setItem('whatsappRadioStations', JSON.stringify(radioStations));
updateStationsList();
document.body.removeChild(modal);
showToast('Estación agregada');
});
});
function updateStationsList() {
if (radioStations.length === 0) {
stationsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay estaciones agregadas</p>';
return;
}
stationsList.innerHTML = radioStations.map(station => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<h4 class="font-medium">${station.name}</h4>
<div class="flex gap-2">
<button onclick="editStation('${station.id}')" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deleteStation('${station.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<div class="flex items-center gap-3">
<button onclick="togglePlay('${station.id}')" class="w-8 h-8 flex items-center justify-center bg-primary text-white !rounded-full" data-station-id="${station.id}">
<i class="ri-${station.isPlaying ? 'pause' : 'play'}-fill"></i>
</button>
<input type="range" min="0" max="100" value="${station.volume * 100}"
class="flex-1 h-1 bg-gray-200 !rounded-full appearance-none cursor-pointer"
onchange="updateVolume('${station.id}', this.value)"
style="background: linear-gradient(to right, #25D366 0%, #25D366 ${station.volume * 100}%, #E5E7EB ${station.volume * 100}%, #E5E7EB 100%)">
</div>
</div>
`).join('');
}
window.togglePlay = function(stationId) {
const station = radioStations.find(s => s.id === stationId);
if (!station) return;
if (currentAudio && currentAudio.stationId !== stationId) {
currentAudio.audio.pause();
const oldStation = radioStations.find(s => s.id === currentAudio.stationId);
if (oldStation) {
oldStation.isPlaying = false;
}
currentAudio = null;
}
if (!currentAudio) {
const audio = new Audio(station.url);
audio.volume = station.volume;
currentAudio = { audio, stationId };
}
if (station.isPlaying) {
currentAudio.audio.pause();
station.isPlaying = false;
} else {
currentAudio.audio.play().catch(error => {
showToast('Error al reproducir la estación');
console.error(error);
});
station.isPlaying = true;
}
localStorage.setItem('whatsappRadioStations', JSON.stringify(radioStations));
updateStationsList();
};
window.updateVolume = function(stationId, value) {
const station = radioStations.find(s => s.id === stationId);
if (!station) return;
const volume = value / 100;
station.volume = volume;
if (currentAudio && currentAudio.stationId === stationId) {
currentAudio.audio.volume = volume;
}
const slider = document.querySelector(`input[type="range"][onchange*="${stationId}"]`);
if (slider) {
slider.style.background = `linear-gradient(to right, #25D366 0%, #25D366 ${value}%, #E5E7EB ${value}%, #E5E7EB 100%)`;
}
localStorage.setItem('whatsappRadioStations', JSON.stringify(radioStations));
};
window.editStation = function(stationId) {
const station = radioStations.find(s => s.id === stationId);
if (!station) return;
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Editar estación</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Nombre de la estación</label>
<input type="text" value="${station.name}" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">URL del stream</label>
<input type="url" value="${station.url}" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-edit px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-edit px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-edit').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-edit').addEventListener('click', () => {
const name = modal.querySelector('input[type="text"]').value.trim();
const url = modal.querySelector('input[type="url"]').value.trim();
if (!name || !url) {
showToast('Completa todos los campos');
return;
}
const index = radioStations.findIndex(s => s.id === stationId);
radioStations[index] = { ...radioStations[index], name, url };
if (currentAudio && currentAudio.stationId === stationId) {
currentAudio.audio.src = url;
if (radioStations[index].isPlaying) {
currentAudio.audio.play();
}
}
localStorage.setItem('whatsappRadioStations', JSON.stringify(radioStations));
updateStationsList();
document.body.removeChild(modal);
showToast('Estación actualizada');
});
};
window.deleteStation = function(stationId) {
if (currentAudio && currentAudio.stationId === stationId) {
currentAudio.audio.pause();
currentAudio = null;
}
radioStations = radioStations.filter(s => s.id !== stationId);
localStorage.setItem('whatsappRadioStations', JSON.stringify(radioStations));
updateStationsList();
showToast('Estación eliminada');
};
// Delete All Contacts
const deleteAllContactsBtn = document.getElementById('deleteAllContactsBtn');
deleteAllContactsBtn.addEventListener('click', function() {
if (savedPhones.length === 0) {
showToast('No hay contactos para eliminar');
return;
}
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Eliminar todos los contactos</h3>
<p class="text-sm text-gray-600 mb-4">¿Estás seguro de que deseas eliminar todos los contactos? Esta acción no se puede deshacer.</p>
<div class="flex justify-end gap-2">
<button class="cancel-delete px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="confirm-delete px-4 py-2 bg-red-500 text-white !rounded-button">Eliminar todos</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-delete').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.confirm-delete').addEventListener('click', () => {
savedPhones = [];
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateSavedPhonesList();
document.body.removeChild(modal);
showToast('Todos los contactos han sido eliminados');
});
});
// Import Contacts
const importContactsBtn = document.getElementById('importContactsBtn');
const importContactsModal = document.getElementById('importContactsModal');
const closeImportContacts = document.getElementById('closeImportContacts');
const fileInput = document.getElementById('fileInput');
const selectFileBtn = document.getElementById('selectFileBtn');
const importPreview = document.getElementById('importPreview');
const fileName = document.getElementById('fileName');
const removeFile = document.getElementById('removeFile');
const importBtn = document.getElementById('importBtn');
importContactsBtn.addEventListener('click', function() {
importContactsModal.classList.remove('hidden');
});
closeImportContacts.addEventListener('click', function() {
importContactsModal.classList.add('hidden');
resetImportForm();
});
selectFileBtn.addEventListener('click', function() {
fileInput.click();
});
fileInput.addEventListener('change', function(e) {
const file = e.target.files[0];
if (file) {
if (!file.name.toLowerCase().endsWith('.txt')) {
showToast('Solo se permiten archivos TXT');
fileInput.value = '';
return;
}
fileName.textContent = file.name;
importPreview.classList.remove('hidden');
}
});
removeFile.addEventListener('click', function() {
resetImportForm();
});
function resetImportForm() {
fileInput.value = '';
fileName.textContent = '';
importPreview.classList.add('hidden');
}
importBtn.addEventListener('click', function() {
const file = fileInput.files[0];
if (!file) {
showToast('Selecciona un archivo primero');
return;
}
const reader = new FileReader();
reader.onload = function(e) {
const content = e.target.result;
const lines = content.split('\n');
let imported = 0;
let errors = 0;
lines.forEach((line, index) => {
const phoneMatch = line.trim().match(/^\+(\d{2})\s*\d[\d\s]*$/);
if (!phoneMatch) {
errors++;
return;
}
const fullNumber = line.trim().replace(/\s+/g, '');
const countryCode = phoneMatch[1];
const number = fullNumber.slice(countryCode.length + 1);
const existingPhone = savedPhones.find(p =>
p.countryCode === countryCode && p.number === number
);
if (existingPhone) {
errors++;
return;
}
const newPhone = {
id: Date.now().toString() + index,
name: `Contact ${imported + 1}`,
countryCode,
number,
tags: [],
notes: ''
};
savedPhones.push(newPhone);
imported++;
});
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateSavedPhonesList();
importContactsModal.classList.add('hidden');
resetImportForm();
showToast(`Importados ${imported} contactos (${errors} errores)`);
};
reader.readAsText(file);
});
// Catalog Management
const catalogBtn = document.getElementById('catalogBtn');
const catalogModal = document.getElementById('catalogModal');
const closeCatalog = document.getElementById('closeCatalog');
const productsTab = document.getElementById('productsTab');
const categoriesTab = document.getElementById('categoriesTab');
const productsList = document.getElementById('productsList');
let products = JSON.parse(localStorage.getItem('whatsappProducts')) || [];
let categories = JSON.parse(localStorage.getItem('whatsappCategories')) || [];
catalogBtn.addEventListener('click', function() {
catalogModal.classList.remove('hidden');
updateProductsList();
});
closeCatalog.addEventListener('click', function() {
catalogModal.classList.add('hidden');
});
productsTab.addEventListener('click', function() {
productsTab.classList.remove('bg-gray-100', 'text-gray-600');
productsTab.classList.add('bg-primary', 'text-white');
categoriesTab.classList.remove('bg-primary', 'text-white');
categoriesTab.classList.add('bg-gray-100', 'text-gray-600');
updateProductsList();
});
categoriesTab.addEventListener('click', function() {
categoriesTab.classList.remove('bg-gray-100', 'text-gray-600');
categoriesTab.classList.add('bg-primary', 'text-white');
productsTab.classList.remove('bg-primary', 'text-white');
productsTab.classList.add('bg-gray-100', 'text-gray-600');
updateCategoriesList();
});
document.getElementById('addProductBtn').addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Agregar producto</h3>
<div class="space-y-3 mb-4">
<input type="text" placeholder="Nombre del producto" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<input type="number" step="0.01" placeholder="Precio" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<textarea placeholder="Descripción" rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none"></textarea>
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar categoría</option>
${categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('')}
</select>
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mt-3" id="currencySelect">
<option value="PEN">Soles (S/)</option>
<option value="USD">Dólares ($)</option>
<option value="EUR">Euros (€)</option>
<option value="MXN">Pesos mexicanos ($)</option>
</select>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-product px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-product px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-product').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-product').addEventListener('click', () => {
const name = modal.querySelector('input[type="text"]').value.trim();
const price = parseFloat(modal.querySelector('input[type="number"]').value);
const description = modal.querySelector('textarea').value.trim();
const categoryId = modal.querySelector('select').value;
if (!name || !price || !description) {
showToast('Completa todos los campos');
return;
}
const currency = modal.querySelector('#currencySelect').value;
const newProduct = {
id: Date.now().toString(),
name,
price,
currency,
description,
categoryId,
image: `https://readdy.ai/api/search-image?query=product%20$%7Bname%7D%20isolated%20on%20white%20background%2C%20high%20quality%20product%20photography&width=300&height=300&seq=${Date.now()}&orientation=squarish`
};
products.push(newProduct);
localStorage.setItem('whatsappProducts', JSON.stringify(products));
updateProductsList();
document.body.removeChild(modal);
showToast('Producto agregado');
});
});
function updateProductsList() {
if (products.length === 0) {
productsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay productos agregados</p>';
return;
}
productsList.innerHTML = products.map(product => {
const stock = productStock[product.id]?.available || 0;
const alertThreshold = productStock[product.id]?.alert_threshold || 10;
const isLowStock = stock <= alertThreshold;
return `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start gap-2">
<div class="flex-1 min-w-0">
<div class="flex items-center gap-2 mb-1">
<h4 class="font-medium truncate">${product.name}</h4>
${isLowStock ? `<span class="shrink-0 px-2 py-0.5 bg-red-100 text-red-800 text-xs !rounded-full">Stock bajo</span>` : ''}
</div>
<div class="flex items-baseline gap-3 text-sm mb-2">
<span class="text-primary font-medium">${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}</span>
<span class="text-gray-500">Stock: <span class="${isLowStock ? 'text-red-500' : ''}">${stock}</span></span>
<span class="text-xs text-gray-400">SKU: ${product.sku || 'N/A'}</span>
</div>
<p class="text-xs text-gray-500 line-clamp-2">${product.description}</p>
<div class="flex flex-wrap gap-1 mt-2">
${(product.sizes || []).map(size => `<span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs !rounded-full">${size}</span>`).join('')}
${(product.colors || []).map(color => `<span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs !rounded-full flex items-center gap-1"><span class="w-2 h-2 !rounded-full" style="background-color: ${color.hex}"></span>${color.name}</span>`).join('')}
</div>
</div>
<div class="flex flex-col gap-2">
<button onclick="editProduct('${product.id}')" class="w-8 h-8 flex items-center justify-center text-primary hover:bg-gray-100 !rounded-button">
<i class="ri-edit-line"></i>
</button>
<button onclick="deleteProduct('${product.id}')" class="w-8 h-8 flex items-center justify-center text-red-500 hover:bg-gray-100 !rounded-button">
<i class="ri-delete-bin-line"></i>
</button>
<button onclick="shareProduct('${product.id}')" class="w-8 h-8 flex items-center justify-center text-primary hover:bg-gray-100 !rounded-button">
<i class="ri-share-line"></i>
</button>
</div>
</div>
</div>
`;
}).join('');
}
function updateCategoriesList() {
const categoriesHtml = categories.length === 0
? '<p class="text-sm text-gray-500 text-center py-3">No hay categorías agregadas</p>'
: categories.map(category => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200 flex justify-between items-center">
<span>${category.name}</span>
<div class="flex gap-2">
<button onclick="editCategory('${category.id}')" class="text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deleteCategory('${category.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
`).join('');
productsList.innerHTML = `
<button id="addCategoryBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2 mb-4">
<i class="ri-add-line"></i> Agregar categoría
</button>
<div class="space-y-3">
${categoriesHtml}
</div>
`;
document.getElementById('addCategoryBtn')?.addEventListener('click', addCategory);
}
function getCurrencySymbol(currency) {
switch(currency) {
case 'PEN': return 'S/';
case 'USD': return '$';
case 'EUR': return '€';
case 'MXN': return '$';
default: return '$';
}
}
window.editProduct = function(id) {
const product = products.find(p => p.id === id);
if (!product) return;
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Editar producto</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Información básica</label>
<input type="text" value="${product.name}" placeholder="Nombre del producto" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-2">
<input type="text" value="${product.sku || ''}" placeholder="SKU" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-2">
<textarea rows="2" placeholder="Descripción" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none">${product.description}</textarea>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Precios</label>
<div class="grid grid-cols-2 gap-2 mb-2">
<div>
<input type="number" step="0.01" value="${product.purchasePrice || ''}" placeholder="Precio de compra" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<input type="number" step="0.01" value="${product.price}" placeholder="Precio de venta" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm" id="currencySelect">
<option value="PEN" ${product.currency === 'PEN' ? 'selected' : ''}>Soles (S/)</option>
<option value="USD" ${product.currency === 'USD' ? 'selected' : ''}>Dólares ($)</option>
<option value="EUR" ${product.currency === 'EUR' ? 'selected' : ''}>Euros (€)</option>
<option value="MXN" ${product.currency === 'MXN' ? 'selected' : ''}>Pesos mexicanos ($)</option>
</select>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Inventario</label>
<div class="grid grid-cols-2 gap-2 mb-2">
<div>
<input type="number" value="${productStock[product.id]?.available || 0}" placeholder="Stock actual" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<input type="number" value="${productStock[product.id]?.alert_threshold || 10}" placeholder="Alerta stock bajo" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Variantes</label>
<div class="space-y-2 mb-2">
<div class="flex gap-2">
<select id="sizeSelect" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar talla</option>
<optgroup label="Ropa">
<option value="XS">XS</option>
<option value="S">S</option>
<option value="M">M</option>
<option value="L">L</option>
<option value="XL">XL</option>
<option value="XXL">XXL</option>
</optgroup>
<optgroup label="Calzado">
<option value="35">35 EU / 3.5 US</option>
<option value="36">36 EU / 4 US</option>
<option value="37">37 EU / 5 US</option>
<option value="38">38 EU / 6 US</option>
<option value="39">39 EU / 7 US</option>
<option value="40">40 EU / 8 US</option>
<option value="41">41 EU / 9 US</option>
<option value="42">42 EU / 10 US</option>
<option value="43">43 EU / 11 US</option>
<option value="44">44 EU / 12 US</option>
<option value="45">45 EU / 13 US</option>
</optgroup>
</select>
<button onclick="addSize()" class="px-3 py-2 bg-primary text-white !rounded-button">+</button>
</div>
<div id="selectedSizes" class="flex flex-wrap gap-2">
${(product.sizes || []).map(size => `
<span class="px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1">
${size}
<button onclick="removeSize('${size}')" class="w-4 h-4 flex items-center justify-center">×</button>
</span>
`).join('')}
</div>
</div>
<div class="space-y-2">
<div class="flex gap-2">
<input type="text" id="colorInput" placeholder="Nombre del color" class="flex-1 px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<input type="color" id="colorPicker" class="w-10 h-10 !rounded-button cursor-pointer">
<button onclick="addColor()" class="px-3 py-2 bg-primary text-white !rounded-button">+</button>
</div>
<div id="selectedColors" class="flex flex-wrap gap-2">
${(product.colors || []).map(color => `
<span class="px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1">
<span class="w-3 h-3 !rounded-full" style="background-color: ${color.hex}"></span>
${color.name}
<button onclick="removeColor('${color.name}')" class="w-4 h-4 flex items-center justify-center">×</button>
</span>
`).join('')}
</div>
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Categoría</label>
<select class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<option value="">Seleccionar categoría</option>
${categories.map(cat => `<option value="${cat.id}" ${cat.id === product.categoryId ? 'selected' : ''}>${cat.name}</option>`).join('')}
</select>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-edit px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-edit px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
// Size management
window.addSize = function() {
const sizeSelect = modal.querySelector('#sizeSelect');
const selectedSize = sizeSelect.value;
if (!selectedSize) return;
const selectedSizes = modal.querySelector('#selectedSizes');
if (Array.from(selectedSizes.children).some(span => span.textContent.trim().slice(0, -1) === selectedSize)) {
showToast('Esta talla ya está agregada');
return;
}
const sizeSpan = document.createElement('span');
sizeSpan.className = 'px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1';
sizeSpan.innerHTML = `
${selectedSize}
<button onclick="removeSize('${selectedSize}')" class="w-4 h-4 flex items-center justify-center">×</button>
`;
selectedSizes.appendChild(sizeSpan);
sizeSelect.value = '';
};
window.removeSize = function(size) {
const sizeElements = modal.querySelector('#selectedSizes').querySelectorAll('span');
sizeElements.forEach(el => {
if (el.textContent.trim().slice(0, -1) === size) {
el.remove();
}
});
};
// Color management
window.addColor = function() {
const colorInput = modal.querySelector('#colorInput');
const colorPicker = modal.querySelector('#colorPicker');
const colorName = colorInput.value.trim();
const colorHex = colorPicker.value;
if (!colorName) {
showToast('Ingresa un nombre para el color');
return;
}
const selectedColors = modal.querySelector('#selectedColors');
if (Array.from(selectedColors.children).some(span => span.textContent.includes(colorName))) {
showToast('Este color ya está agregado');
return;
}
const colorSpan = document.createElement('span');
colorSpan.className = 'px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1';
colorSpan.innerHTML = `
<span class="w-3 h-3 !rounded-full" style="background-color: ${colorHex}"></span>
${colorName}
<button onclick="removeColor('${colorName}')" class="w-4 h-4 flex items-center justify-center">×</button>
`;
selectedColors.appendChild(colorSpan);
colorInput.value = '';
};
window.removeColor = function(colorName) {
const colorElements = modal.querySelector('#selectedColors').querySelectorAll('span');
colorElements.forEach(el => {
if (el.textContent.includes(colorName)) {
el.remove();
}
});
};
modal.querySelector('.cancel-edit').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-edit').addEventListener('click', () => {
const name = modal.querySelector('input[placeholder="Nombre del producto"]').value.trim();
const sku = modal.querySelector('input[placeholder="SKU"]').value.trim();
const description = modal.querySelector('textarea').value.trim();
const purchasePrice = parseFloat(modal.querySelector('input[placeholder="Precio de compra"]').value);
const salePrice = parseFloat(modal.querySelector('input[placeholder="Precio de venta"]').value);
const currency = modal.querySelector('#currencySelect').value;
const stock = parseInt(modal.querySelector('input[placeholder="Stock actual"]').value);
const alertThreshold = parseInt(modal.querySelector('input[placeholder="Alerta stock bajo"]').value);
const categoryId = modal.querySelector('select:last-child').value;
if (!name || !sku || !description || !purchasePrice || !salePrice || stock < 0 || alertThreshold < 0) {
showToast('Completa todos los campos correctamente');
return;
}
const sizes = Array.from(modal.querySelector('#selectedSizes').children).map(span =>
span.textContent.trim().slice(0, -1)
);
const colors = Array.from(modal.querySelector('#selectedColors').children).map(span => ({
name: span.textContent.trim().slice(0, -1),
hex: span.querySelector('.w-3').style.backgroundColor
}));
const index = products.findIndex(p => p.id === id);
products[index] = {
...products[index],
name,
sku,
description,
purchasePrice,
price: salePrice,
currency,
categoryId,
sizes,
colors
};
productStock[id] = {
available: stock,
alert_threshold: alertThreshold
};
localStorage.setItem('whatsappProducts', JSON.stringify(products));
localStorage.setItem('whatsappProductStock', JSON.stringify(productStock));
updateProductsList();
document.body.removeChild(modal);
showToast('Producto actualizado');
});
};
window.deleteProduct = function(id) {
products = products.filter(p => p.id !== id);
localStorage.setItem('whatsappProducts', JSON.stringify(products));
updateProductsList();
showToast('Producto eliminado');
};
window.shareProduct = function(id) {
const product = products.find(p => p.id === id);
if (!product) return;
const message = `*${product.name}*\n\n${product.description}\n\nPrecio: ${getCurrencySymbol(product.currency)}${product.price.toFixed(2)}`;
messageText.value = message;
updatePreview();
catalogModal.classList.add('hidden');
showToast('Producto agregado al mensaje');
};
function addCategory() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nueva categoría</h3>
<input type="text" placeholder="Nombre de la categoría" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-4">
<div class="flex justify-end gap-2">
<button class="cancel-category px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-category px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-category').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-category').addEventListener('click', () => {
const name = modal.querySelector('input').value.trim();
if (!name) {
showToast('Ingresa un nombre para la categoría');
return;
}
const newCategory = {
id: Date.now().toString(),
name
};
categories.push(newCategory);
localStorage.setItem('whatsappCategories', JSON.stringify(categories));
updateCategoriesList();
document.body.removeChild(modal);
showToast('Categoría agregada');
});
}
window.editCategory = function(id) {
const category = categories.find(c => c.id === id);
if (!category) return;
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Editar categoría</h3>
<input type="text" value="${category.name}" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-4">
<div class="flex justify-end gap-2">
<button class="cancel-edit px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-edit px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-edit').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-edit').addEventListener('click', () => {
const name = modal.querySelector('input').value.trim();
if (!name) {
showToast('Ingresa un nombre para la categoría');
return;
}
const index = categories.findIndex(c => c.id === id);
categories[index] = { ...categories[index], name };
localStorage.setItem('whatsappCategories', JSON.stringify(categories));
updateCategoriesList();
document.body.removeChild(modal);
showToast('Categoría actualizada');
});
};
window.deleteCategory = function(id) {
categories = categories.filter(c => c.id !== id);
localStorage.setItem('whatsappCategories', JSON.stringify(categories));
updateCategoriesList();
showToast('Categoría eliminada');
};
// Orders Management
const ordersBtn = document.getElementById('ordersBtn');
const ordersModal = document.getElementById('ordersModal');
const closeOrders = document.getElementById('closeOrders');
const pendingOrdersTab = document.getElementById('pendingOrdersTab');
const completedOrdersTab = document.getElementById('completedOrdersTab');
const ordersList = document.getElementById('ordersList');
let orders = JSON.parse(localStorage.getItem('whatsappOrders')) || [];
ordersBtn.addEventListener('click', function() {
ordersModal.classList.remove('hidden');
updateOrdersList();
});
closeOrders.addEventListener('click', function() {
ordersModal.classList.add('hidden');
});
pendingOrdersTab.addEventListener('click', function() {
pendingOrdersTab.classList.remove('bg-gray-100', 'text-gray-600');
pendingOrdersTab.classList.add('bg-primary', 'text-white');
completedOrdersTab.classList.remove('bg-primary', 'text-white');
completedOrdersTab.classList.add('bg-gray-100', 'text-gray-600');
updateOrdersList('pending');
});
completedOrdersTab.addEventListener('click', function() {
completedOrdersTab.classList.remove('bg-gray-100', 'text-gray-600');
completedOrdersTab.classList.add('bg-primary', 'text-white');
activeOrdersTab.classList.remove('bg-primary', 'text-white');
activeOrdersTab.classList.add('bg-gray-100', 'text-gray-600');
const completedOrders = restaurantOrders.filter(order => order.status === 'completed');
const activeOrdersList = document.getElementById('activeOrdersList');
if (completedOrders.length === 0) {
activeOrdersList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay comandas completadas</p>';
return;
}
activeOrdersList.innerHTML = completedOrders.map(order => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="font-medium">Mesa ${order.tableId}</p>
<p class="text-xs text-gray-500">Creado: ${new Date(order.createdAt).toLocaleString()}</p>
<p class="text-xs text-gray-500">Completado: ${new Date(order.completedAt).toLocaleString()}</p>
<p class="text-xs text-primary">Tiempo de servicio: ${formatElapsedTime(order.serviceTime)}</p>
</div>
</div>
<div class="space-y-2">
${order.items.map(item => `
<div class="flex justify-between items-center text-sm">
<span>${item.quantity}x ${item.name}</span>
<span>${getCurrencySymbol(item.currency)}${(item.price * item.quantity).toFixed(2)}</span>
</div>
`).join('')}
<div class="border-t border-gray-200 pt-2 flex justify-between items-center font-medium">
<span>Total</span>
<span>${getCurrencySymbol(order.items[0].currency)}${order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</span>
</div>
</div>
${order.notes ? `<p class="text-xs text-gray-500 mt-2 italic">${order.notes}</p>` : ''}
</div>
`).join('');
});
function updateOrdersList(status = 'pending') {
const filteredOrders = restaurantOrders.filter(order => order.status === status);
if (filteredOrders.length === 0) {
ordersList.innerHTML = `<p class="text-sm text-gray-500 text-center py-3">No hay pedidos ${status === 'pending' ? 'pendientes' : 'completados'}</p>`;
return;
}
// Sort completed orders by completion date
if (status === 'completed') {
filteredOrders.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
}
ordersList.innerHTML = filteredOrders.map(order => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="text-sm font-medium">Mesa ${tables.find(t => t.id === order.tableId)?.name}</p>
<p class="text-xs text-gray-500">Creado: ${new Date(order.createdAt).toLocaleString()}</p>
${order.completedAt ? `<p class="text-xs text-gray-500">Completado: ${new Date(order.completedAt).toLocaleString()}</p>` : ''}
${order.serviceTime ? `<p class="text-xs text-primary">Tiempo de servicio: ${formatElapsedTime(order.serviceTime)}</p>` : ''}
</div>
<div class="flex gap-2">
<button onclick="deleteOrder('${order.id}')" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<div class="space-y-2">
${order.items.map(item => `
<div class="flex justify-between items-center text-sm">
<div class="flex items-center gap-2">
<span>${item.quantity}x ${item.name}</span>
${order.itemsStatus?.find(s => s.productId === item.id)?.delivered ?
'<i class="ri-checkbox-circle-fill text-green-500"></i>' : ''}
</div>
<span>${getCurrencySymbol(item.currency)}${(item.price * item.quantity).toFixed(2)}</span>
</div>
`).join('')}
<div class="border-t border-gray-200 pt-2 space-y-1">
<div class="flex justify-between items-center">
<span class="text-sm text-gray-600">Subtotal</span>
<span class="text-sm">${getCurrencySymbol(order.items[0].currency)}${order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</span>
</div>
<div class="flex justify-between items-center">
<span class="text-sm text-gray-600">IGV (18%)</span>
<span class="text-sm">${getCurrencySymbol(order.items[0].currency)}${(order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 0.18).toFixed(2)}</span>
</div>
<div class="flex justify-between items-center font-medium pt-1 border-t border-gray-200">
<span>Total a pagar</span>
<span>${getCurrencySymbol(order.items[0].currency)}${(order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 1.18).toFixed(2)}</span>
</div>
</div>
</div>
${order.notes ? `<p class="text-xs text-gray-500 mt-2 italic">${order.notes}</p>` : ''}
</div>
`).join('');
}
window.completeOrder = function(id) {
const orderIndex = orders.findIndex(o => o.id === id);
if (orderIndex === -1) return;
orders[orderIndex].status = 'completed';
localStorage.setItem('whatsappOrders', JSON.stringify(orders));
updateOrdersList('pending');
showToast('Pedido completado');
};
window.deleteOrder = function(id) {
orders = orders.filter(o => o.id !== id);
localStorage.setItem('whatsappOrders', JSON.stringify(orders));
updateOrdersList(pendingOrdersTab.classList.contains('bg-primary') ? 'pending' : 'completed');
showToast('Pedido eliminado');
};
// Dark Mode Toggle
const settingsBtn = document.getElementById('settingsBtn');
const settingsIcon = settingsBtn.querySelector('i');
const currentMode = localStorage.getItem('colorMode') || 'light';
function applyColorMode(mode) {
document.body.classList.remove('dark-mode', 'orange-mode', 'blue-mode', 'violet-mode', 'navy-mode');
settingsIcon.className = 'ri-sun-line';
switch(mode) {
case 'dark':
document.body.classList.add('dark-mode');
settingsIcon.className = 'ri-moon-line';
break;
case 'orange':
document.body.classList.add('orange-mode');
settingsIcon.className = 'ri-fire-line';
break;
case 'blue':
document.body.classList.add('blue-mode');
settingsIcon.className = 'ri-water-flash-line';
break;
case 'violet':
document.body.classList.add('violet-mode');
settingsIcon.className = 'ri-palette-line';
break;
case 'navy':
document.body.classList.add('navy-mode');
settingsIcon.className = 'ri-contrast-2-line';
break;
default:
settingsIcon.className = 'ri-sun-line';
}
}
applyColorMode(currentMode);
settingsBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Seleccionar tema</h3>
<div class="grid grid-cols-2 gap-3 mb-4">
<button class="mode-btn p-3 bg-gray-50 !rounded-button flex items-center gap-2 ${currentMode === 'light' ? 'border-2 border-primary' : ''}">
<i class="ri-sun-line text-yellow-500"></i>
<span>Claro</span>
</button>
<button class="mode-btn p-3 bg-gray-800 text-white !rounded-button flex items-center gap-2 ${currentMode === 'dark' ? 'border-2 border-primary' : ''}">
<i class="ri-moon-line"></i>
<span>Oscuro</span>
</button>
<button class="mode-btn p-3 bg-orange-50 !rounded-button flex items-center gap-2 ${currentMode === 'orange' ? 'border-2 border-primary' : ''}">
<i class="ri-fire-line text-orange-500"></i>
<span class="text-orange-900">Naranja</span>
</button>
<button class="mode-btn p-3 bg-blue-50 !rounded-button flex items-center gap-2 ${currentMode === 'blue' ? 'border-2 border-primary' : ''}">
<i class="ri-water-flash-line text-blue-500"></i>
<span class="text-blue-900">Celeste</span>
</button>
<button class="mode-btn p-3 bg-violet-50 !rounded-button flex items-center gap-2 ${currentMode === 'violet' ? 'border-2 border-primary' : ''}">
<i class="ri-palette-line text-violet-500"></i>
<span class="text-violet-900">Violeta</span>
</button>
<button class="mode-btn p-3 bg-gradient-to-br from-blue-900 to-blue-700 text-white !rounded-button flex items-center gap-2 ${currentMode === 'navy' ? 'border-2 border-primary' : ''}">
<i class="ri-contrast-2-line"></i>
<span>Navy</span>
</button>
</div>
<button class="close-modal w-full py-2 bg-gray-100 text-gray-600 !rounded-button">Cerrar</button>
</div>
`;
document.body.appendChild(modal);
modal.querySelectorAll('.mode-btn').forEach(btn => {
btn.addEventListener('click', function() {
let mode = 'light';
if (this.querySelector('.ri-moon-line')) mode = 'dark';
else if (this.querySelector('.ri-fire-line')) mode = 'orange';
else if (this.querySelector('.ri-water-flash-line')) mode = 'blue';
else if (this.querySelector('.ri-palette-line')) mode = 'violet';
else if (this.querySelector('.ri-contrast-2-line')) mode = 'navy';
localStorage.setItem('colorMode', mode);
applyColorMode(mode);
showToast(`Modo ${mode === 'light' ? 'claro' : mode === 'dark' ? 'oscuro' : mode === 'orange' ? 'naranja' : mode === 'blue' ? 'celeste' : mode === 'violet' ? 'violeta' : 'navy'} activado`);
document.body.removeChild(modal);
});
});
modal.querySelector('.close-modal').addEventListener('click', () => {
document.body.removeChild(modal);
});
});
// Rich Text Formatting
const formatButtons = document.querySelectorAll('.format-btn');
formatButtons.forEach(btn => {
btn.addEventListener('click', function() {
const format = this.dataset.format;
const textarea = document.getElementById('messageText');
const start = textarea.selectionStart;
const end = textarea.selectionEnd;
const selectedText = textarea.value.substring(start, end);
let formattedText = '';
switch(format) {
case 'bold':
formattedText = `*${selectedText}*`;
break;
case 'italic':
formattedText = `_${selectedText}_`;
break;
case 'strike':
formattedText = `~${selectedText}~`;
break;
case 'monospace':
formattedText = `\`\`\`${selectedText}\`\`\``;
break;
case 'bullet':
formattedText = `• ${selectedText}`;
break;
case 'number':
formattedText = `1. ${selectedText}`;
break;
case 'quote':
formattedText = `> ${selectedText}`;
break;
case 'link':
const url = prompt('Ingresa la URL:');
if (url) {
formattedText = `[${selectedText}](${url})`;
} else {
return;
}
break;
}
textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
textarea.focus();
updatePreview();
});
});
// Finance Management
const financeBtn = document.getElementById('financeBtn');
const financeModal = document.getElementById('financeModal');
const closeFinance = document.getElementById('closeFinance');
const incomeTab = document.getElementById('incomeTab');
const expenseTab = document.getElementById('expenseTab');
const addTransactionBtn = document.getElementById('addTransactionBtn');
const addTransactionModal = document.getElementById('addTransactionModal');
const cancelTransaction = document.getElementById('cancelTransaction');
const saveTransaction = document.getElementById('saveTransaction');
const incomeTypeBtn = document.getElementById('incomeTypeBtn');
const expenseTypeBtn = document.getElementById('expenseTypeBtn');
let transactions = JSON.parse(localStorage.getItem('whatsappTransactions')) || [];
let currentTransactionType = 'income';
financeBtn.addEventListener('click', function() {
financeModal.classList.remove('hidden');
updateTransactionsList();
updateFinanceSummary();
});
closeFinance.addEventListener('click', function() {
financeModal.classList.add('hidden');
});
incomeTab.addEventListener('click', function() {
incomeTab.classList.remove('bg-gray-100', 'text-gray-600');
incomeTab.classList.add('bg-primary', 'text-white');
expenseTab.classList.remove('bg-primary', 'text-white');
expenseTab.classList.add('bg-gray-100', 'text-gray-600');
updateTransactionsList('income');
});
expenseTab.addEventListener('click', function() {
expenseTab.classList.remove('bg-gray-100', 'text-gray-600');
expenseTab.classList.add('bg-primary', 'text-white');
incomeTab.classList.remove('bg-primary', 'text-white');
incomeTab.classList.add('bg-gray-100', 'text-gray-600');
updateTransactionsList('expense');
});
addTransactionBtn.addEventListener('click', function() {
addTransactionModal.classList.remove('hidden');
document.getElementById('transactionDate').value = new Date().toISOString().slice(0, 16);
updateTransactionCategoryOptions();
});
cancelTransaction.addEventListener('click', function() {
addTransactionModal.classList.add('hidden');
resetTransactionForm();
});
incomeTypeBtn.addEventListener('click', function() {
currentTransactionType = 'income';
incomeTypeBtn.classList.remove('bg-gray-100', 'text-gray-600');
incomeTypeBtn.classList.add('bg-primary', 'text-white');
expenseTypeBtn.classList.remove('bg-primary', 'text-white');
expenseTypeBtn.classList.add('bg-gray-100', 'text-gray-600');
updateTransactionCategoryOptions();
});
expenseTypeBtn.addEventListener('click', function() {
currentTransactionType = 'expense';
expenseTypeBtn.classList.remove('bg-gray-100', 'text-gray-600');
expenseTypeBtn.classList.add('bg-primary', 'text-white');
incomeTypeBtn.classList.remove('bg-primary', 'text-white');
incomeTypeBtn.classList.add('bg-gray-100', 'text-gray-600');
updateTransactionCategoryOptions();
});
saveTransaction.addEventListener('click', function() {
const description = document.getElementById('transactionDescription').value.trim();
const amount = parseFloat(document.getElementById('transactionAmount').value);
const currency = document.getElementById('transactionCurrency').value;
const category = document.getElementById('transactionCategory').value;
const date = document.getElementById('transactionDate').value;
const notes = document.getElementById('transactionNotes').value.trim();
if (!description || !amount || !category || !date) {
showToast('Completa todos los campos requeridos');
return;
}
const newTransaction = {
id: Date.now(),
type: currentTransactionType,
description,
amount,
currency,
category,
date,
notes,
createdAt: new Date().toISOString()
};
transactions.push(newTransaction);
localStorage.setItem('whatsappTransactions', JSON.stringify(transactions));
updateTransactionsList(currentTransactionType);
updateFinanceSummary();
addTransactionModal.classList.add('hidden');
resetTransactionForm();
showToast('Transacción registrada');
});
function updateTransactionsList(type = 'income') {
const transactionsList = document.getElementById('transactionsList');
const filteredTransactions = type ? transactions.filter(t => t.type === type) : transactions;
if (filteredTransactions.length === 0) {
transactionsList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay transacciones registradas</p>';
return;
}
filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
transactionsList.innerHTML = filteredTransactions.map(transaction => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="font-medium">${transaction.description}</p>
<p class="text-xs text-gray-500">${new Date(transaction.date).toLocaleString()}</p>
<p class="text-xs ${transaction.type === 'income' ? 'text-green-500' : 'text-red-500'}">${getCategoryLabel(transaction.category)}</p>
</div>
<div class="flex items-center gap-3">
<p class="text-${transaction.type === 'income' ? 'green' : 'red'}-500 font-medium">${getCurrencySymbol(transaction.currency)}${transaction.amount.toFixed(2)}</p>
<button onclick="deleteTransaction(${transaction.id})" class="text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
${transaction.notes ? `<p class="text-xs text-gray-500 italic">${transaction.notes}</p>` : ''}
</div>
`).join('');
}
function updateFinanceSummary() {
const incomeTotal = transactions
.filter(t => t.type === 'income')
.reduce((sum, t) => sum + t.amount, 0);
const expenseTotal = transactions
.filter(t => t.type === 'expense')
.reduce((sum, t) => sum + t.amount, 0);
const balance = incomeTotal - expenseTotal;
document.getElementById('totalIncome').textContent = `S/ ${incomeTotal.toFixed(2)}`;
document.getElementById('totalExpense').textContent = `S/ ${expenseTotal.toFixed(2)}`;
document.getElementById('totalBalance').textContent = `S/ ${balance.toFixed(2)}`;
document.getElementById('totalTransactions').textContent = transactions.length;
}
function updateTransactionCategoryOptions() {
const categorySelect = document.getElementById('transactionCategory');
const type = currentTransactionType;
categorySelect.innerHTML = `
<option value="">Seleccionar categoría</option>
${type === 'income' ? `
<option value="sales">Ventas</option>
<option value="services">Servicios</option>
<option value="commissions">Comisiones</option>
<option value="others_income">Otros ingresos</option>
` : `
<option value="supplies">Insumos</option>
<option value="services_expense">Servicios</option>
<option value="salaries">Sueldos</option>
<option value="rent">Alquiler</option>
<option value="others_expense">Otros gastos</option>
`}
`;
}
function getCategoryLabel(category) {
const labels = {
sales: 'Ventas',
services: 'Servicios',
commissions: 'Comisiones',
others_income: 'Otros ingresos',
supplies: 'Insumos',
services_expense: 'Servicios',
salaries: 'Sueldos',
rent: 'Alquiler',
others_expense: 'Otros egresos'
};
return labels[category] || category;
}
function resetTransactionForm() {
document.getElementById('transactionDescription').value = '';
document.getElementById('transactionAmount').value = '';
document.getElementById('transactionCurrency').value = 'PEN';
document.getElementById('transactionCategory').value = '';
document.getElementById('transactionDate').value = new Date().toISOString().slice(0, 16);
document.getElementById('transactionNotes').value = '';
currentTransactionType = 'income';
incomeTypeBtn.click();
}
window.deleteTransaction = function(id) {
transactions = transactions.filter(t => t.id !== id);
localStorage.setItem('whatsappTransactions', JSON.stringify(transactions));
updateTransactionsList(currentTransactionType);
updateFinanceSummary();
showToast('Transacción eliminada');
};
// Analytics
const analyticsBtn = document.getElementById('analyticsBtn');
const analyticsModal = document.getElementById('analyticsModal');
const closeAnalytics = document.getElementById('closeAnalytics');
analyticsBtn.addEventListener('click', function() {
analyticsModal.classList.remove('hidden');
updateAnalytics();
});
closeAnalytics.addEventListener('click', function() {
analyticsModal.classList.add('hidden');
});
function updateAnalytics() {
// Update counters
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
document.getElementById('totalSentMessages').textContent = sentMessages.length + scheduledSentMessages.length;
document.getElementById('totalScheduledMessages').textContent = scheduledMessages.length;
document.getElementById('totalContacts').textContent = savedPhones.length;
document.getElementById('totalTemplates').textContent = templates.length;
// Update top contacts
const contactFrequency = {};
sentMessages.forEach(msg => {
contactFrequency[msg.phone] = (contactFrequency[msg.phone] || 0) + 1;
});
const topContacts = Object.entries(contactFrequency)
.sort(([,a], [,b]) => b - a)
.slice(0, 5);
document.getElementById('topContacts').innerHTML = topContacts.map(([phone, count]) => {
const contact = savedPhones.find(p => (p.countryCode + p.number) === phone.replace('+', ''));
return `
<div class="flex items-center justify-between bg-white p-2 !rounded-button">
<div class="flex items-center gap-2">
<div class="w-8 h-8 bg-primary/10 !rounded-full flex items-center justify-center">
<i class="ri-user-line text-primary"></i>
</div>
<div>
<p class="text-sm font-medium">${contact ? contact.name : phone}</p>
<p class="text-xs text-gray-500">${phone}</p>
</div>
</div>
<span class="text-sm font-medium text-primary">${count}</span>
</div>
`;
}).join('') || '<p class="text-sm text-gray-500 text-center">No hay datos suficientes</p>';
// Initialize activity chart
const chartContainer = document.getElementById('activityChart');
const chart = echarts.init(chartContainer);
const dates = Array.from({length: 7}, (_, i) => {
const date = new Date();
date.setDate(date.getDate() - i);
return date.toISOString().split('T')[0];
}).reverse();
const messagesByDate = dates.map(date => {
return sentMessages.filter(msg =>
new Date(msg.date).toISOString().split('T')[0] === date
).length;
});
const option = {
grid: {
top: 20,
right: 20,
bottom: 20,
left: 40,
},
xAxis: {
type: 'category',
data: dates.map(date => date.split('-').reverse().slice(0, 2).join('/')),
axisLine: {
lineStyle: {
color: '#E5E7EB'
}
},
axisTick: {
show: false
},
axisLabel: {
color: '#6B7280',
fontSize: 10
}
},
yAxis: {
type: 'value',
axisLine: {
show: false
},
axisTick: {
show: false
},
splitLine: {
lineStyle: {
color: '#E5E7EB'
}
},
axisLabel: {
color: '#6B7280',
fontSize: 10
}
},
series: [{
data: messagesByDate,
type: 'line',
smooth: true,
symbol: 'circle',
symbolSize: 8,
itemStyle: {
color: '#25D366'
},
lineStyle: {
color: '#25D366'
},
areaStyle: {
color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
offset: 0,
color: 'rgba(37, 211, 102, 0.3)'
}, {
offset: 1,
color: 'rgba(37, 211, 102, 0)'
}])
}
}]
};
chart.setOption(option);
// Handle window resize
window.addEventListener('resize', () => {
chart.resize();
});
}
// Contact Groups
const addGroupBtn = document.getElementById('addGroupBtn');
const groupModal = document.getElementById('groupModal');
const closeGroup = document.getElementById('closeGroup');
const createGroupBtn = document.getElementById('createGroupBtn');
const groupsList = document.getElementById('groupsList');
let contactGroups = JSON.parse(localStorage.getItem('whatsappContactGroups')) || [];
addGroupBtn.addEventListener('click', function() {
groupModal.classList.remove('hidden');
updateGroupsList();
});
closeGroup.addEventListener('click', function() {
groupModal.classList.add('hidden');
});
createGroupBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Crear nuevo grupo</h3>
<input type="text" placeholder="Nombre del grupo" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3">
<div class="max-h-48 overflow-y-auto mb-3">
<p class="text-sm text-gray-600 mb-2">Selecciona los contactos:</p>
${savedPhones.map(phone => `
<label class="flex items-center p-2 hover:bg-gray-50 !rounded-button">
<input type="checkbox" value="${phone.id}" class="mr-2">
<div>
<p class="text-sm font-medium">${phone.name}</p>
<p class="text-xs text-gray-500">+${phone.countryCode}${phone.number}</p>
</div>
</label>
`).join('')}
</div>
<div class="flex justify-end gap-2">
<button class="cancel-group px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-group px-4 py-2 bg-primary text-white !rounded-button">Crear grupo</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-group').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-group').addEventListener('click', () => {
const groupName = modal.querySelector('input[type="text"]').value.trim();
const selectedContacts = Array.from(modal.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
if (!groupName) {
showToast('Ingresa un nombre para el grupo');
return;
}
if (selectedContacts.length === 0) {
showToast('Selecciona al menos un contacto');
return;
}
const newGroup = {
id: Date.now().toString(),
name: groupName,
contacts: selectedContacts
};
contactGroups.push(newGroup);
localStorage.setItem('whatsappContactGroups', JSON.stringify(contactGroups));
updateGroupsList();
document.body.removeChild(modal);
showToast('Grupo creado');
});
});
function updateGroupsList() {
if (contactGroups.length === 0) {
groupsList.innerHTML = '<p class="text-sm text-gray-500 text-center">No hay grupos creados</p>';
return;
}
groupsList.innerHTML = contactGroups.map(group => `
<div class="bg-white p-2 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-center mb-1">
<p class="text-sm font-medium">${group.name}</p>
<div class="flex gap-1">
<button onclick="sendToGroup('${group.id}')" class="text-primary p-1">
<i class="ri-send-plane-line"></i>
</button>
<button onclick="deleteGroup('${group.id}')" class="text-red-500 p-1">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<p class="text-xs text-gray-500">${group.contacts.length} contactos</p>
</div>
`).join('');
}
window.sendToGroup = function(groupId) {
const group = contactGroups.find(g => g.id === groupId);
if (!group) return;
if (!messageText.value.trim()) {
showToast('Escribe un mensaje primero');
return;
}
const message = messageText.value.trim();
group.contacts.forEach(contactId => {
const contact = savedPhones.find(p => p.id === contactId);
if (contact) {
const phone = contact.countryCode + contact.number;
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
// Save to sent messages history
const sentMessage = {
id: Date.now(),
phone: phone,
message: message,
date: new Date().toISOString()
};
sentMessages.unshift(sentMessage);
if (sentMessages.length > 50) sentMessages.pop();
localStorage.setItem('whatsappSentMessages', JSON.stringify(sentMessages));
}
});
groupModal.classList.add('hidden');
showToast('Mensaje enviado al grupo');
};
window.deleteGroup = function(groupId) {
contactGroups = contactGroups.filter(g => g.id !== groupId);
localStorage.setItem('whatsappContactGroups', JSON.stringify(contactGroups));
updateGroupsList();
showToast('Grupo eliminado');
};
// Templates
const addTemplateBtn = document.getElementById('addTemplateBtn');
const templateModal = document.getElementById('templateModal');
const closeTemplate = document.getElementById('closeTemplate');
const templateBtns = document.querySelectorAll('.template-btn');
const addNewTemplateBtn = document.getElementById('addNewTemplateBtn');
const editTemplatesBtn = document.getElementById('editTemplatesBtn');
let templates = JSON.parse(localStorage.getItem('whatsappTemplates')) || [];
addTemplateBtn.addEventListener('click', function() {
templateModal.classList.remove('hidden');
});
closeTemplate.addEventListener('click', function() {
templateModal.classList.add('hidden');
});
templateBtns.forEach(btn => {
btn.addEventListener('click', function() {
const templateText = this.textContent;
messageText.value = messageText.value + (messageText.value ? '\n' : '') + templateText;
updatePreview();
templateModal.classList.add('hidden');
showToast('Plantilla insertada');
});
});
addNewTemplateBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nueva plantilla</h3>
<textarea class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3 resize-none" rows="4" placeholder="Escribe tu plantilla...&#10;Usa {nombre}, {fecha}, {hora}, {empresa} como variables"></textarea>
<div class="flex justify-end gap-2">
<button class="cancel-template px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-template px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-template').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-template').addEventListener('click', () => {
const templateText = modal.querySelector('textarea').value.trim();
if (templateText) {
const newTemplate = {
id: Date.now(),
text: templateText
};
templates.push(newTemplate);
localStorage.setItem('whatsappTemplates', JSON.stringify(templates));
updateTemplatesList();
document.body.removeChild(modal);
showToast('Plantilla guardada');
} else {
showToast('Escribe una plantilla');
}
});
});
editTemplatesBtn.addEventListener('click', function() {
const buttons = document.querySelectorAll('.template-btn');
buttons.forEach(btn => {
if (!btn.querySelector('.delete-template')) {
const deleteBtn = document.createElement('button');
deleteBtn.className = 'delete-template absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500';
deleteBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
deleteBtn.addEventListener('click', function(e) {
e.stopPropagation();
btn.remove();
showToast('Plantilla eliminada');
});
btn.style.position = 'relative';
btn.appendChild(deleteBtn);
}
});
this.innerHTML = '<i class="ri-check-line"></i> Listo';
this.addEventListener('click', function() {
const deleteButtons = document.querySelectorAll('.delete-template');
deleteButtons.forEach(btn => btn.remove());
this.innerHTML = '<i class="ri-edit-line"></i> Editar';
}, { once: true });
});
function updateTemplatesList() {
const templateContainer = document.querySelector('.space-y-2');
if (templates.length === 0) {
templateContainer.innerHTML = '<p class="text-sm text-gray-500 text-center">No hay plantillas guardadas</p>';
return;
}
templateContainer.innerHTML = templates.map(template => `
<button class="template-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm">
${template.text}
</button>
`).join('');
const templateBtns = templateContainer.querySelectorAll('.template-btn');
templateBtns.forEach(btn => {
btn.addEventListener('click', function() {
messageText.value = messageText.value + (messageText.value ? '\n' : '') + this.textContent.trim();
updatePreview();
templateModal.classList.add('hidden');
showToast('Plantilla insertada');
});
});
}
// Quick Replies
const quickRepliesBtn = document.getElementById('quickRepliesBtn');
const quickRepliesModal = document.getElementById('quickRepliesModal');
const closeQuickReplies = document.getElementById('closeQuickReplies');
const quickReplyBtns = document.querySelectorAll('.quick-reply-btn');
const addQuickReplyBtn = document.getElementById('addQuickReplyBtn');
const editQuickRepliesBtn = document.getElementById('editQuickRepliesBtn');
quickRepliesBtn.addEventListener('click', function() {
quickRepliesModal.classList.remove('hidden');
});
closeQuickReplies.addEventListener('click', function() {
quickRepliesModal.classList.add('hidden');
});
quickReplyBtns.forEach(btn => {
btn.addEventListener('click', function() {
const replyText = this.textContent;
messageText.value = messageText.value + (messageText.value ? '\n' : '') + replyText;
updatePreview();
quickRepliesModal.classList.add('hidden');
showToast('Respuesta rápida insertada');
});
});
addQuickReplyBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Nueva respuesta rápida</h3>
<textarea class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3 resize-none" rows="4" placeholder="Escribe tu respuesta rápida..."></textarea>
<div class="flex justify-end gap-2">
<button class="cancel-quick-reply px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-quick-reply px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.cancel-quick-reply').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-quick-reply').addEventListener('click', () => {
const replyText = modal.querySelector('textarea').value.trim();
if (replyText) {
const newBtn = document.createElement('button');
newBtn.className = 'quick-reply-btn w-full px-3 py-2 text-left bg-gray-50 hover:bg-gray-100 !rounded-button text-sm';
newBtn.textContent = replyText;
newBtn.addEventListener('click', function() {
messageText.value = messageText.value + (messageText.value ? '\n' : '') + replyText;
updatePreview();
quickRepliesModal.classList.add('hidden');
showToast('Respuesta rápida insertada');
});
document.querySelector('.space-y-2').appendChild(newBtn);
document.body.removeChild(modal);
showToast('Respuesta rápida guardada');
} else {
showToast('Escribe una respuesta');
}
});
});
editQuickRepliesBtn.addEventListener('click', function() {
const buttons = document.querySelectorAll('.quick-reply-btn');
buttons.forEach(btn => {
if (!btn.querySelector('.delete-quick-reply')) {
const deleteBtn = document.createElement('button');
deleteBtn.className = 'delete-quick-reply absolute right-2 top-1/2 transform -translate-y-1/2 text-red-500';
deleteBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
deleteBtn.addEventListener('click', function(e) {
e.stopPropagation();
btn.remove();
showToast('Respuesta rápida eliminada');
});
btn.style.position = 'relative';
btn.appendChild(deleteBtn);
}
});
this.innerHTML = '<i class="ri-check-line"></i> Listo';
this.addEventListener('click', function() {
const deleteButtons = document.querySelectorAll('.delete-quick-reply');
deleteButtons.forEach(btn => btn.remove());
this.innerHTML = '<i class="ri-edit-line"></i> Editar';
}, { once: true });
});
// Elementos DOM
const countryCodeBtn = document.getElementById('countryCodeBtn');
const clearMessageBtn = document.getElementById('clearMessageBtn');
const historyBtn = document.getElementById('historyBtn');
const historyModal = document.getElementById('historyModal');
const closeHistory = document.getElementById('closeHistory');
const historyList = document.getElementById('historyList');
// Initialize sent messages history
let sentMessages = JSON.parse(localStorage.getItem('whatsappSentMessages')) || [];
// Clear message button
clearMessageBtn.addEventListener('click', function() {
messageText.value = '';
updatePreview();
showToast('Mensaje limpiado');
});
// History button
historyBtn.addEventListener('click', function() {
updateHistoryList();
historyModal.classList.remove('hidden');
});
closeHistory.addEventListener('click', function() {
historyModal.classList.add('hidden');
});
function updateHistoryList() {
const sentHistoryTab = document.getElementById('sentHistoryTab');
const scheduledHistoryTab = document.getElementById('scheduledHistoryTab');
const historyList = document.getElementById('historyList');
const scheduledHistoryList = document.getElementById('scheduledHistoryList');
let scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
sentHistoryTab.addEventListener('click', () => {
sentHistoryTab.classList.remove('bg-gray-100', 'text-gray-600');
sentHistoryTab.classList.add('bg-primary', 'text-white');
scheduledHistoryTab.classList.remove('bg-primary', 'text-white');
scheduledHistoryTab.classList.add('bg-gray-100', 'text-gray-600');
historyList.classList.remove('hidden');
scheduledHistoryList.classList.add('hidden');
});
scheduledHistoryTab.addEventListener('click', () => {
scheduledHistoryTab.classList.remove('bg-gray-100', 'text-gray-600');
scheduledHistoryTab.classList.add('bg-primary', 'text-white');
sentHistoryTab.classList.remove('bg-primary', 'text-white');
sentHistoryTab.classList.add('bg-gray-100', 'text-gray-600');
scheduledHistoryList.classList.remove('hidden');
historyList.classList.add('hidden');
});
const allSentMessages = [...sentMessages, ...scheduledSentMessages];
allSentMessages.sort((a, b) => new Date(b.date) - new Date(a.date));
if (allSentMessages.length === 0) {
historyList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay mensajes enviados</p>';
} else {
historyList.innerHTML = allSentMessages.map(msg => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="text-sm font-medium">+${msg.phone}</p>
<p class="text-xs text-gray-500">${new Date(msg.date).toLocaleString()}</p>
${msg.wasScheduled ? '<p class="text-xs text-primary">Enviado por programación</p>' : ''}
</div>
<div class="flex gap-2">
<button onclick="deleteHistoryMessage(${msg.id})" class="text-red-500 p-1">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<p class="text-sm text-gray-600 break-words">${msg.message}</p>
</div>
`).join('');
}
if (scheduledMessages.length === 0) {
scheduledHistoryList.innerHTML = '<p class="text-sm text-gray-500 text-center py-3">No hay mensajes programados</p>';
} else {
scheduledHistoryList.innerHTML = scheduledMessages.map(msg => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="text-sm font-medium">+${msg.phone}</p>
<p class="text-xs text-gray-500">${new Date(msg.scheduledTime).toLocaleString()}</p>
</div>
<div class="flex gap-2">
<button onclick="window.sendScheduledMessageNow(${msg.id})" class="text-primary p-1">
<i class="ri-send-plane-line"></i>
</button>
<button onclick="window.removeScheduledMessageFromHistory(${msg.id})" class="text-red-500 p-1">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<p class="text-sm text-gray-600 break-words">${msg.message}</p>
</div>
`).join('');
}
}
window.resendMessage = function(phone, message, wasScheduled) {
if (wasScheduled) {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Reenviar mensaje programado</h3>
<input type="datetime-local" class="schedule-datetime w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3">
<div class="flex justify-end gap-2">
<button class="cancel-schedule px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="confirm-schedule px-4 py-2 bg-primary text-white !rounded-button">Programar</button>
</div>
</div>
`;
document.body.appendChild(modal);
const datetimeInput = modal.querySelector('.schedule-datetime');
modal.querySelector('.cancel-schedule').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.confirm-schedule').addEventListener('click', () => {
const selectedTime = new Date(datetimeInput.value).getTime();
const now = new Date().getTime();
if (selectedTime <= now) {
showToast('Selecciona una fecha y hora futura');
return;
}
const scheduledMessage = {
id: Date.now(),
phone,
message,
scheduledTime: selectedTime,
timer: setTimeout(() => {
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
const scheduledSentMessage = {
id: Date.now(),
phone,
message,
date: new Date().toISOString(),
wasScheduled: true
};
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
scheduledSentMessages.unshift(scheduledSentMessage);
if (scheduledSentMessages.length > 50) scheduledSentMessages.pop();
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
removeScheduledMessage(scheduledMessage.id);
}, selectedTime - now)
};
scheduledMessages.push(scheduledMessage);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
document.body.removeChild(modal);
showToast('Mensaje programado nuevamente');
});
} else {
const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
}
};
window.deleteHistoryMessage = function(id) {
let wasScheduled = false;
let scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
// Check if message is in scheduled sent messages
if (scheduledSentMessages.some(msg => msg.id === id)) {
scheduledSentMessages = scheduledSentMessages.filter(msg => msg.id !== id);
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
wasScheduled = true;
}
// If not scheduled, check regular sent messages
if (!wasScheduled) {
sentMessages = sentMessages.filter(msg => msg.id !== id);
localStorage.setItem('whatsappSentMessages', JSON.stringify(sentMessages));
}
updateHistoryList();
showToast('Mensaje eliminado del historial');
};
const countryCodeDropdown = document.getElementById('countryCodeDropdown');
const selectedCountryCode = document.getElementById('selectedCountryCode');
const phoneNumber = document.getElementById('phoneNumber');
const messageText = document.getElementById('messageText');
const previewText = document.getElementById('previewText');
const emojiBtn = document.getElementById('emojiBtn');
const emojiPicker = document.getElementById('emojiPicker');
const emojiBtns = document.querySelectorAll('.emoji-btn');
const emojiCategoryBtns = document.querySelectorAll('.emoji-category-btn');
const emojiCategories = document.querySelectorAll('.emoji-category');
const savedMessagesBtn = document.getElementById('savedMessagesBtn');
const savedMessagesDropdown = document.getElementById('savedMessagesDropdown');
const savedMessagesList = document.getElementById('savedMessagesList');
const savedMessagesCount = document.getElementById('savedMessagesCount');
const selectedMessagePreview = document.getElementById('selectedMessagePreview');
const saveMessageBtn = document.getElementById('saveMessageBtn');
const saveMessageModal = document.getElementById('saveMessageModal');
const messageTitle = document.getElementById('messageTitle');
const confirmSaveMessage = document.getElementById('confirmSaveMessage');
const cancelSaveMessage = document.getElementById('cancelSaveMessage');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const advancedOptionsBtn = document.getElementById('advancedOptionsBtn');
const advancedOptions = document.getElementById('advancedOptions');
const advancedOptionsIcon = document.getElementById('advancedOptionsIcon');
const scheduleMessage = document.getElementById('scheduleMessage');
const scheduleOptions = document.getElementById('scheduleOptions');
const numpad = document.getElementById('numpad');
const numpadBtns = document.querySelectorAll('.numpad-btn');
const closeNumpad = document.getElementById('closeNumpad');
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toastMessage');
// Variables
let savedMessages = JSON.parse(localStorage.getItem('whatsappMessages')) || [];
updateSavedMessagesCount();
loadSavedMessages();
// Eventos
countryCodeBtn.addEventListener('click', function() {
countryCodeDropdown.classList.toggle('hidden');
});
document.querySelectorAll('#countryCodeDropdown li').forEach(item => {
item.addEventListener('click', function() {
selectedCountryCode.textContent = this.dataset.code;
countryCodeDropdown.classList.add('hidden');
});
});
phoneNumber.addEventListener('focus', function() {
document.getElementById('numpad').classList.remove('hidden');
});
document.getElementById('numpad').addEventListener('click', function(e) {
e.stopPropagation();
const target = e.target;
if (target.classList.contains('numpad-btn')) {
const key = target.dataset.key;
if (key === 'backspace') {
document.getElementById('phoneNumber').value = document.getElementById('phoneNumber').value.slice(0, -1);
} else {
document.getElementById('phoneNumber').value += key;
}
}
});
document.addEventListener('click', function(e) {
if (!document.getElementById('numpad').contains(e.target) && !document.getElementById('phoneNumber').contains(e.target)) {
document.getElementById('numpad').classList.add('hidden');
}
});
messageText.addEventListener('input', updatePreview);
emojiBtn.addEventListener('click', function() {
emojiPicker.classList.toggle('hidden');
});
emojiBtns.forEach(btn => {
btn.addEventListener('click', function() {
const emoji = this.textContent;
const start = messageText.selectionStart;
const end = messageText.selectionEnd;
messageText.value = messageText.value.substring(0, start) + emoji + messageText.value.substring(end);
messageText.selectionStart = messageText.selectionEnd = start + emoji.length;
messageText.focus();
updatePreview();
});
});
emojiCategoryBtns.forEach(btn => {
btn.addEventListener('click', function() {
const category = this.dataset.category;
emojiCategoryBtns.forEach(b => b.classList.remove('bg-primary', 'text-white'));
emojiCategoryBtns.forEach(b => b.classList.add('bg-gray-100'));
this.classList.remove('bg-gray-100');
this.classList.add('bg-primary', 'text-white');
emojiCategories.forEach(c => c.classList.add('hidden'));
document.getElementById(category).classList.remove('hidden');
});
});
savedMessagesBtn.addEventListener('click', function() {
savedMessagesDropdown.classList.toggle('hidden');
});
saveMessageBtn.addEventListener('click', function() {
if (messageText.value.trim() === '') {
showToast('Escribe un mensaje primero');
return;
}
saveMessageModal.classList.remove('hidden');
messageTitle.focus();
});
confirmSaveMessage.addEventListener('click', function() {
if (messageTitle.value.trim() === '') {
showToast('Ingresa un título para el mensaje');
return;
}
const newMessage = {
id: Date.now(),
title: messageTitle.value.trim(),
text: messageText.value.trim(),
date: new Date().toISOString()
};
savedMessages.push(newMessage);
localStorage.setItem('whatsappMessages', JSON.stringify(savedMessages));
saveMessageModal.classList.add('hidden');
messageTitle.value = '';
loadSavedMessages();
updateSavedMessagesCount();
showToast('Mensaje guardado');
});
cancelSaveMessage.addEventListener('click', function() {
saveMessageModal.classList.add('hidden');
messageTitle.value = '';
});
const broadcastBtn = document.getElementById('broadcastBtn');
const bulkSendBtn = document.getElementById('bulkSendBtn');
broadcastBtn.addEventListener('click', function() {
if (messageText.value.trim() === '') {
showToast('Escribe un mensaje primero');
return;
}
const message = messageText.value.trim();
const url = `whatsapp://send?text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
});
bulkSendBtn.addEventListener('click', function() {
if (messageText.value.trim() === '') {
showToast('Escribe un mensaje primero');
return;
}
if (savedPhones.length === 0) {
showToast('No hay contactos guardados');
return;
}
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Envío masivo</h3>
<div class="max-h-48 overflow-y-auto mb-3">
<p class="text-sm text-gray-600 mb-2">Selecciona los contactos:</p>
${savedPhones.map(phone => `
<label class="flex items-center p-2 hover:bg-gray-50 !rounded-button">
<input type="checkbox" value="${phone.id}" class="mr-2">
<div>
<p class="text-sm font-medium">${phone.name}</p>
<p class="text-xs text-gray-500">+${phone.countryCode}${phone.number}</p>
</div>
</label>
`).join('')}
</div>
<div class="flex items-center gap-2 mb-4">
<input type="checkbox" id="selectAllContacts">
<label for="selectAllContacts" class="text-sm">Seleccionar todos</label>
</div>
<div class="flex items-center gap-2 mb-4">
<input type="number" id="messageDelay" value="2" min="1" max="10" class="w-16 px-2 py-1 border border-gray-300 !rounded-button">
<label class="text-sm text-gray-600">Segundos entre cada mensaje</label>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-bulk px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="send-bulk px-4 py-2 bg-primary text-white !rounded-button">Enviar mensajes</button>
</div>
</div>
`;
document.body.appendChild(modal);
const selectAllCheckbox = modal.querySelector('#selectAllContacts');
const contactCheckboxes = modal.querySelectorAll('input[type="checkbox"][value]');
selectAllCheckbox.addEventListener('change', function() {
contactCheckboxes.forEach(checkbox => {
checkbox.checked = this.checked;
});
});
modal.querySelector('.cancel-bulk').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.send-bulk').addEventListener('click', () => {
const selectedContacts = Array.from(contactCheckboxes)
.filter(cb => cb.checked)
.map(cb => savedPhones.find(p => p.id === cb.value));
if (selectedContacts.length === 0) {
showToast('Selecciona al menos un contacto');
return;
}
const message = messageText.value.trim();
const delay = parseInt(modal.querySelector('#messageDelay').value) * 1000;
document.body.removeChild(modal);
showToast(`Enviando ${selectedContacts.length} mensajes...`);
selectedContacts.forEach((contact, index) => {
setTimeout(() => {
const phone = contact.countryCode + contact.number;
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
if (index === selectedContacts.length - 1) {
showToast('Envío masivo completado');
}
}, index * delay);
});
});
});
sendBtn.addEventListener('click', function() {
if (phoneNumber.value.trim() === '') {
showToast('Ingresa un número de teléfono');
return;
}
if (messageText.value.trim() === '') {
showToast('Escribe un mensaje');
return;
}
const phone = selectedCountryCode.textContent.replace('+', '') + phoneNumber.value.trim();
const message = messageText.value.trim();
// Save to sent messages history
const sentMessage = {
id: Date.now(),
phone: phone,
message: message,
date: new Date().toISOString()
};
sentMessages.unshift(sentMessage);
if (sentMessages.length > 50) sentMessages.pop(); // Keep only last 50 messages
localStorage.setItem('whatsappSentMessages', JSON.stringify(sentMessages));
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
});
clearBtn.addEventListener('click', function() {
phoneNumber.value = '';
messageText.value = '';
selectedMessagePreview.textContent = 'Seleccionar mensaje guardado';
updatePreview();
showToast('Todo limpiado');
});
let savedPhones = JSON.parse(localStorage.getItem('whatsappSavedPhones')) || [];
let contactTags = JSON.parse(localStorage.getItem('whatsappContactTags')) || [];
let scheduledMessages = JSON.parse(localStorage.getItem('whatsappScheduledMessages')) || [];
function updateSavedPhonesList(searchTerm = '') {
const phonesList = document.getElementById('savedPhonesList');
if (savedPhones.length === 0) {
phonesList.innerHTML = '<li class="px-3 py-2 text-gray-500 text-center">No hay números guardados</li>';
return;
}
function getContactTags(contactId) {
const contact = savedPhones.find(p => p.id === contactId);
return contact?.tags || [];
}
function getContactNotes(contactId) {
const contact = savedPhones.find(p => p.id === contactId);
return contact?.notes || '';
}
const filteredPhones = searchTerm
? savedPhones.filter(phone =>
phone.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
phone.number.includes(searchTerm)
)
: savedPhones;
if (filteredPhones.length === 0) {
phonesList.innerHTML = '<li class="px-3 py-2 text-gray-500 text-center">No se encontraron contactos</li>';
return;
}
phonesList.innerHTML = filteredPhones.map(phone => `
<li class="px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center justify-between">
<div class="flex items-center flex-1">
<i class="ri-user-line mr-2 text-gray-500"></i>
<div class="flex flex-col flex-1">
<div class="flex items-center gap-2">
<span class="font-medium">${phone.name || 'Sin nombre'}</span>
${(phone.tags || []).map(tag => `
<span class="px-2 py-0.5 bg-primary/10 text-primary text-xs !rounded-full">${tag}</span>
`).join('')}
</div>
<span class="text-sm text-gray-500">+${phone.countryCode}${phone.number}</span>
${phone.notes ? `<p class="text-xs text-gray-500 mt-1 italic">${phone.notes}</p>` : ''}
</div>
</div>
<div class="flex gap-2">
<button onclick="editContactInfo('${phone.id}')" class="flex w-8 h-8 items-center justify-center text-primary">
<i class="ri-edit-line"></i>
</button>
<button onclick="deletePhone('${phone.id}')" class="flex w-8 h-8 items-center justify-center text-red-500">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</li>
`).join('');
phonesList.querySelectorAll('li').forEach(li => {
li.addEventListener('click', function(e) {
if (!e.target.closest('button')) {
const phoneData = savedPhones.find(p => p.id === this.querySelector('button').getAttribute('onclick').match(/'(.+?)'/)[1]);
if (phoneData) {
document.getElementById('selectedCountryCode').textContent = '+' + phoneData.countryCode;
document.getElementById('phoneNumber').value = phoneData.number;
}
document.getElementById('savedPhonesDropdown').classList.add('hidden');
}
});
});
}
window.editContactInfo = function(id) {
const contact = savedPhones.find(p => p.id === id);
if (!contact) return;
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Editar contacto</h3>
<div class="space-y-3 mb-4">
<div>
<label class="text-sm text-gray-600 mb-1 block">Nombre</label>
<input type="text" value="${contact.name}" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Etiquetas</label>
<div class="flex flex-wrap gap-2 mb-2">
${(contact.tags || []).map(tag => `
<span class="px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1">
${tag}
<button onclick="removeTag('${tag}')" class="w-4 h-4 flex items-center justify-center">×</button>
</span>
`).join('')}
</div>
<div class="flex gap-2 flex-col">
<div class="relative">
<select id="savedTagsSelect" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm appearance-none cursor-pointer">
<option value="">Seleccionar etiqueta guardada</option>
</select>
<i class="ri-arrow-down-s-line absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-500"></i>
</div>
<div class="flex gap-2">
<input type="text" placeholder="Nueva etiqueta" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm">
<button onclick="addTag()" class="px-3 py-2 bg-primary text-white !rounded-button">Agregar</button>
</div>
</div>
</div>
<div>
<label class="text-sm text-gray-600 mb-1 block">Notas</label>
<textarea rows="3" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm resize-none">${contact.notes || ''}</textarea>
</div>
</div>
<div class="flex justify-end gap-2">
<button class="cancel-edit px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="save-edit px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
const tagsContainer = modal.querySelector('.flex-wrap');
const tagInput = modal.querySelector('input[placeholder="Nueva etiqueta"]');
let savedTags = JSON.parse(localStorage.getItem('whatsappSavedTags')) || [];
const savedTagsSelect = modal.querySelector('#savedTagsSelect');
function updateSavedTagsSelect() {
savedTagsSelect.innerHTML = `
<option value="">Seleccionar etiqueta guardada</option>
${savedTags.map(tag => `<option value="${tag}">${tag}</option>`).join('')}
`;
}
savedTagsSelect.addEventListener('change', function() {
const selectedTag = this.value;
if (selectedTag) {
addTag(selectedTag);
this.value = '';
}
});
window.addTag = function(tagValue) {
const newTag = tagValue || tagInput.value.trim();
if (!newTag) return;
const existingTags = Array.from(tagsContainer.children).map(span =>
span.textContent.trim().slice(0, -1)
);
if (existingTags.includes(newTag)) {
showToast('Esta etiqueta ya existe');
return;
}
const tagSpan = document.createElement('span');
tagSpan.className = 'px-2 py-1 bg-primary/10 text-primary text-sm !rounded-full flex items-center gap-1';
tagSpan.innerHTML = `
${newTag}
<button onclick="removeTag('${newTag}')" class="w-4 h-4 flex items-center justify-center">×</button>
`;
tagsContainer.appendChild(tagSpan);
tagInput.value = '';
if (!savedTags.includes(newTag)) {
savedTags.push(newTag);
localStorage.setItem('whatsappSavedTags', JSON.stringify(savedTags));
updateSavedTagsSelect();
}
};
updateSavedTagsSelect();
window.removeTag = function(tag) {
const tagElements = tagsContainer.querySelectorAll('span');
tagElements.forEach(el => {
if (el.textContent.trim().slice(0, -1) === tag) {
el.remove();
}
});
};
modal.querySelector('.cancel-edit').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.save-edit').addEventListener('click', () => {
const name = modal.querySelector('input[type="text"]').value.trim();
const notes = modal.querySelector('textarea').value.trim();
const tags = Array.from(tagsContainer.children).map(span =>
span.textContent.trim().slice(0, -1)
);
if (!name) {
showToast('Ingresa el nombre del contacto');
return;
}
const index = savedPhones.findIndex(p => p.id === id);
savedPhones[index] = {
...savedPhones[index],
name,
notes,
tags
};
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateSavedPhonesList();
document.body.removeChild(modal);
showToast('Contacto actualizado');
});
};
window.deletePhone = function(id) {
savedPhones = savedPhones.filter(phone => phone.id !== id);
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateSavedPhonesList();
showToast('Número eliminado');
};
document.getElementById('savePhoneBtn').addEventListener('click', function() {
const countryCode = document.getElementById('selectedCountryCode').textContent.replace('+', '');
const number = document.getElementById('phoneNumber').value.trim();
if (!number) {
showToast('Ingresa un número de teléfono');
return;
}
const existingPhone = savedPhones.find(p => p.countryCode === countryCode && p.number === number);
if (existingPhone) {
showToast('Este número ya está guardado');
return;
}
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Guardar contacto</h3>
<input type="text" id="clientName" placeholder="Nombre del cliente" class="w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3">
<div class="flex justify-end gap-2">
<button class="cancel-save px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="confirm-save px-4 py-2 bg-primary text-white !rounded-button">Guardar</button>
</div>
</div>
`;
document.body.appendChild(modal);
const nameInput = modal.querySelector('#clientName');
nameInput.focus();
modal.querySelector('.cancel-save').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.confirm-save').addEventListener('click', () => {
const clientName = nameInput.value.trim();
if (!clientName) {
showToast('Ingresa el nombre del cliente');
return;
}
const newPhone = {
id: Date.now().toString(),
countryCode,
number,
name: clientName
};
savedPhones.push(newPhone);
localStorage.setItem('whatsappSavedPhones', JSON.stringify(savedPhones));
updateSavedPhonesList();
document.body.removeChild(modal);
showToast('Contacto guardado');
});
});
document.getElementById('selectPhoneBtn').addEventListener('click', function() {
document.getElementById('savedPhonesDropdown').classList.toggle('hidden');
});
document.addEventListener('click', function(event) {
const dropdown = document.getElementById('savedPhonesDropdown');
const selectBtn = document.getElementById('selectPhoneBtn');
if (!selectBtn.contains(event.target) && !dropdown.contains(event.target)) {
dropdown.classList.add('hidden');
}
});
updateSavedPhonesList();
// Restore timers for scheduled messages
scheduledMessages.forEach(msg => {
const now = new Date().getTime();
const scheduledTime = msg.scheduledTime;
if (scheduledTime > now) {
msg.timer = setTimeout(() => {
const url = `whatsapp://send?phone=${msg.phone}&text=${encodeURIComponent(msg.message)}`;
window.open(url, '_blank');
// Save to scheduled sent messages history
const scheduledSentMessage = {
id: Date.now(),
phone: msg.phone,
message: msg.message,
date: new Date().toISOString(),
wasScheduled: true
};
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
scheduledSentMessages.unshift(scheduledSentMessage);
if (scheduledSentMessages.length > 50) scheduledSentMessages.pop();
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
removeScheduledMessage(msg.id);
}, scheduledTime - now);
}
});
updateScheduledMessagesList();
scheduleMessage.addEventListener('change', function() {
const scheduleOptions = document.getElementById('scheduleOptions');
const addScheduleBtn = document.getElementById('addScheduleBtn');
scheduleOptions.classList.toggle('hidden', !this.checked);
addScheduleBtn.classList.toggle('hidden', !this.checked);
if (!this.checked) {
scheduledMessages.forEach(msg => {
if (msg.timer) clearTimeout(msg.timer);
});
scheduledMessages = [];
updateScheduledMessagesList();
}
});
document.getElementById('addScheduleBtn').addEventListener('click', function() {
if (phoneNumber.value.trim() === '' || messageText.value.trim() === '') {
showToast('Ingresa número y mensaje primero');
return;
}
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<h3 class="text-lg font-semibold mb-3">Programar nuevo mensaje</h3>
<input type="datetime-local" class="schedule-datetime w-full px-3 py-2 bg-white border border-gray-300 !rounded-button shadow-sm mb-3">
<div class="flex justify-end gap-2">
<button class="cancel-schedule px-4 py-2 bg-gray-200 !rounded-button">Cancelar</button>
<button class="confirm-schedule px-4 py-2 bg-primary text-white !rounded-button">Programar</button>
</div>
</div>
`;
document.body.appendChild(modal);
const datetimeInput = modal.querySelector('.schedule-datetime');
modal.querySelector('.cancel-schedule').addEventListener('click', () => {
document.body.removeChild(modal);
});
modal.querySelector('.confirm-schedule').addEventListener('click', () => {
const selectedTime = new Date(datetimeInput.value).getTime();
const now = new Date().getTime();
if (selectedTime <= now) {
showToast('Selecciona una fecha y hora futura');
return;
}
const phone = selectedCountryCode.textContent.replace('+', '') + phoneNumber.value.trim();
const message = messageText.value.trim();
const scheduledMessage = {
id: Date.now(),
phone,
message,
scheduledTime: selectedTime,
timer: setTimeout(() => {
const url = `whatsapp://send?phone=${phone}&text=${encodeURIComponent(message)}`;
window.open(url, '_blank');
// Save to scheduled sent messages history
const scheduledSentMessage = {
id: Date.now(),
phone,
message,
date: new Date().toISOString(),
wasScheduled: true
};
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
scheduledSentMessages.unshift(scheduledSentMessage);
if (scheduledSentMessages.length > 50) scheduledSentMessages.pop();
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
removeScheduledMessage(scheduledMessage.id);
}, selectedTime - now)
};
scheduledMessages.push(scheduledMessage);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
document.body.removeChild(modal);
showToast('Mensaje programado');
});
});
function updateScheduledMessagesList() {
const listContainer = document.getElementById('scheduledMessagesList');
const noMessagesText = document.getElementById('noScheduledMessages');
if (scheduledMessages.length === 0) {
listContainer.innerHTML = '';
noMessagesText.classList.remove('hidden');
return;
}
noMessagesText.classList.add('hidden');
listContainer.innerHTML = scheduledMessages.map(msg => `
<div class="bg-white p-3 !rounded-button shadow-sm border border-gray-200">
<div class="flex justify-between items-start mb-2">
<div>
<p class="text-sm font-medium">+${msg.phone}</p>
<p class="text-xs text-gray-500">${new Date(msg.scheduledTime).toLocaleString()}</p>
</div>
<div class="flex gap-2">
<button onclick="window.sendScheduledMessageNow(${msg.id})" class="text-primary p-1">
<i class="ri-send-plane-line"></i>
</button>
<button onclick="window.removeScheduledMessageFromHistory(${msg.id})" class="text-red-500 p-1">
<i class="ri-delete-bin-line"></i>
</button>
</div>
</div>
<p class="text-sm text-gray-600 break-words">${msg.message}</p>
</div>
`).join('');
}
window.removeScheduledMessageFromHistory = function(id) {
const message = scheduledMessages.find(msg => msg.id === id);
if (message && message.timer) {
clearTimeout(message.timer);
}
scheduledMessages = scheduledMessages.filter(msg => msg.id !== id);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
updateHistoryList();
showToast('Mensaje programado eliminado');
};
window.sendScheduledMessageNow = function(id) {
const message = scheduledMessages.find(msg => msg.id === id);
if (message) {
if (message.timer) {
clearTimeout(message.timer);
}
const url = `whatsapp://send?phone=${message.phone}&text=${encodeURIComponent(message.message)}`;
window.open(url, '_blank');
const scheduledSentMessage = {
id: Date.now(),
phone: message.phone,
message: message.message,
date: new Date().toISOString(),
wasScheduled: true
};
const scheduledSentMessages = JSON.parse(localStorage.getItem('whatsappScheduledSentMessages')) || [];
scheduledSentMessages.unshift(scheduledSentMessage);
if (scheduledSentMessages.length > 50) scheduledSentMessages.pop();
localStorage.setItem('whatsappScheduledSentMessages', JSON.stringify(scheduledSentMessages));
scheduledMessages = scheduledMessages.filter(msg => msg.id !== id);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
updateHistoryList();
showToast('Mensaje enviado inmediatamente');
}
};
window.removeScheduledMessage = function(id) {
const message = scheduledMessages.find(msg => msg.id === id);
if (message && message.timer) {
clearTimeout(message.timer);
}
scheduledMessages = scheduledMessages.filter(msg => msg.id !== id);
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(scheduledMessages.map(msg => ({
id: msg.id,
phone: msg.phone,
message: msg.message,
scheduledTime: msg.scheduledTime
}))));
updateScheduledMessagesList();
updateHistoryList();
showToast('Mensaje programado eliminado');
};
// Cerrar dropdowns al hacer clic fuera
document.addEventListener('click', function(event) {
if (!countryCodeBtn.contains(event.target) && !countryCodeDropdown.contains(event.target)) {
countryCodeDropdown.classList.add('hidden');
}
if (!savedMessagesBtn.contains(event.target) && !savedMessagesDropdown.contains(event.target)) {
savedMessagesDropdown.classList.add('hidden');
}
if (!emojiBtn.contains(event.target) && !emojiPicker.contains(event.target)) {
emojiPicker.classList.add('hidden');
}
});
// Funciones
function updatePreview() {
let text = messageText.value || 'Tu mensaje aparecerá aquí';
// Apply rich text formatting
text = text
.replace(/\*([^*]+)\*/g, '<strong>$1</strong>') // Bold
.replace(/_([^_]+)_/g, '<em>$1</em>') // Italic
.replace(/~([^~]+)~/g, '<del>$1</del>') // Strikethrough
.replace(/```([^`]+)```/g, '<code>$1</code>') // Monospace
.replace(/^• (.+)$/gm, '<li>$1</li>') // Bullet points
.replace(/^\d+\. (.+)$/gm, '<li>$1</li>') // Numbered lists
.replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>') // Quotes
.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-primary">$1</a>') // Links
.replace(/\n/g, '<br>');
// Wrap lists in ul/ol tags
if (text.includes('<li>')) {
text = text.replace(/<li>.*?<\/li>/gs, match => {
if (match.startsWith('<li>•')) {
return '<ul class="list-disc pl-4">' + match + '</ul>';
} else {
return '<ol class="list-decimal pl-4">' + match + '</ol>';
}
});
}
previewText.innerHTML = text;
}
function loadSavedMessages() {
if (savedMessages.length === 0) {
savedMessagesList.innerHTML = '<li class="px-3 py-2 text-gray-500 text-center">No hay mensajes guardados</li>';
return;
}
savedMessagesList.innerHTML = '';
savedMessages.forEach(message => {
const li = document.createElement('li');
li.className = 'px-3 py-2 hover:bg-gray-100 cursor-pointer relative group';
li.dataset.id = message.id;
const messageDiv = document.createElement('div');
messageDiv.className = 'pr-8';
const title = document.createElement('div');
title.className = 'font-medium text-sm';
title.textContent = message.title;
const preview = document.createElement('div');
preview.className = 'text-xs text-gray-500 truncate';
preview.textContent = message.text;
messageDiv.appendChild(title);
messageDiv.appendChild(preview);
const actions = document.createElement('div');
actions.className = 'absolute right-2 top-1/2 transform -translate-y-1/2 hidden group-hover:flex gap-1';
const deleteBtn = document.createElement('button');
deleteBtn.className = 'w-6 h-6 flex items-center justify-center text-red-500';
deleteBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
deleteBtn.addEventListener('click', function(e) {
e.stopPropagation();
deleteMessage(message.id);
});
actions.appendChild(deleteBtn);
li.appendChild(messageDiv);
li.appendChild(actions);
li.addEventListener('click', function() {
messageText.value = message.text;
selectedMessagePreview.textContent = message.title;
savedMessagesDropdown.classList.add('hidden');
updatePreview();
});
savedMessagesList.appendChild(li);
});
}
function deleteMessage(id) {
savedMessages = savedMessages.filter(message => message.id !== id);
localStorage.setItem('whatsappMessages', JSON.stringify(savedMessages));
loadSavedMessages();
updateSavedMessagesCount();
selectedMessagePreview.textContent = 'Seleccionar mensaje guardado';
messageText.value = '';
updatePreview();
showToast('Mensaje eliminado');
}
function updateSavedMessagesCount() {
savedMessagesCount.textContent = savedMessages.length;
}
function showToast(message) {
toastMessage.textContent = message;
toast.classList.remove('hidden');
setTimeout(() => {
toast.classList.add('hidden');
}, 3000);
}
const backupBtn = document.getElementById('backupBtn');
backupBtn.addEventListener('click', function() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
modal.innerHTML = `
<div class="bg-white !rounded-button p-4 w-full max-w-sm">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Copias de seguridad</h3>
<button class="close-backup text-gray-500">
<i class="ri-close-line ri-lg"></i>
</button>
</div>
<div class="space-y-4">
<div class="bg-gray-50 p-3 !rounded-button">
<p class="text-sm mb-2">Datos incluidos en la copia:</p>
<div class="space-y-1">
<p class="text-xs text-gray-500">• Contactos guardados</p>
<p class="text-xs text-gray-500">• Mensajes guardados</p>
<p class="text-xs text-gray-500">• Historial de mensajes</p>
<p class="text-xs text-gray-500">• Mensajes programados</p>
<p class="text-xs text-gray-500">• Etiquetas y notas</p>
<p class="text-xs text-gray-500">• Citas del calendario</p>
<p class="text-xs text-gray-500">• Tipos de citas</p>
<p class="text-xs text-gray-500">• Configuración de la aplicación</p>
</div>
</div>
<div class="flex flex-col gap-3">
<button id="exportBackupBtn" class="w-full px-3 py-2 bg-primary text-white !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-download-2-line"></i> Exportar copia de seguridad
</button>
<div class="relative">
<input type="file" id="importBackupInput" accept=".json" class="hidden">
<button id="importBackupBtn" class="w-full px-3 py-2 bg-gray-100 text-gray-600 !rounded-button text-sm flex items-center justify-center gap-2">
<i class="ri-upload-2-line"></i> Importar copia de seguridad
</button>
</div>
</div>
</div>
</div>
`;
document.body.appendChild(modal);
modal.querySelector('.close-backup').addEventListener('click', () => {
document.body.removeChild(modal);
});
const exportBackupBtn = modal.querySelector('#exportBackupBtn');
const importBackupBtn = modal.querySelector('#importBackupBtn');
const importBackupInput = modal.querySelector('#importBackupInput');
exportBackupBtn.addEventListener('click', () => {
const backupData = {
savedPhones,
savedMessages,
sentMessages,
scheduledMessages,
contactTags,
productStock,
products,
categories,
transactions,
radioStations,
templates,
savedTags: JSON.parse(localStorage.getItem('whatsappSavedTags')) || [],
colorMode: localStorage.getItem('colorMode') || 'light',
appointments: JSON.parse(localStorage.getItem('whatsappAppointments')) || [],
appointmentTypes: JSON.parse(localStorage.getItem('whatsappAppointmentTypes')) || [],
version: '1.1',
exportDate: new Date().toISOString()
};
const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `whatsapp_backup_${new Date().toISOString().split('T')[0]}.json`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
showToast('Copia de seguridad exportada');
});
importBackupBtn.addEventListener('click', () => {
importBackupInput.click();
});
importBackupInput.addEventListener('change', (e) => {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = function(e) {
try {
const backupData = JSON.parse(e.target.result);
if (!backupData.version || !backupData.exportDate) {
throw new Error('Formato de archivo inválido');
}
localStorage.setItem('whatsappSavedPhones', JSON.stringify(backupData.savedPhones || []));
localStorage.setItem('whatsappMessages', JSON.stringify(backupData.savedMessages || []));
localStorage.setItem('whatsappSentMessages', JSON.stringify(backupData.sentMessages || []));
localStorage.setItem('whatsappScheduledMessages', JSON.stringify(backupData.scheduledMessages || []));
localStorage.setItem('whatsappContactTags', JSON.stringify(backupData.contactTags || []));
localStorage.setItem('whatsappProductStock', JSON.stringify(backupData.productStock || {}));
localStorage.setItem('whatsappProducts', JSON.stringify(backupData.products || []));
localStorage.setItem('whatsappCategories', JSON.stringify(backupData.categories || []));
localStorage.setItem('whatsappTransactions', JSON.stringify(backupData.transactions || []));
localStorage.setItem('whatsappRadioStations', JSON.stringify(backupData.radioStations || []));
localStorage.setItem('whatsappTemplates', JSON.stringify(backupData.templates || []));
localStorage.setItem('whatsappSavedTags', JSON.stringify(backupData.savedTags || []));
localStorage.setItem('whatsappAppointments', JSON.stringify(backupData.appointments || []));
localStorage.setItem('whatsappAppointmentTypes', JSON.stringify(backupData.appointmentTypes || []));
localStorage.setItem('colorMode', backupData.colorMode || 'light');
savedPhones = backupData.savedPhones || [];
savedMessages = backupData.savedMessages || [];
sentMessages = backupData.sentMessages || [];
scheduledMessages = backupData.scheduledMessages || [];
contactTags = backupData.contactTags || [];
productStock = backupData.productStock || {};
products = backupData.products || [];
categories = backupData.categories || [];
transactions = backupData.transactions || [];
radioStations = backupData.radioStations || [];
templates = backupData.templates || [];
updateSavedPhonesList();
loadSavedMessages();
updateSavedMessagesCount();
updateHistoryList();
updateScheduledMessagesList();
updateTransactionsList();
updateFinanceSummary();
updateProductsList();
updateStationsList();
applyColorMode(backupData.colorMode || 'light');
showToast('Copia de seguridad restaurada');
document.body.removeChild(modal);
setTimeout(() => {
location.reload();
}, 1500);
} catch (error) {
showToast('Error al importar la copia de seguridad');
console.error(error);
}
};
reader.readAsText(file);
});
});
});
</script>
</body>
</html>
